var using=function(){"use strict";function t(n){var s,o=[],u=d[n],a=m[n];c[n]||(0===u.length?(s=f[n](),s||console.error("Module '"+n+"' returned nothing"),c[n]=s,p[n].forEach(t)):i(u)&&(u.forEach(function(t,e){o.push(r(t,a[e]))}),s=f[n].apply(void 0,o),s||console.error("Module '"+n+"' returned nothing."),c[n]=s,p[n].forEach(t)),e())}function e(){g||(g=!0,n())}function n(){h.forEach(function(t){t()}),h.length?setTimeout(n,20):g=!1}function i(t){var e=!0;return t.forEach(function(t){c[t]||(e=!1)}),e}function r(t,e){var n,i;if(i=c[t],!e)return console.log("Module has no selectors:",t),i;for(n=e.slice();n.length;){if("object"!=typeof i||null===i)throw new TypeError("Module '"+t+"' has no property '"+n.join("::")+"'.");i=i[n.shift()]}return i}function s(){function n(t){function n(e){var s=[];return i(g)?(g.forEach(function(t,e){s.push(r(t,y[e]))}),t.apply(void 0,s),e||h.splice(h.indexOf(n),1),!0):!1}return n(!0)||h.push(n),e(),b}function a(e,n){return o(e)?(console.warn("Module '"+e+"' is already defined."),b):(f[e]=n,d[e]=g,m[e]=y,p[e]||(p[e]=[]),g.forEach(function(t){p[t]||(p[t]=[]),p[t].push(e)}),t(e),b)}var l,g,y,b;return g=[],y=[],l=[].slice.call(arguments),l.forEach(function(e,n){function i(n){c[e]=n,p[e].forEach(t)}var r,o,a=e.split("::"),l=a[0].split(":"),f=l.length>1?l[0]:"";a[0]=l.length>1?l[1]:l[0],r=a.slice(1),o=a[0],"ajax"===f?g.push(e):g.push(o),y.push(r),o in d||o in c||("ajax"===f?(d[e]=[],p[e]||(p[e]=[]),s.ajax(s.ajax.HTTP_METHOD_GET,e.replace(/^ajax:/,""),null,i,i)):(d[o]=[],p[o]||(p[o]=[]),u(o)))}),b={run:n,define:a}}function o(t){return t in f}function u(t){if(!(t in s.modules))throw new Error("Unknown module '"+t+"'.");s.loadScript(s.modules[t])}function a(t){var e=!1,n=document.getElementsByTagName("script");return[].forEach.call(n,function(n){var i=n.getAttribute("src");i&&y(i)===t&&(e=!0)}),e}var c={},l={},d={},f={},p={},h=[],m={},g=!1,y=function(){var t=document.createElement("a");return function(e){return t.href=e,t.href}}();return s.exists=o,s.path="",function(){var t=document.getElementsByTagName("script");s.path=t[t.length-1].src.replace(/using\.js$/,"")}(),s.modules={},s.loadScript=function(t){t=y(t);var e=document.createElement("script");l[t]||a(t)||(e.setAttribute("data-inserted-by","using.js"),e.src=t,l[t]=!0,document.body.appendChild(e))},s}();using.ajax=function(){function t(t,n,i,r,s,u){var a=XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return a.open(t,n+"?random="+Math.random(),!0),u&&(a.timeout=u,a.ontimeout=function(){a.abort(),s&&s(new Error("Connection has reached the timeout of "+u+" ms."))}),a.onreadystatechange=function(){var t,n;if(t=a.readyState===o){try{n=a.status===e}catch(i){console.error(i),n=!1}n?r(a):s(a)}},i?a.send(i):a.send(),a}var e=200,n=0,i=1,r=2,s=3,o=4;return t.HTTP_STATUS_OK=e,t.READY_STATE_UNSENT=n,t.READY_STATE_OPENED=i,t.READY_STATE_HEADERS_RECEIVED=r,t.READY_STATE_LOADING=s,t.READY_STATE_DONE=o,t.HTTP_METHOD_GET="GET",t.HTTP_METHOD_POST="POST",t.HTTP_METHOD_PUT="PUT",t.HTTP_METHOD_DELETE="DELETE",t.HTTP_METHOD_HEAD="HEAD",t}(),function t(e,n,i){function r(o,u){if(!n[o]){if(!e[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[o]={exports:{}};e[o][0].call(l.exports,function(t){var n=e[o][1][t];return r(n?n:t)},l,l.exports,t,e,n,i)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(t,e,n){using().define("class-manipulator",function(){return t("class-manipulator")}),using().define("databus",function(){return t("databus")}),using().define("eases",function(){return t("eases")}),using().define("easy-ajax",function(){return t("easy-ajax")}),using().define("enjoy-core",function(){return t("enjoy-core")}),using().define("enjoy-typechecks",function(){return t("enjoy-typechecks")}),using().define("howler",function(){return t("howler")}),using().define("string-dict",function(){return t("string-dict")}),using().define("transform-js",function(){return t("transform-js")}),using().define("xmugly",function(){return t("xmugly")})},{"class-manipulator":2,databus:3,eases:23,"easy-ajax":38,"enjoy-core":59,"enjoy-typechecks":85,howler:86,"string-dict":87,"transform-js":88,xmugly:121}],2:[function(t,e,n){function i(t){function e(){return t.setAttribute("class",y()),_}function n(t){return d(t)?r(c(t)):(s(t)||A.push(t),_)}function r(t){return Array.isArray(t)?(t.forEach(n),_):n(t)}function s(t){return d(t)?u(t):A.indexOf(t)>=0}function o(t){return Array.isArray(t)?t.some(s):o(c(t))}function u(t){return Array.isArray(t)?t.every(s):u(c(t))}function l(t){return d(t)?p(c(t)):(s(t)&&A.splice(A.indexOf(t),1),_)}function p(t){return Array.isArray(t)?(t.forEach(l),_):l(t)}function h(t){return d(t)?m(c(t)):s(t)?l(t):n(t)}function m(t){return Array.isArray(t)?(t.forEach(h),_):m(c(t))}function g(){return A.slice()}function y(){return A.join(" ")}function b(t){return i(t).clear().addMany(A)}function v(){return A.length=0,_}function w(t){return A.forEach(function(e,n){t(e,n,_)||l(e)}),_}function E(t){return A.sort(t),_}function S(){return A.length}t="object"==typeof t?t:f(t);var _,A=a(t);return _={add:n,addMany:r,has:s,hasSome:o,hasAll:u,remove:l,removeMany:p,toggle:h,toggleMany:m,apply:e,clear:v,copyTo:b,toArray:g,toString:y,filter:w,sort:E,size:S}}function r(t,e){return i(t).add(e).apply()}function s(t,e){return i(t).remove(e).apply()}function o(t,e){return i(t).toggle(e).apply()}function u(t,e){return i(t).has(e)}function a(t){return c(t.getAttribute("class")||"")}function c(t){return(""+t).replace(/\s+/," ").trim().split(" ").filter(l)}function l(t){return""!==t}function d(t){return!!t.match(/\s/)}function f(t){if("string"!=typeof t)throw new Error("Function list() expects an object or string as its argument.");var e={"class":""+c(t).join(" ")};return{setAttribute:function(t,n){e[t]=n},getAttribute:function(t){return e[t]}}}e.exports={add:r,remove:s,toggle:o,has:u,list:i}},{}],3:[function(t,e,n){e.exports=t("./src/databus")},{"./src/databus":4}],4:[function(t,e,n){!function(){function n(){"use strict";function t(e){function n(t){var e;i.debug===!0&&(e=t.error.name||"Error",console.log(e+" in listener; Event: "+t.info.event+"; Message: "+t.error.message))}var i=this;e=e||{},this.debug=e.debug||!1,this.interceptErrors=e.interceptErrors||!1,this.log=e.log||!1,this.logData=e.logData||!1,this.defaults=e.defaults||{},this.defaults.flowType=this.defaults.flowType||t.FLOW_TYPE_ASYNCHRONOUS,this.callbacks={"*":[]},this.subscribe(n,"EventBus.error")}return t.FLOW_TYPE_ASYNCHRONOUS=0,t.FLOW_TYPE_SYNCHRONOUS=1,t.create=function(e){return e=e||{},new t(e)},t.prototype.subscribe=function(t,e){var n,i,r=this;if(void 0===e?(i="*",n=t):"string"==typeof t||"number"==typeof t?(i=t,n=e):("string"==typeof e||"number"==typeof e)&&(i=e,n=t),"string"!=typeof i&&"number"!=typeof i)throw new Error("Event names can only be strings or numbers! event: ",i);if("function"!=typeof n)throw new Error("Only functions may be used as listeners!");return i=i||"*",this.callbacks[i]=this.callbacks[i]||[],this.callbacks[i].push(n),this.trigger("EventBus.subscribe",{listener:n,event:i,bus:this}),function(){r.unsubscribe(n,i)}},t.prototype.unsubscribe=function(t,e){var n,i,r,s,o;if(void 0===e?(o="*",s=t):"string"==typeof t||"number"==typeof t?(o=t,s=e):("string"==typeof e||"number"==typeof e)&&(o=e,s=t),"string"!=typeof o&&"number"!=typeof o)throw new Error("Event names can only be strings or numbers! event: ",o);if("function"!=typeof s)throw new Error("Only functions may be used as listeners!");for(o=o||"*",n=this.callbacks[o]||[],i=n.length,r=0;i>r;++r)n[r]===s&&this.callbacks[o].splice(r,1);this.trigger("EventBus.unsubscribe",{listener:s,event:o,bus:this})},t.prototype.once=function(t,e){var n,i,r,s,o,u=this,a=!1;if(s="function"==typeof t,o="function"==typeof e,s&&o||!s&&!o)throw new Error("Parameter mismatch; one parameter needs to be a function, the other one must be a string.");s?(r=t,i=e):(r=e,i=t),i=i||"*",n=function(t,e){a||(a=!0,u.unsubscribe(n,i),r(t,e))},this.subscribe(n,i)},t.prototype.trigger=function(e,n,i){function r(t){setTimeout(function(){throw t},0)}var s,o,u,a,c,l,d,f;if("undefined"!=typeof e&&"string"!=typeof e&&"number"!=typeof e)throw new Error("Event names can only be strings or numbers! event: ",e);d=this,e=arguments.length?e:"*",f="undefined"!=typeof i&&i===!1?t.FLOW_TYPE_SYNCHRONOUS:this.defaults.flowType,s=function(){var t,n,i,r,s,o,u="",a=[];for(n=e.split("."),t=0,i=n.length;i>t;++t)for(u=u+(t>0?".":"")+n[t],r=d.callbacks[u]||[],s=0,o=r.length;o>s;++s)a.push(r[s]);if("*"===e)return a;for(r=d.callbacks["*"]||[],s=0,o=r.length;o>s;++s)a.push(r[s]);return a}(),o=s.length,u={event:e,subscribers:o,async:f===t.FLOW_TYPE_ASYNCHRONOUS?!0:!1,getQueueLength:function(){return 0===o?0:o-(a+1)}},c=function(){for(d.log===!0&&console.log("EventBus event triggered: "+e+"; Subscribers: "+o,d.logData===!0?"; Data: "+n:""),a=0;o>a;++a){l=s[a];try{l(n,u)}catch(t){console.log(t),d.trigger("EventBus.error",{error:t,info:u}),d.interceptErrors!==!0&&r(t)}}},f===t.FLOW_TYPE_ASYNCHRONOUS?setTimeout(c,0):c()},t.prototype.triggerSync=function(t,e){return this.trigger(t,e,!1)},t.prototype.triggerAsync=function(t,e){return this.trigger(t,e,!0)},t.inject=function(e,n){n=n||{};var i=new t(n);e.subscribe=function(t,e){i.subscribe(t,e)},e.unsubscribe=function(t,e){i.unsubscribe(t,e)},e.once=function(t,e){i.once(t,e)},e.trigger=function(t,e,n){n="undefined"!=typeof n&&n===!1?!1:!0,i.trigger(t,e,n)},e.triggerSync=i.triggerSync.bind(i),e.triggerAsync=i.triggerAsync.bind(i),e.subscribe("destroyed",function(){i.callbacks=[]})},t}"function"==typeof t?e.exports=n():"function"==typeof using?using().define("databus",n):window.DataBus=n()}()},{}],5:[function(t,e,n){function i(t){var e=2.5949095;return(t*=2)<1?.5*(t*t*((e+1)*t-e)):.5*((t-=2)*t*((e+1)*t+e)+2)}e.exports=i},{}],6:[function(t,e,n){function i(t){var e=1.70158;return t*t*((e+1)*t-e)}e.exports=i},{}],7:[function(t,e,n){function i(t){var e=1.70158;return--t*t*((e+1)*t+e)+1}e.exports=i},{}],8:[function(t,e,n){function i(t){return.5>t?.5*(1-r(1-2*t)):.5*r(2*t-1)+.5}var r=t("./bounce-out");e.exports=i},{"./bounce-out":10}],9:[function(t,e,n){function i(t){return 1-r(1-t)}var r=t("./bounce-out");e.exports=i},{"./bounce-out":10}],10:[function(t,e,n){function i(t){var e=4/11,n=8/11,i=.9,r=4356/361,s=35442/1805,o=16061/1805,u=t*t;return e>t?7.5625*u:n>t?9.075*u-9.9*t+3.4:i>t?r*u-s*t+o:10.8*t*t-20.52*t+10.72}e.exports=i},{}],11:[function(t,e,n){function i(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}e.exports=i},{}],12:[function(t,e,n){function i(t){return 1-Math.sqrt(1-t*t)}e.exports=i},{}],13:[function(t,e,n){function i(t){return Math.sqrt(1- --t*t)}e.exports=i},{}],14:[function(t,e,n){function i(t){return.5>t?4*t*t*t:.5*Math.pow(2*t-2,3)+1}e.exports=i},{}],15:[function(t,e,n){function i(t){return t*t*t}e.exports=i},{}],16:[function(t,e,n){function i(t){var e=t-1;return e*e*e+1}e.exports=i},{}],17:[function(t,e,n){function i(t){return.5>t?.5*Math.sin(13*Math.PI/2*2*t)*Math.pow(2,10*(2*t-1)):.5*Math.sin(-13*Math.PI/2*(2*t-1+1))*Math.pow(2,-10*(2*t-1))+1}e.exports=i},{}],18:[function(t,e,n){function i(t){return Math.sin(13*t*Math.PI/2)*Math.pow(2,10*(t-1))}e.exports=i},{}],19:[function(t,e,n){function i(t){return Math.sin(-13*(t+1)*Math.PI/2)*Math.pow(2,-10*t)+1}e.exports=i},{}],20:[function(t,e,n){function i(t){return 0===t||1===t?t:.5>t?.5*Math.pow(2,20*t-10):-.5*Math.pow(2,10-20*t)+1}e.exports=i},{}],21:[function(t,e,n){function i(t){return 0===t?t:Math.pow(2,10*(t-1))}e.exports=i},{}],22:[function(t,e,n){function i(t){return 1===t?t:1-Math.pow(2,-10*t)}e.exports=i},{}],23:[function(t,e,n){e.exports={backInOut:t("./back-in-out"),backIn:t("./back-in"),backOut:t("./back-out"),bounceInOut:t("./bounce-in-out"),bounceIn:t("./bounce-in"),bounceOut:t("./bounce-out"),circInOut:t("./circ-in-out"),circIn:t("./circ-in"),circOut:t("./circ-out"),cubicInOut:t("./cubic-in-out"),cubicIn:t("./cubic-in"),cubicOut:t("./cubic-out"),elasticInOut:t("./elastic-in-out"),elasticIn:t("./elastic-in"),elasticOut:t("./elastic-out"),expoInOut:t("./expo-in-out"),expoIn:t("./expo-in"),expoOut:t("./expo-out"),linear:t("./linear"),quadInOut:t("./quad-in-out"),quadIn:t("./quad-in"),quadOut:t("./quad-out"),quartInOut:t("./quart-in-out"),quartIn:t("./quart-in"),quartOut:t("./quart-out"),quintInOut:t("./quint-in-out"),quintIn:t("./quint-in"),quintOut:t("./quint-out"),sineInOut:t("./sine-in-out"),sineIn:t("./sine-in"),sineOut:t("./sine-out")}},{"./back-in":6,"./back-in-out":5,"./back-out":7,"./bounce-in":9,"./bounce-in-out":8,"./bounce-out":10,"./circ-in":12,"./circ-in-out":11,"./circ-out":13,"./cubic-in":15,"./cubic-in-out":14,"./cubic-out":16,"./elastic-in":18,"./elastic-in-out":17,"./elastic-out":19,"./expo-in":21,"./expo-in-out":20,"./expo-out":22,"./linear":24,"./quad-in":26,"./quad-in-out":25,"./quad-out":27,"./quart-in":29,"./quart-in-out":28,"./quart-out":30,"./quint-in":32,"./quint-in-out":31,"./quint-out":33,"./sine-in":35,"./sine-in-out":34,"./sine-out":36}],24:[function(t,e,n){function i(t){return t}e.exports=i},{}],25:[function(t,e,n){function i(t){return t/=.5,1>t?.5*t*t:(t--,-.5*(t*(t-2)-1))}e.exports=i},{}],26:[function(t,e,n){function i(t){return t*t}e.exports=i},{}],27:[function(t,e,n){function i(t){return-t*(t-2)}e.exports=i},{}],28:[function(t,e,n){function i(t){return.5>t?8*Math.pow(t,4):-8*Math.pow(t-1,4)+1}e.exports=i},{}],29:[function(t,e,n){function i(t){return Math.pow(t,4)}e.exports=i},{}],30:[function(t,e,n){function i(t){return Math.pow(t-1,3)*(1-t)+1}e.exports=i},{}],31:[function(t,e,n){function i(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}e.exports=i},{}],32:[function(t,e,n){function i(t){return t*t*t*t*t}e.exports=i},{}],33:[function(t,e,n){function i(t){return--t*t*t*t*t+1}e.exports=i},{}],34:[function(t,e,n){function i(t){return-.5*(Math.cos(Math.PI*t)-1)}e.exports=i},{}],35:[function(t,e,n){function i(t){var e=Math.cos(t*Math.PI*.5);return Math.abs(e)<1e-14?1:1-e}e.exports=i},{}],36:[function(t,e,n){function i(t){return Math.sin(t*Math.PI/2)}e.exports=i},{}],37:[function(t,e,n){!function(){function n(t,e,n,r){var s,o,u=XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return n=n||{},"function"!=typeof n||r||(r=n,n={}),r=r||function(){},o="data"in n?n.data:void 0,s=n.timeout,e+=n.randomize?"?random="+Math.random():"",u.open(t,e,!0),s&&(u.timeout=s,u.ontimeout=function(){u.abort(),r(new Error("Connection reached timeout of "+s+" ms."),u)}),u.onreadystatechange=function(){var t,e;if(t=u.readyState===a){try{e=u.status===i}catch(n){console.error(n),e=!1}e?r(null,u):r(new Error("AJAX request wasn't successful."),u)}},o?u.send(o):u.send(),u}var i=200,r=0,s=1,o=2,u=3,a=4;n.HTTP_STATUS_OK=i,n.READY_STATE_UNSENT=r,n.READY_STATE_OPENED=s,n.READY_STATE_HEADERS_RECEIVED=o,n.READY_STATE_LOADING=u,n.READY_STATE_DONE=a,n.HTTP_METHOD_GET="GET",n.HTTP_METHOD_POST="POST",n.HTTP_METHOD_PUT="PUT",n.HTTP_METHOD_DELETE="DELETE",n.HTTP_METHOD_HEAD="HEAD",n.get=function(t,e,i){return n(n.HTTP_METHOD_GET,t,e,i)},n.post=function(t,e,i,r){return"function"!=typeof i||r||(r=i,i={}),i.data=e,n(n.HTTP_METHOD_POST,t,i,r)},"function"==typeof t?e.exports=n:window.ajax=n}()},{}],38:[function(t,e,n){e.exports=t("./easy-ajax.js")},{"./easy-ajax.js":37}],39:[function(t,e,n){function i(){return Array.prototype.reduce.call(arguments,function(t,e){return t+e})}var r=t("./auto");e.exports=r(i,2)},{"./auto":42}],40:[function(t,e,n){function i(t,e){if("function"!=typeof t)throw new TypeError("Argument 'fn' must be a function.");return t.apply(void 0,e)}e.exports=i},{}],41:[function(t,e,n){function i(t,e){return t[e]}var r=t("./auto");e.exports=r(i)},{"./auto":42}],42:[function(t,e,n){function i(t,e){function n(){var i=r(arguments);return i.length>=e?s(t,i):function(){return s(n,i.concat(r(arguments)))}}return e=arguments.length>=2?e:t.length,n}var r=t("./slice"),s=t("./apply");e.exports=i},{"./apply":40,"./slice":78}],43:[function(t,e,n){function i(t){var e=[].slice.call(arguments);return e.shift(),function(){var n,i=e.slice();for(n=0;n<arguments.length;n+=1)i.push(arguments[n]);return t.apply(void 0,i)}}e.exports=i},{}],44:[function(t,e,n){function i(t){var e=[].slice.call(arguments);return e.shift(),t.apply(void 0,e)}e.exports=i},{}],45:[function(t,e,n){function i(){var t=o(arguments);return function(e){var n=t.slice();return n.unshift(e),r(s,n)}}var r=t("./apply"),s=t("./pipe"),o=t("./toArray");e.exports=i},{"./apply":40,"./pipe":69,"./toArray":83}],46:[function(t,e,n){function i(t,e){return r(function(t){return e===t},t)||!1}var r=t("./some"),s=t("./auto");e.exports=s(i)},{"./auto":42,"./some":79}],47:[function(t,e,n){function i(){return Array.prototype.reduce.call(arguments,function(t,e){return t/e})}var r=t("./auto");e.exports=r(i,2)},{"./auto":42}],48:[function(t,e,n){function i(t,e){[].forEach.call(e,t)}function r(t,e){Object.keys(e).forEach(function(n){t(e[n],n,e)})}function s(t,e){return o.isArrayLike(e)?i(t,e):r(t,e)}var o=t("enjoy-typechecks"),u=t("./auto");e.exports=u(s)},{"./auto":42,"enjoy-typechecks":85}],49:[function(t,e,n){function i(t,e){function n(n,r){return t(n,r,e)?!1:(i=!1,!0)}var i=!0;return r(n,e),i}var r=t("./some"),s=t("./auto");e.exports=s(i)},{"./auto":42,"./some":79}],50:[function(t,e,n){function i(t,e){var n={};return r(function(t){n[t[e]]=t},t),n}var r=t("./each"),s=t("./auto");e.exports=s(i)},{"./auto":42,"./each":48}],51:[function(t,e,n){function i(t,e){try{return t()}catch(n){return e(n)}}var r=t("./auto");e.exports=r(i)},{"./auto":42}],52:[function(t,e,n){function i(t,e){function n(n,r){t(n,r,e)&&i.push(n)}var i=[];return r(n,e),i}var r=t("./each"),s=t("./auto");e.exports=s(i)},{"./auto":42,"./each":48}],53:[function(t,e,n){function i(t,e){var n;return r(function(i,r){return t(i,r,e)?(n=i,!0):!1},e),n}var r=t("./some"),s=t("./auto");e.exports=s(i)},{"./auto":42,"./some":79}],54:[function(t,e,n){function i(t){return function(){return r(t,s(arguments).reverse())}}var r=t("./apply"),s=t("./toArray");e.exports=i},{"./apply":40,"./toArray":83}],55:[function(t,e,n){function i(t){return Function.prototype.call.bind(t)}e.exports=i},{}],56:[function(t,e,n){function i(t){return s(r,t)}var r=t("./at"),s=t("./bind");e.exports=i},{"./at":41,"./bind":43}],57:[function(t,e,n){function i(t,e){return r(function(t,n){return e===n},t)||!1}var r=t("./some"),s=t("./auto");e.exports=s(i)},{"./auto":42,"./some":79}],58:[function(t,e,n){function i(t){return t}e.exports=i},{}],59:[function(t,e,n){e.exports={add:t("./add"),apply:t("./apply"),at:t("./at"),auto:t("./auto"),bind:t("./bind"),call:t("./call"),contains:t("./contains"),divide:t("./divide"),each:t("./each"),every:t("./every"),expose:t("./expose"),fallback:t("./fallback"),filter:t("./filter"),find:t("./find"),flip:t("./flip"),free:t("./free"),getter:t("./getter"),has:t("./has"),id:t("./id"),join:t("./join"),keys:t("./keys"),loop:t("./loop"),map:t("./map"),mod:t("./mod"),multiply:t("./multiply"),not:t("./not"),partial:t("./partial"),picker:t("./picker"),pipe:t("./pipe"),compose:t("./compose"),pluck:t("./pluck"),privatize:t("./privatize"),put:t("./put"),putter:t("./putter"),reduce:t("./reduce"),repeat:t("./repeat"),reverse:t("./reverse"),setter:t("./setter"),slice:t("./slice"),some:t("./some"),sort:t("./sort"),split:t("./split"),subtract:t("./subtract"),toArray:t("./toArray"),values:t("./values")}},{"./add":39,"./apply":40,"./at":41,"./auto":42,"./bind":43,"./call":44,"./compose":45,"./contains":46,"./divide":47,"./each":48,"./every":49,"./expose":50,"./fallback":51,"./filter":52,"./find":53,"./flip":54,"./free":55,"./getter":56,"./has":57,"./id":58,"./join":60,"./keys":61,"./loop":62,"./map":63,"./mod":64,"./multiply":65,"./not":66,"./partial":67,"./picker":68,"./pipe":69,"./pluck":70,"./privatize":71,"./put":72,"./putter":73,"./reduce":74,"./repeat":75,"./reverse":76,"./setter":77,"./slice":78,"./some":79,"./sort":80,"./split":81,"./subtract":82,"./toArray":83,"./values":84}],60:[function(t,e,n){function i(t,e){return arguments.length<2&&(e=""),u(t)?a(t,e):o(function(t,n){return t+""+e+n},t,"")}var r=t("./free"),s=t("./auto"),o=t("./reduce"),u=t("enjoy-typechecks").isArrayLike,a=r(Array.prototype.join);e.exports=s(i)},{"./auto":42,"./free":55,"./reduce":74,"enjoy-typechecks":85}],61:[function(t,e,n){function i(t){return r(function(t,e){return e},t)}var r=t("./map");e.exports=i},{"./map":63}],62:[function(t,e,n){function i(t){for(;t(););}e.exports=i},{}],63:[function(t,e,n){function i(t,e){var n=[];return r(function(i,r){n.push(t(i,r,e))},e),n}var r=t("./each"),s=t("./auto");e.exports=s(i)},{"./auto":42,"./each":48}],64:[function(t,e,n){function i(){return Array.prototype.reduce.call(arguments,function(t,e){return t%e})}var r=t("./auto");e.exports=r(i,2)},{"./auto":42}],65:[function(t,e,n){function i(){return Array.prototype.reduce.call(arguments,function(t,e){return t*e})}var r=t("./auto");e.exports=r(i,2)},{"./auto":42}],66:[function(t,e,n){function i(t){return!t}e.exports=i},{}],67:[function(t,e,n){function i(t){var e=Array.prototype.slice.call(arguments,1);return function(){var n=Array.prototype.slice.call(arguments),i=e.map(function(t){return"undefined"==typeof t?n.shift():t});return n.length&&n.forEach(function(t){i.push(t)}),r(t,i)}}var r=t("./apply");e.exports=i},{"./apply":40}],68:[function(t,e,n){function i(t){return s(r,void 0,t)}var r=t("./at"),s=t("./partial");e.exports=i},{"./at":41,"./partial":67}],69:[function(t,e,n){function i(t){return r(function(e,n){n>0&&(t=e(t))},arguments),t}var r=t("./each"),s=t("./auto");e.exports=s(i,2)},{"./auto":42,"./each":48}],70:[function(t,e,n){function i(t,e){var n=[];return r(function(t){(e in t||Array.isArray(t)&&e<t.length)&&n.push(t[e])},t),n}var r=t("./map"),s=t("./auto");e.exports=s(i)},{"./auto":42,"./map":63}],71:[function(t,e,n){function i(t,e){var n=[];return r(function(t,i){t[e]=i,n.push(t)},t),n}var r=t("./each"),s=t("./auto");e.exports=s(i)},{"./auto":42,"./each":48}],72:[function(t,e,n){function i(t,e,n){t[e]=n}var r=t("./auto");e.exports=r(i)},{"./auto":42}],73:[function(t,e,n){function i(t){return s(r,void 0,t,void 0)}var r=t("./put"),s=t("./partial");e.exports=i},{"./partial":67,"./put":72}],74:[function(t,e,n){function i(t,e,n){var i=arguments.length>2;return o(e)?i?Array.prototype.reduce.call(e,t,n):Array.prototype.reduce.call(e,t):(r(function(r,s){return i?void(n=t(n,r,s,e)):(i=!0,void(n=r))},e),n)}var r=t("./each"),s=t("./auto"),o=t("enjoy-typechecks").isArrayLike;e.exports=s(i)},{"./auto":42,"./each":48,"enjoy-typechecks":85}],75:[function(t,e,n){function i(t,e){for(var n=0;e>n;n+=1)t()}var r=t("./auto");e.exports=r(i)},{"./auto":42}],76:[function(t,e,n){var i=t("./free"),r=t("./slice"),s=t("./compose");e.exports=s(r,i(Array.prototype.reverse))},{"./compose":45,"./free":55,"./slice":78}],77:[function(t,e,n){function i(t){return s(r,t)}var r=t("./put"),s=t("./bind");e.exports=i},{"./bind":43,"./put":72}],78:[function(t,e,n){var i=t("./free");e.exports=i(Array.prototype.slice)},{"./free":55}],79:[function(t,e,n){function i(t,e){return u.isArrayLike(e)?a(e,t):r(t,e)}function r(t,e){return Object.keys(e).some(function(n){return t(e[n],n,e)})}var s=t("./auto"),o=t("./free"),u=t("enjoy-typechecks"),a=o(Array.prototype.some);e.exports=s(i)},{"./auto":42,"./free":55,"enjoy-typechecks":85}],80:[function(t,e,n){var i=t("./free"),r=t("./slice"),s=t("./compose");e.exports=s(r,i(Array.prototype.sort))},{"./compose":45,"./free":55,"./slice":78}],81:[function(t,e,n){var i=t("./free");e.exports=i(String.prototype.split)},{"./free":55}],82:[function(t,e,n){function i(){return Array.prototype.reduce.call(arguments,function(t,e){return t-e})}var r=t("./auto");e.exports=r(i,2)},{"./auto":42}],83:[function(t,e,n){function i(t){return Array.prototype.slice.call(t)}e.exports=i},{}],84:[function(t,e,n){function i(t){return r(s,t)}var r=t("./map"),s=t("./id");e.exports=i},{"./id":58,"./map":63}],85:[function(t,e,n){function i(t){return null===t}function r(t){return"undefined"==typeof t}function s(t){return"boolean"==typeof t}function o(t){return"number"==typeof t}function u(t){return o(t)&&isFinite(t)}function a(t){return o(t)&&!isFinite(t)}function c(t){return l(t)||d(t)}function l(t){return t===Number.POSITIVE_INFINITY}function d(t){return t===Number.NEGATIVE_INFINITY}function f(t){return t!==t}function p(t){return u(t)&&t%1===0}function h(t){return u(t)&&t%1!==0}function m(t){return"string"==typeof t}function g(t){return m(t)&&1===t.length}function y(t){return b(t)||v(t)}function b(t){return"object"==typeof t&&null!==t}function v(t){return Array.isArray(t)}function w(t){return v(t)||m(t)||b(t)&&"length"in t&&u(t.length)&&(t.length>0&&t.length-1 in t||0===t.length)}function E(t){return"function"==typeof t}function S(t){return i(t)||r(t)||o(t)||m(t)||s(t)}function _(t){return b(t)&&"[object Date]"===Object.prototype.toString.call(t)}function A(t){return b(t)&&"[object RegExp]"===Object.prototype.toString.call(t)}function x(t){return b(t)&&"[object Error]"===Object.prototype.toString.call(t)}function k(t){return b(t)&&"[object Arguments]"===Object.prototype.toString.call(t)}function T(t){return t===Math}function O(t){return W(t)&&"type"===t.$__type__&&E(t.$__checker__)}function W(t){return b(t)&&"$__children__"in t&&Array.isArray(t.$__children__)}function M(t){return E(t)&&"method"===t.$__type__&&E(t.$__default__)&&v(t.$__implementations__)&&v(t.$__dispatchers__)}e.exports={isArgumentsObject:k,isArray:v,isArrayLike:w,isBoolean:s,isChar:g,isCollection:y,isDate:_,isDerivable:W,isError:x,isFiniteNumber:u,isFloat:h,isFunction:E,isInfiniteNumber:a,isInfinity:c,isInteger:p,isMathObject:T,isMethod:M,isNaN:f,isNegativeInfinity:d,isNull:i,isNumber:o,isPositiveInfinity:l,isPrimitive:S,isRegExp:A,isString:m,isType:O,isUndefined:r}},{}],86:[function(t,e,n){!function(){var t={},e=null,i=!0,r=!1;try{"undefined"!=typeof AudioContext?e=new AudioContext:"undefined"!=typeof webkitAudioContext?e=new webkitAudioContext:i=!1}catch(s){i=!1}if(!i)if("undefined"!=typeof Audio)try{new Audio}catch(s){r=!0}else r=!0;if(i){var o="undefined"==typeof e.createGain?e.createGainNode():e.createGain();o.gain.value=1,o.connect(e.destination)}var u=function(t){this._volume=1,this._muted=!1,this.usingWebAudio=i,this.ctx=e,this.noAudio=r,this._howls=[],this._codecs=t,this.iOSAutoEnable=!0};u.prototype={volume:function(t){var e=this;if(t=parseFloat(t),t>=0&&1>=t){e._volume=t,i&&(o.gain.value=t);for(var n in e._howls)if(e._howls.hasOwnProperty(n)&&e._howls[n]._webAudio===!1)for(var r=0;r<e._howls[n]._audioNode.length;r++)e._howls[n]._audioNode[r].volume=e._howls[n]._volume*e._volume;return e}return i?o.gain.value:e._volume},mute:function(){return this._setMuted(!0),this},unmute:function(){return this._setMuted(!1),this},_setMuted:function(t){var e=this;e._muted=t,i&&(o.gain.value=t?0:e._volume);for(var n in e._howls)if(e._howls.hasOwnProperty(n)&&e._howls[n]._webAudio===!1)for(var r=0;r<e._howls[n]._audioNode.length;r++)e._howls[n]._audioNode[r].muted=t},codecs:function(t){return this._codecs[t]},_enableiOSAudio:function(){var t=this;if(!e||!t._iOSEnabled&&/iPhone|iPad|iPod/i.test(navigator.userAgent)){t._iOSEnabled=!1;var n=function(){var i=e.createBuffer(1,1,22050),r=e.createBufferSource();r.buffer=i,r.connect(e.destination),"undefined"==typeof r.start?r.noteOn(0):r.start(0),setTimeout(function(){(r.playbackState===r.PLAYING_STATE||r.playbackState===r.FINISHED_STATE)&&(t._iOSEnabled=!0,t.iOSAutoEnable=!1,window.removeEventListener("touchend",n,!1))},0)};return window.addEventListener("touchend",n,!1),t}}};var a=null,c={};r||(a=new Audio,c={mp3:!!a.canPlayType("audio/mpeg;").replace(/^no$/,""),opus:!!a.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!a.canPlayType("audio/aac;").replace(/^no$/,""),m4a:!!(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/m4a;")||a.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(a.canPlayType("audio/x-mp4;")||a.canPlayType("audio/mp4;")||a.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")});var l=new u(c),d=function(t){var n=this;n._autoplay=t.autoplay||!1,n._buffer=t.buffer||!1,n._duration=t.duration||0,n._format=t.format||null,n._loop=t.loop||!1,n._loaded=!1,n._sprite=t.sprite||{},n._src=t.src||"",n._pos3d=t.pos3d||[0,0,-.5],n._volume=void 0!==t.volume?t.volume:1,n._urls=t.urls||[],n._rate=t.rate||1,n._model=t.model||null,n._onload=[t.onload||function(){}],n._onloaderror=[t.onloaderror||function(){}],n._onend=[t.onend||function(){}],n._onpause=[t.onpause||function(){}],n._onplay=[t.onplay||function(){}],n._onendTimer=[],n._webAudio=i&&!n._buffer,n._audioNode=[],n._webAudio&&n._setupAudioNode(),"undefined"!=typeof e&&e&&l.iOSAutoEnable&&l._enableiOSAudio(),l._howls.push(n),n.load()};if(d.prototype={load:function(){var t=this,e=null;if(r)return void t.on("loaderror",new Error("No audio support."));for(var n=0;n<t._urls.length;n++){var i,s;if(t._format)i=t._format;else{if(s=t._urls[n],i=/^data:audio\/([^;,]+);/i.exec(s),i||(i=/\.([^.]+)$/.exec(s.split("?",1)[0])),!i)return void t.on("loaderror",new Error("Could not extract format from passed URLs, please add format parameter."));i=i[1].toLowerCase()}if(c[i]){e=t._urls[n];break}}if(!e)return void t.on("loaderror",new Error("No codec support for selected audio sources."));if(t._src=e,t._webAudio)f(t,e);else{var o=new Audio;o.addEventListener("error",function(){o.error&&4===o.error.code&&(u.noAudio=!0),t.on("loaderror",{type:o.error?o.error.code:0})},!1),t._audioNode.push(o),o.src=e,o._pos=0,o.preload="auto",o.volume=l._muted?0:t._volume*l.volume();var a=function(){t._duration=Math.ceil(10*o.duration)/10,0===Object.getOwnPropertyNames(t._sprite).length&&(t._sprite={_default:[0,1e3*t._duration]}),t._loaded||(t._loaded=!0,t.on("load")),t._autoplay&&t.play(),o.removeEventListener("canplaythrough",a,!1)};o.addEventListener("canplaythrough",a,!1),o.load()}return t},urls:function(t){var e=this;return t?(e.stop(),e._urls="string"==typeof t?[t]:t,e._loaded=!1,e.load(),e):e._urls},play:function(t,n){var i=this;return"function"==typeof t&&(n=t),t&&"function"!=typeof t||(t="_default"),i._loaded?i._sprite[t]?(i._inactiveNode(function(r){r._sprite=t;var s=r._pos>0?r._pos:i._sprite[t][0]/1e3,o=0;i._webAudio?(o=i._sprite[t][1]/1e3-r._pos,r._pos>0&&(s=i._sprite[t][0]/1e3+s)):o=i._sprite[t][1]/1e3-(s-i._sprite[t][0]/1e3);var u,a=!(!i._loop&&!i._sprite[t][2]),c="string"==typeof n?n:Math.round(Date.now()*Math.random())+"";if(function(){var e={id:c,sprite:t,loop:a};u=setTimeout(function(){!i._webAudio&&a&&i.stop(e.id).play(t,e.id),i._webAudio&&!a&&(i._nodeById(e.id).paused=!0,i._nodeById(e.id)._pos=0,i._clearEndTimer(e.id)),i._webAudio||a||i.stop(e.id),i.on("end",c)},o/i._rate*1e3),i._onendTimer.push({timer:u,id:e.id})}(),i._webAudio){var d=i._sprite[t][0]/1e3,f=i._sprite[t][1]/1e3;r.id=c,r.paused=!1,m(i,[a,d,f],c),i._playStart=e.currentTime,r.gain.value=i._volume,"undefined"==typeof r.bufferSource.start?a?r.bufferSource.noteGrainOn(0,s,86400):r.bufferSource.noteGrainOn(0,s,o):a?r.bufferSource.start(0,s,86400):r.bufferSource.start(0,s,o)}else{if(4!==r.readyState&&(r.readyState||!navigator.isCocoonJS))return i._clearEndTimer(c),function(){var e=i,s=t,o=n,u=r,a=function(){e.play(s,o),u.removeEventListener("canplaythrough",a,!1)};u.addEventListener("canplaythrough",a,!1)}(),i;r.readyState=4,r.id=c,r.currentTime=s,r.muted=l._muted||r.muted,r.volume=i._volume*l.volume(),setTimeout(function(){r.play()},0)}return i.on("play"),"function"==typeof n&&n(c),i}),i):("function"==typeof n&&n(),i):(i.on("load",function(){i.play(t,n)}),i)},pause:function(t){var e=this;if(!e._loaded)return e.on("play",function(){e.pause(t)}),e;e._clearEndTimer(t);var n=t?e._nodeById(t):e._activeNode();if(n)if(n._pos=e.pos(null,t),
e._webAudio){if(!n.bufferSource||n.paused)return e;n.paused=!0,"undefined"==typeof n.bufferSource.stop?n.bufferSource.noteOff(0):n.bufferSource.stop(0)}else n.pause();return e.on("pause"),e},stop:function(t){var e=this;if(!e._loaded)return e.on("play",function(){e.stop(t)}),e;e._clearEndTimer(t);var n=t?e._nodeById(t):e._activeNode();if(n)if(n._pos=0,e._webAudio){if(!n.bufferSource||n.paused)return e;n.paused=!0,"undefined"==typeof n.bufferSource.stop?n.bufferSource.noteOff(0):n.bufferSource.stop(0)}else isNaN(n.duration)||(n.pause(),n.currentTime=0);return e},mute:function(t){var e=this;if(!e._loaded)return e.on("play",function(){e.mute(t)}),e;var n=t?e._nodeById(t):e._activeNode();return n&&(e._webAudio?n.gain.value=0:n.muted=!0),e},unmute:function(t){var e=this;if(!e._loaded)return e.on("play",function(){e.unmute(t)}),e;var n=t?e._nodeById(t):e._activeNode();return n&&(e._webAudio?n.gain.value=e._volume:n.muted=!1),e},volume:function(t,e){var n=this;if(t=parseFloat(t),t>=0&&1>=t){if(n._volume=t,!n._loaded)return n.on("play",function(){n.volume(t,e)}),n;var i=e?n._nodeById(e):n._activeNode();return i&&(n._webAudio?i.gain.value=t:i.volume=t*l.volume()),n}return n._volume},loop:function(t){var e=this;return"boolean"==typeof t?(e._loop=t,e):e._loop},sprite:function(t){var e=this;return"object"==typeof t?(e._sprite=t,e):e._sprite},pos:function(t,n){var i=this;if(!i._loaded)return i.on("load",function(){i.pos(t)}),"number"==typeof t?i:i._pos||0;t=parseFloat(t);var r=n?i._nodeById(n):i._activeNode();if(r)return t>=0?(i.pause(n),r._pos=t,i.play(r._sprite,n),i):i._webAudio?r._pos+(e.currentTime-i._playStart):r.currentTime;if(t>=0)return i;for(var s=0;s<i._audioNode.length;s++)if(i._audioNode[s].paused&&4===i._audioNode[s].readyState)return i._webAudio?i._audioNode[s]._pos:i._audioNode[s].currentTime},pos3d:function(t,e,n,i){var r=this;if(e="undefined"!=typeof e&&e?e:0,n="undefined"!=typeof n&&n?n:-.5,!r._loaded)return r.on("play",function(){r.pos3d(t,e,n,i)}),r;if(!(t>=0||0>t))return r._pos3d;if(r._webAudio){var s=i?r._nodeById(i):r._activeNode();s&&(r._pos3d=[t,e,n],s.panner.setPosition(t,e,n),s.panner.panningModel=r._model||"HRTF")}return r},fade:function(t,e,n,i,r){var s=this,o=Math.abs(t-e),u=t>e?"down":"up",a=o/.01,c=n/a;if(!s._loaded)return s.on("load",function(){s.fade(t,e,n,i,r)}),s;s.volume(t,r);for(var l=1;a>=l;l++)!function(){var t=s._volume+("up"===u?.01:-.01)*l,n=Math.round(1e3*t)/1e3,o=e;setTimeout(function(){s.volume(n,r),n===o&&i&&i()},c*l)}()},fadeIn:function(t,e,n){return this.volume(0).play().fade(0,t,e,n)},fadeOut:function(t,e,n,i){var r=this;return r.fade(r._volume,t,e,function(){n&&n(),r.pause(i),r.on("end")},i)},_nodeById:function(t){for(var e=this,n=e._audioNode[0],i=0;i<e._audioNode.length;i++)if(e._audioNode[i].id===t){n=e._audioNode[i];break}return n},_activeNode:function(){for(var t=this,e=null,n=0;n<t._audioNode.length;n++)if(!t._audioNode[n].paused){e=t._audioNode[n];break}return t._drainPool(),e},_inactiveNode:function(t){for(var e=this,n=null,i=0;i<e._audioNode.length;i++)if(e._audioNode[i].paused&&4===e._audioNode[i].readyState){t(e._audioNode[i]),n=!0;break}if(e._drainPool(),!n){var r;if(e._webAudio)r=e._setupAudioNode(),t(r);else{e.load(),r=e._audioNode[e._audioNode.length-1];var s=navigator.isCocoonJS?"canplaythrough":"loadedmetadata",o=function(){r.removeEventListener(s,o,!1),t(r)};r.addEventListener(s,o,!1)}}},_drainPool:function(){var t,e=this,n=0;for(t=0;t<e._audioNode.length;t++)e._audioNode[t].paused&&n++;for(t=e._audioNode.length-1;t>=0&&!(5>=n);t--)e._audioNode[t].paused&&(e._webAudio&&e._audioNode[t].disconnect(0),n--,e._audioNode.splice(t,1))},_clearEndTimer:function(t){for(var e=this,n=-1,i=0;i<e._onendTimer.length;i++)if(e._onendTimer[i].id===t){n=i;break}var r=e._onendTimer[n];r&&(clearTimeout(r.timer),e._onendTimer.splice(n,1))},_setupAudioNode:function(){var t=this,n=t._audioNode,i=t._audioNode.length;return n[i]="undefined"==typeof e.createGain?e.createGainNode():e.createGain(),n[i].gain.value=t._volume,n[i].paused=!0,n[i]._pos=0,n[i].readyState=4,n[i].connect(o),n[i].panner=e.createPanner(),n[i].panner.panningModel=t._model||"equalpower",n[i].panner.setPosition(t._pos3d[0],t._pos3d[1],t._pos3d[2]),n[i].panner.connect(n[i]),n[i]},on:function(t,e){var n=this,i=n["_on"+t];if("function"==typeof e)i.push(e);else for(var r=0;r<i.length;r++)e?i[r].call(n,e):i[r].call(n);return n},off:function(t,e){var n=this,i=n["_on"+t];if(e){for(var r=0;r<i.length;r++)if(e===i[r]){i.splice(r,1);break}}else n["_on"+t]=[];return n},unload:function(){for(var e=this,n=e._audioNode,i=0;i<e._audioNode.length;i++)n[i].paused||(e.stop(n[i].id),e.on("end",n[i].id)),e._webAudio?n[i].disconnect(0):n[i].src="";for(i=0;i<e._onendTimer.length;i++)clearTimeout(e._onendTimer[i].timer);var r=l._howls.indexOf(e);null!==r&&r>=0&&l._howls.splice(r,1),delete t[e._src],e=null}},i)var f=function(e,n){if(n in t)return e._duration=t[n].duration,void h(e);if(/^data:[^;]+;base64,/.test(n)){for(var i=atob(n.split(",")[1]),r=new Uint8Array(i.length),s=0;s<i.length;++s)r[s]=i.charCodeAt(s);p(r.buffer,e,n)}else{var o=new XMLHttpRequest;o.open("GET",n,!0),o.responseType="arraybuffer",o.onload=function(){p(o.response,e,n)},o.onerror=function(){e._webAudio&&(e._buffer=!0,e._webAudio=!1,e._audioNode=[],delete e._gainNode,delete t[n],e.load())};try{o.send()}catch(u){o.onerror()}}},p=function(n,i,r){e.decodeAudioData(n,function(e){e&&(t[r]=e,h(i,e))},function(t){i.on("loaderror",t)})},h=function(t,e){t._duration=e?e.duration:t._duration,0===Object.getOwnPropertyNames(t._sprite).length&&(t._sprite={_default:[0,1e3*t._duration]}),t._loaded||(t._loaded=!0,t.on("load")),t._autoplay&&t.play()},m=function(n,i,r){var s=n._nodeById(r);s.bufferSource=e.createBufferSource(),s.bufferSource.buffer=t[n._src],s.bufferSource.connect(s.panner),s.bufferSource.loop=i[0],i[0]&&(s.bufferSource.loopStart=i[1],s.bufferSource.loopEnd=i[1]+i[2]),s.bufferSource.playbackRate.value=n._rate};"function"==typeof define&&define.amd&&define(function(){return{Howler:l,Howl:d}}),"undefined"!=typeof n&&(n.Howler=l,n.Howl=d),"undefined"!=typeof window&&(window.Howler=l,window.Howl=d)}()},{}],87:[function(t,e,n){function i(t){return o+t}function r(t){return t.replace(new RegExp(o),"")}function s(t){var e;if(this.clear(),t)for(e in t)this.set(e,t[e])}var o="string-dict_";s.prototype.clear=function(){this.items={},this.count=0},s.prototype.length=function(){return this.count},s.prototype.set=function(t,e){var n=i(t);if(!t)throw new Error("Dictionary keys cannot be falsy.");return this.has(n)&&this.remove(n),this.items[n]=e,this.count+=1,this},s.prototype.get=function(t){var e=i(t);return this.items.hasOwnProperty(e)?this.items[e]:void 0},s.prototype.require=function(t){if(!this.has(t))throw new Error("Required key '"+t+"' does not exist.");return this.get(t)},s.prototype.remove=function(t){var e=i(t);return this.has(t)&&(delete this.items[e],this.count-=1),this},s.prototype.has=function(t){var e=i(t);return this.items.hasOwnProperty(e)},s.prototype.forEach=function(t){if(!t||"function"!=typeof t)throw new Error("Argument 1 is expected to be of type function.");for(var e in this.items)t(this.items[e],r(e),this);return this},s.prototype.filter=function(t){var e=new s;return this.forEach(function(n,i,r){t(n,i,r)&&e.set(i,n)}),e},s.prototype.find=function(t){var e;return this.some(function(n,i,r){return t(n,i,r)?(e=n,!0):!1}),e},s.prototype.map=function(t){var e=new s;return this.forEach(function(n,i,r){e.set(i,t(n,i,r))}),e},s.prototype.reduce=function(t,e){var n=e;return this.forEach(function(e,i,r){n=t(n,e,i,r)}),n},s.prototype.every=function(t){return this.reduce(function(e,n,i,r){return e&&t(n,i,r)},!0)},s.prototype.some=function(t){for(var e in this.items)if(t(this.items[e],r(e),this))return!0;return!1},s.prototype.keys=function(){var t=[];return this.forEach(function(e,n){t.push(n)}),t},s.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},s.prototype.toObject=function(){var t={};return this.forEach(function(e,n){t[n]=e}),t},s.prototype.clone=function(){var t=new s;return this.forEach(function(e,n){t.set(n,e)}),t},s.prototype.addMap=function(t){var e=this;return t.forEach(function(t,n){e.set(n,t)}),this},s.prototype.join=function(t){return this.clone().addMap(t)},e.exports=s},{}],88:[function(t,e,n){function i(t,e,n,i,r){function u(){g="undefined"!=typeof i.duration&&i.duration>=0?i.duration:500,b=t,v=e-t,w=0,E=0,S=i.fps||60,_=!1,A=!1,x=!1,k=!1,T=0,O=0,W=0,M=0,y=s.linear,i.easing&&(y="function"==typeof i.easing?i.easing:s[i.easing])}function a(){var e,i;if(x){if(Date.now()-E>1e3/S){if(_||A)return;if(w+=1,i=c(),i>g||k)return b=t+v,void(k||d());b=y(i/g)*v+t,n(b),e=c()-i,E=Date.now()}o(a)}}function c(){return x&&!A&&(T=+new Date-O-W),T}function l(){m(),O=+new Date,M=O,x=!0,o(a)}function d(){x=!1,A=!1,n(e),r()}function f(){A&&(A=!1,W+=+new Date-M,o(a))}function p(){A=!0,M=+new Date}function h(){x&&(c(),_=!0,x=!1,A=!1,r())}function m(){x&&h(),u()}var g,y,b,v,w,E,S,_,A,x,k,T,O,W,M;if(i=i||{},"function"!=typeof i||r||(r=i,i={}),r="function"==typeof r?r:function(){},"undefined"==typeof n||!n)throw new Error("Argument callback must be a function.");return u(),{start:l,stop:d,pause:p,resume:f,cancel:h,elapsed:c,reset:m}}function r(){var t=i.apply(void 0,arguments);return t.start(),t}var s=t("eases");if("undefined"==typeof o)var o=function(t){setTimeout(t,1e3/60)};e.exports={transformation:i,transform:r}},{eases:107}],89:[function(t,e,n){arguments[4][5][0].apply(n,arguments)},{dup:5}],90:[function(t,e,n){arguments[4][6][0].apply(n,arguments)},{dup:6}],91:[function(t,e,n){arguments[4][7][0].apply(n,arguments)},{dup:7}],92:[function(t,e,n){arguments[4][8][0].apply(n,arguments)},{"./bounce-out":94,dup:8}],93:[function(t,e,n){arguments[4][9][0].apply(n,arguments)},{"./bounce-out":94,dup:9}],94:[function(t,e,n){arguments[4][10][0].apply(n,arguments)},{dup:10}],95:[function(t,e,n){arguments[4][11][0].apply(n,arguments)},{dup:11}],96:[function(t,e,n){arguments[4][12][0].apply(n,arguments)},{dup:12}],97:[function(t,e,n){arguments[4][13][0].apply(n,arguments)},{dup:13}],98:[function(t,e,n){arguments[4][14][0].apply(n,arguments)},{dup:14}],99:[function(t,e,n){arguments[4][15][0].apply(n,arguments)},{dup:15}],100:[function(t,e,n){arguments[4][16][0].apply(n,arguments)},{dup:16}],101:[function(t,e,n){arguments[4][17][0].apply(n,arguments)},{dup:17}],102:[function(t,e,n){arguments[4][18][0].apply(n,arguments)},{dup:18}],103:[function(t,e,n){arguments[4][19][0].apply(n,arguments)},{dup:19}],104:[function(t,e,n){arguments[4][20][0].apply(n,arguments)},{dup:20}],105:[function(t,e,n){arguments[4][21][0].apply(n,arguments)},{dup:21}],106:[function(t,e,n){arguments[4][22][0].apply(n,arguments)},{dup:22}],107:[function(t,e,n){arguments[4][23][0].apply(n,arguments)},{"./back-in":90,"./back-in-out":89,"./back-out":91,"./bounce-in":93,"./bounce-in-out":92,"./bounce-out":94,"./circ-in":96,"./circ-in-out":95,"./circ-out":97,"./cubic-in":99,"./cubic-in-out":98,"./cubic-out":100,"./elastic-in":102,"./elastic-in-out":101,"./elastic-out":103,"./expo-in":105,"./expo-in-out":104,"./expo-out":106,"./linear":108,"./quad-in":110,"./quad-in-out":109,"./quad-out":111,"./quart-in":113,"./quart-in-out":112,"./quart-out":114,"./quint-in":116,"./quint-in-out":115,"./quint-out":117,"./sine-in":119,"./sine-in-out":118,"./sine-out":120,dup:23}],108:[function(t,e,n){arguments[4][24][0].apply(n,arguments)},{dup:24}],109:[function(t,e,n){arguments[4][25][0].apply(n,arguments)},{dup:25}],110:[function(t,e,n){arguments[4][26][0].apply(n,arguments)},{dup:26}],111:[function(t,e,n){arguments[4][27][0].apply(n,arguments)},{dup:27}],112:[function(t,e,n){arguments[4][28][0].apply(n,arguments)},{dup:28}],113:[function(t,e,n){arguments[4][29][0].apply(n,arguments)},{dup:29}],114:[function(t,e,n){arguments[4][30][0].apply(n,arguments)},{dup:30}],115:[function(t,e,n){arguments[4][31][0].apply(n,arguments)},{dup:31}],116:[function(t,e,n){arguments[4][32][0].apply(n,arguments)},{dup:32}],117:[function(t,e,n){arguments[4][33][0].apply(n,arguments)},{dup:33}],118:[function(t,e,n){arguments[4][34][0].apply(n,arguments)},{dup:34}],119:[function(t,e,n){arguments[4][35][0].apply(n,arguments)},{dup:35}],120:[function(t,e,n){arguments[4][36][0].apply(n,arguments)},{dup:36}],121:[function(t,e,n){e.exports=t("./src/xmugly.js")},{"./src/xmugly.js":122}],122:[function(t,e,n){!function(){function t(t,e){var r=[],c=n(t),l=s(c);return Array.isArray(e)&&e.forEach(function(t){l.push(t)}),c=u(c),c=c.map(function(t,e){var n,i,s,u,c,d,f,p,h;if(u=t.trim(),f=[],d=t.replace(/^([\s]*).*$/,"$1"),"--"===u){if(!r.length)throw new SyntaxError("Closing '--' without matching opening tag on line "+(e+1));return d+"</"+r.pop()+">"}return"."!==u[0]?t:(u=u.replace(/"([^"]+)"/g,function(t,e){return f.push(e),"{{"+f.length+"}}"}),":"===u[u.length-1]&&(h=!0,u=u.replace(/:$/,"")),s=u.split(","),c=s[0].split(" "),c.shift(),n=c[0],h&&r.push(n),c.shift(),s[0]=c.join(" "),i=[],s.forEach(function(t){var e,n,r,s;e=a(t).split(" "),n=e[0].trim(),n&&(s=o(n,l),s?(r=s.value,n=s.name):(e.shift(),r=e.join(" ")),i.push(n+'="'+r+'"'))}),p=d+"<"+n+(i.length?" ":"")+i.join(" ")+(h?">":" />"),f.forEach(function(t,e){p=p.replace("{{"+(e+1)+"}}",t)}),p)}),i(c)}function n(t){return t.split("\n")}function i(t){return t.join("\n")}function r(t){var e=a(t).split(" ");return e.shift(),{identifier:e[0],attribute:e[1],value:e[2]}}function s(t){var e=[];return t.forEach(function(t){"~"===t.trim()[0]&&e.push(r(t))}),e}function o(t,e){var n,i;return e.some(function(e){var r;return t[0]!==e.identifier?!1:(r=t.replace(e.identifier,""),n="_"===e.attribute?r:e.attribute,i="_"===e.value?r:e.value,!0)}),n?{name:n,value:i}:null}function u(t){return t.filter(function(t){return"~"!==t.trim()[0]})}function a(t){return t.trim().replace(/[\s]+/g," ")}"undefined"!=typeof e?e.exports={compile:t}:window.xmugly={compile:t}}()},{}]},{},[1]),"undefined"!=typeof window&&(window.requestAnimationFrame=function(){"use strict";return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}()),function(){Array.prototype.forEach||(Array.prototype.forEach=function(t){for(var e=0,n=this.length;n>e;e+=1)t(this[e],e,this)})}(),function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){var n;if(null==this)throw new TypeError('"this" is null or not defined');var i=Object(this),r=i.length>>>0;if(0===r)return-1;var s=+e||0;if(Math.abs(s)===1/0&&(s=0),s>=r)return-1;for(n=Math.max(s>=0?s:r-Math.abs(s),0);r>n;){if(n in i&&i[n]===t)return n;n++}return-1})}(),"undefined"==typeof console&&(this.console={}),console.log||(console.log=function(){}),console.dir||(console.dir=console.log),console.error||(console.error=console.log),console.warn||(console.warn=console.log),function(){var t=document.getElementsByTagName("script"),e=t[t.length-1].src.replace(/MO5\.js$/,"");using.modules={"MO5.ajax":e+"ajax.js","MO5.assert":e+"assert.js","MO5.Exception":e+"Exception.js","MO5.fail":e+"fail.js","MO5.EventBus":e+"EventBus.js","MO5.CoreObject":e+"CoreObject.js","MO5.List":e+"List.js","MO5.Queue":e+"Queue.js","MO5.Map":e+"Map.js","MO5.Set":e+"Set.js","MO5.Result":e+"Result.js","MO5.Promise":e+"Promise.js","MO5.Timer":e+"Timer.js","MO5.TimerWatcher":e+"TimerWatcher.js","MO5.easing":e+"easing.js","MO5.transform":e+"transform.js","MO5.range":e+"range.js","MO5.tools":e+"tools.js","MO5.Point":e+"Point.js","MO5.Size":e+"Size.js","MO5.Animation":e+"Animation.js","MO5.dom.effects.typewriter":e+"dom.effects.typewriter.js","MO5.dom.Element":e+"dom.Element.js","MO5.dom.escape":e+"dom.escape.js","MO5.globals.document":e+"globals.document.js","MO5.globals.window":e+"globals.window.js","MO5.types":e+"types.js"}}();var $__WSEScripts=document.getElementsByTagName("script");WSEPath=$__WSEScripts[$__WSEScripts.length-1].src,using.modules["MO5.ajax"]=WSEPath,using.modules["MO5.Animation"]=WSEPath,using.modules["MO5.assert"]=WSEPath,using.modules["MO5.CoreObject"]=WSEPath,using.modules["MO5.dom.effects.typewriter"]=WSEPath,using.modules["MO5.dom.Element"]=WSEPath,using.modules["MO5.dom.escape"]=WSEPath,using.modules["MO5.easing"]=WSEPath,using.modules["MO5.EventBus"]=WSEPath,using.modules["MO5.Exception"]=WSEPath,using.modules["MO5.fail"]=WSEPath,using.modules["MO5.globals.document"]=WSEPath,using.modules["MO5.globals.window"]=WSEPath,using.modules["MO5.List"]=WSEPath,using.modules["MO5.Map"]=WSEPath,using.modules["MO5.Point"]=WSEPath,using.modules["MO5.Promise"]=WSEPath,using.modules["MO5.Queue"]=WSEPath,using.modules["MO5.range"]=WSEPath,using.modules["MO5.Result"]=WSEPath,using.modules["MO5.Set"]=WSEPath,using.modules["MO5.Size"]=WSEPath,using.modules["MO5.Timer"]=WSEPath,using.modules["MO5.TimerWatcher"]=WSEPath,using.modules["MO5.tools"]=WSEPath,using.modules["MO5.transform"]=WSEPath,using.modules["MO5.types"]=WSEPath,using.modules["WSE.assets"]=WSEPath,using.modules["WSE.commands"]=WSEPath,using.modules["WSE.functions"]=WSEPath,using.modules["WSE.dataSources"]=WSEPath,using.modules.WSE=WSEPath,using.modules["WSE.Keys"]=WSEPath,using.modules["WSE.tools"]=WSEPath,using.modules["WSE.loader"]=WSEPath,using.modules["WSE.dataSources.LocalStorage"]=WSEPath,using.modules["WSE.Trigger"]=WSEPath,using.modules["WSE.Game"]=WSEPath,using.modules["WSE.Interpreter"]=WSEPath,using.modules["WSE.LoadingScreen"]=WSEPath,using.modules["WSE.tools.ui"]=WSEPath,using.modules["WSE.tools.reveal"]=WSEPath,using.modules["WSE.tools.compile"]=WSEPath,using.modules["WSE.savegames"]=WSEPath,using.modules["WSE.DisplayObject"]=WSEPath,using.modules["WSE.assets.Animation"]=WSEPath,using.modules["WSE.assets.Audio"]=WSEPath,using.modules["WSE.assets.Character"]=WSEPath,using.modules["WSE.assets.Curtain"]=WSEPath,using.modules["WSE.assets.Imagepack"]=WSEPath,using.modules["WSE.assets.Textbox"]=WSEPath,using.modules["WSE.assets.Background"]=WSEPath,using.modules["WSE.assets.Composite"]=WSEPath,using.modules["WSE.commands.alert"]=WSEPath,using.modules["WSE.commands.break"]=WSEPath,using.modules["WSE.commands.choice"]=WSEPath,using.modules["WSE.commands.confirm"]=WSEPath,using.modules["WSE.commands.do"]=WSEPath,using.modules["WSE.commands.fn"]=WSEPath,using.modules["WSE.commands.global"]=WSEPath,using.modules["WSE.commands.globalize"]=WSEPath,using.modules["WSE.commands.goto"]=WSEPath,using.modules["WSE.commands.line"]=WSEPath,using.modules["WSE.commands.localize"]=WSEPath,using.modules["WSE.commands.prompt"]=WSEPath,using.modules["WSE.commands.restart"]=WSEPath,using.modules["WSE.commands.sub"]=WSEPath,using.modules["WSE.commands.trigger"]=WSEPath,using.modules["WSE.commands.var"]=WSEPath,using.modules["WSE.commands.set_vars"]=WSEPath,using.modules["WSE.commands.wait"]=WSEPath,using.modules["WSE.commands.with"]=WSEPath,using.modules["WSE.commands.while"]=WSEPath,using().define("MO5.ajax",function(){return using.ajax}),function(){function t(t,e,n,i,r){function s(t){if(e.call(this),this.callbacks=new n,this.queue=new n,this.running=!1,this.canceled=!1,this.paused=!1,this.limit=0,this.count=0,this.currentWatcher=null,t&&t instanceof n)this.callbacks=t;else if(t&&t instanceof Array)this.callbacks.replace(t.slice());else if(t)throw new Error("Parameter 1 is expected to be of type Array or MO5.Queue.")}return s.prototype=new e,s.prototype.constructor=s,s.prototype.addStep=function(t){if(this.running)throw new Error("Cannot add steps to a running animation.");return this.callbacks.add(t),this.trigger("updated",null,!1),this},s.prototype.isRunning=function(){return this.running},s.prototype.isCanceled=function(){return this.canceled},s.prototype.isPaused=function(){return this.paused},s.prototype.start=function(){var t,e,n=this;if(this.running)throw new Error("Animation is already running.");return e=this.callbacks.clone(),this.queue=e,this.running=!0,this.canceled=!1,t=function(){var i,s;return e.hasNext()?(i=e.next(),s=i(),void(s&&s instanceof r?(n.currentWatcher=s,s.once(t,"stopped")):setTimeout(t,0))):(n.count+=1,n.isRunning()?n.limit&&n.count==n.limit?(n.running=!1,n.trigger("stopped",null,!1),n.count=0,void(n.limit=0)):(e=n.callbacks.clone(),this.queue=e,void setTimeout(t,0)):void n.trigger("stopped",null,!1))},setTimeout(t,0),this},s.prototype.pause=function(){if(this.paused)throw new Error("Trying to pause an already paused animation.");return this.paused=!0,this.currentWatcher&&this.currentWatcher.pause(),this.trigger("paused",null,!1),this},s.prototype.resume=function(){if(!this.paused)throw new Error("Trying to resume an animation that isn't paused.");return this.paused=!1,this.currentWatcher&&this.currentWatcher.resume(),this.trigger("resumed",null,!1),this},s.prototype.cancel=function(){if(this.canceled)throw new Error("Trying to cancel an already canceled animation.");return this.canceled=!0,this.running=!1,this.count=0,this.limit=0,this.currentWatcher&&this.currentWatcher.cancel(),this.trigger("canceled",null,!1),this},s.prototype.stop=function(){if(!this.running)throw new Error("Trying to stop an animation that isn't running. Check isRunning() beforehand.");return this.running=!1,this.count=0,this.limit=0,this},s.prototype.loop=function(t){if(1>t)throw new Error("Parameter 1 is expected to be greater than zero.");return this.count=0,this.limit=t,this.start()},s.prototype.promise=function(){return i.prototype.promise.call(this)},s}"function"==typeof using?using("MO5.Exception","MO5.CoreObject","MO5.Queue","MO5.Timer","MO5.TimerWatcher").define("MO5.Animation",t):"undefined"!=typeof window?window.MO5.Animation=t(MO5.Exception,MO5.CoreObject,MO5.Queue,MO5.Timer,MO5.TimerWatcher):module.exports=t(require("./Exception.js"),require("./CoreObject.js"),require("./Queue.js"),require("./Timer.js"),require("./TimerWatcher.js"))}(),using("MO5.Exception").define("MO5.assert",function(t){function e(){t.apply(this,arguments),this.name="AssertionException"}function n(t,n){if(!t)throw new e(n)}return e.prototype=new t,n}),function(){function t(t,e,n){function i(t){t=t||{},t.bus=t.bus||{},a+=1,Object.defineProperty?Object.defineProperty(this,"id",{value:a,configurable:!1,enumerable:!1,writable:!1}):this.id=a,this.destroyed=!1,n.inject(this,t.bus),o[this.id]={},this.$children=[],this.$parent=null}function r(t){return u+t}function s(t){return t.replace(new RegExp(u),"")}var o={},u="CoreObject",a=0;return i.hasId=function(t){return"object"==typeof t&&null!==t&&"number"==typeof t.id},i.isCoreObject=function(t){return t instanceof i},i.prototype.addChild=function(t){this.$children.indexOf(t)>=0||(t.$parent=this,this.$children.push(t))},i.prototype.removeChild=function(t){var e=this.$children.indexOf(t);0>e||(t.$parent=null,this.$children.splice(e,1))},i.prototype.hasChild=function(t){return this.$children.indexOf(t)>=0},i.prototype.setFlag=function(t){var e=r(t);if(o[this.id])return o[this.id][e]=!0,this.trigger("flag_set",t),this},i.prototype.removeFlag=function(t){return this.hasFlag(t)?(delete o[this.id][r(t)],this.trigger("flag_removed",t),this):void 0},i.prototype.hasFlag=function(t){var e=r(t);return o[this.id]&&o[this.id].hasOwnProperty(e)},i.prototype.getFlags=function(){var t=[];for(var e in o[this.id])t.push(s(e));return t},i.prototype.connect=function(e,n,r,s){function o(t){t=t||null,"undefined"==typeof s||s!==!0&&s!==!1?n.trigger(r,t):n.trigger(r,t,s)}var u=this;if(e=e||"*",r=r||"*",!(n&&n instanceof i))throw new t("Cannot connect events: Parameter 3 is expected to be of type CoreObject.");return this.subscribe(o,e),n.once(function(){u.unsubscribe(o,e)},"destroyed"),this},i.prototype["implements"]=function(t){for(var e in t)if(typeof this[e]!=typeof t[e])return!1;return!0},i.prototype.toString=function(){return""+this.id},i.prototype.valueOf=function(){return this.id},i.prototype.destroy=function(){var t=this.id;this.$parent&&this.$parent.removeChild(this),this.$children.forEach(function(t){"object"==typeof t&&"function"==typeof t.destroy&&t.destroy()}),this.destroyed=!0,this.trigger("destroyed",null,!1);for(var e in this)this[e]=null;delete o[t],this.destroyed=!0,this.id=t,delete this.toString,delete this.valueOf},i.prototype.subscribeTo=function(e,n,i){function r(){e.unsubscribe(n,i),o.unsubscribe("destroyed",r),e.unsubscribe("destroyed",s)}function s(){e.unsubscribe("destroyed",s),o.unsubscribe("destroyed",r)}var o=this;if("function"!=typeof e.subscribe||"function"!=typeof e.unsubscribe)throw new t("Cannot subscribe: Parameter 1 is expected to be of type CoreObject or EventBus.");if("string"!=typeof n)throw new t("Cannot subscribe: Parameter 2 is expected to be of type String.");if("function"!=typeof i)throw new t("Cannot subscribe: Parameter 3 is expected to be of type Function.");return i=i.bind(this),e.subscribe(n,i),this.subscribe("destroyed",r),e.subscribe("destroyed",s),this},i}"function"==typeof using?using("MO5.Exception","MO5.fail","MO5.EventBus").define("MO5.CoreObject",t):"undefined"!=typeof window?window.MO5.CoreObject=t(MO5.Exception,MO5.fail,MO5.EventBus):module.exports=t(require("./Exception.js"),require("./fail.js"),require("./EventBus.js"))}(),using().define("MO5.dom.effects.typewriter",function(){function t(t,e){function n(t){var e,i,r=t.childNodes;if(t.nodeType===o)for(t.style.display="none",e=0,i=r.length;i>e;e+=1)n(r[e])}function i(t,e){t.nodeType===o?!function(){for(var n=[];t.hasChildNodes();)n.push(t.removeChild(t.firstChild));t.style.display="",function r(){n.length>0?(i(n[0],r),t.appendChild(n.shift())):e&&setTimeout(e,0)}()}():t.nodeType===u&&!function(){function n(){t.data+=o[i],i+=1,s>i?setTimeout(n,1e3/r):e&&setTimeout(e,0)}var i,s,o=t.data.replace(/ +/g," ");t.data="",i=0,s=o.length,n()}()}var r,s,o=1,u=3;e=e||{},r=e.speed||50,s=e.onFinish||null,n(t),i(t,s)}return t}),using("MO5.CoreObject","MO5.transform","MO5.TimerWatcher","MO5.dom.effects.typewriter","MO5.types","MO5.Point","MO5.Size").define("MO5.dom.Element",function(t,e,n,i,r,s,o){function u(e){var n=this;e=e||{},t.call(this),this.parent=e.parent||document.body,this.nodeType=e.nodeType||"div",this.element=e.element||document.createElement(this.nodeType),a(this,this.element),u.propertiesToExclude.forEach(function(t){delete n[t]})}function a(t,e){for(var n in e)!function(n,i){"id"!==i&&("function"==typeof n?t[i]=function(){return e[i].apply(e,arguments)}:t[i]=function(n){return arguments.length?(e[i]=n,t):e[i]})}(e[n],n)}function c(t,e){return-1!==t.indexOf(e)}return u.propertiesToExclude=["appendChild","removeChild"],u.fromDomElement=function(t){return new u({element:t,nodeType:t.nodeName})},u.prototype=new t,u.prototype.constructor=u,u.prototype.appendTo=function(t){return t.appendChild(this.element)},u.prototype.remove=function(){return this.element.parentNode.removeChild(this.element)},u.prototype.appendChild=function(t){var e=t instanceof u?t.element:t;return this.element.appendChild(e)},u.prototype.addAsFirstChild=function(t){var e=t instanceof u?t.element:t;return this.element.childElementCount>0?this.element.insertBefore(e,this.element.childNodes[0]):this.element.appendChild(e)},u.prototype.fadeIn=function(t){t=t||{};var n=this.element;return this._lastFadeTimer&&this._lastFadeTimer.isRunning()&&this._lastFadeTimer.cancel(),this.show(),this._lastFadeTimer=e(function(t){n.style.opacity=t},parseInt(n.style.opacity,10)||0,1,t),this._lastFadeTimer},u.prototype.fadeOut=function(t){t=t||{};var n=this.element;return this._lastFadeTimer&&this._lastFadeTimer.isRunning()&&this._lastFadeTimer.cancel(),this._lastFadeTimer=e(function(t){n.style.opacity=t},parseInt(n.style.opacity,10)||1,0,t),this._lastFadeTimer.once("stopped",this.hide.bind(this)),this._lastFadeTimer},u.prototype.opacity=function(t){return"number"==typeof t&&(this.element.style.opacity=t),this.element.style.opacity},u.prototype.position=function(t){var e,n,i=this.element,o={};return r.isObject(t)&&(i.style.left=""+ +t.x+"px",i.style.top=""+ +t.y+"px"),o.left=i.offsetLeft,o.top=i.offsetTop,i.getBoundingClientRect&&(o=i.getBoundingClientRect()),e=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),n=Math.max(document.documentElement.scrollTop,document.body.scrollTop),new s(e+o.left,n+o.top)},u.prototype.size=function(t){return r.isObject(t)&&(this.element.style.width=""+t.width+"px",this.element.style.height=""+t.height+"px"),new o(this.element.offsetWidth,this.element.offsetHeight)},u.prototype.width=function(t){return r.isNumber(t)&&(this.element.style.width=""+t+"px"),this.element.offsetWidth},u.prototype.height=function(t){return r.isNumber(t)&&(this.element.style.height=""+t+"px"),this.element.offsetHeight},u.prototype.moveTo=function(t,i,r){r=r||{};var s,o,u=this.element,a=u.offsetLeft,c=u.offsetTop;return s=e(function(t){u.style.left=t+"px"},a,t,r),o=e(function(t){u.style.top=t+"px"},c,i,r),(new n).addTimer(s).addTimer(o)},u.prototype.move=function(t,e,n){n=n||{};var i=this.element,r=i.offsetLeft+t,s=i.offsetTop+e;return this.moveTo(r,s,n)},u.prototype.display=function(){this.element.style.visibility=""},u.prototype.show=u.prototype.display,u.prototype.hide=function(){this.element.style.visibility="hidden"},u.prototype.typewriter=function(t){t=t||{},i(this.element,t)},u.prototype.addCssClass=function(t){var e;return this.element.classList?(this.element.classList.add(t),this):(e=this.getCssClasses(),c(e,t)||(e.push(t),this.element.setAttribute("class",e.join(" "))),this)},u.prototype.removeCssClass=function(t){var e;return this.element.classList&&this.element.classList.remove(t),e=this.getCssClasses(),c(e,t)&&this.element.setAttribute("class",e.filter(function(e){return e!==t}).join(" ")),this},u.prototype.getCssClasses=function(){return(this.element.getAttribute("class")||"").split(" ")},u.prototype.hasCssClass=function(t){return this.element.classList?this.element.classList.contains(t):c(this.getCssClasses(),t)},u.prototype.clearCssClasses=function(){return this.element.setAttribute("class",""),this},u.prototype.setCssId=function(t){return this.element.setAttribute("id",t),this},u.prototype.destroy=function(){try{this.element.parentNode.removeChild(this.element)}catch(e){console.log(e)}t.prototype.destroy.call(this)},u}),using().define("MO5.dom.escape",function(){function t(t){var e="";return e=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}return t}),using().define("MO5.easing",function(){function t(t){return function(e){return function(n,i){return r[t](e,n,i)}}}function e(e){return t("easeIn")(e)}function n(e){return t("easeOut")(e)}function i(e){return t("easeInOut")(e)}var r=function(t){"use asm";function e(t,e){t=t|0;e=e|0;return+(e/t)}function n(e,n){e=e|0;n=n|0;var i=+(t.Math.PI/(2*e));var r=+t.Math.abs(t.Math.sin(n*i));return+r}function i(e,n){e=e|0;n=n|0;var i=+(t.Math.PI/(2*e));var r=+t.Math.abs(-t.Math.cos(n*i)+1);return+r}function r(t,e){t=t|0;e=e|0;if(+(e/(t/2)<1)){return+i(t,e)}else{return+n(t,e)}}function s(t,e){t=t|0;e=e|0;var n=0,i=1,r=0.0;if((e/=t)<1/2.75){r=+(i*(7.5625*e*e)+n)}else if(e<2/2.75){r=+(i*(7.5625*(e-=1.5/2.75)*e+0.75)+n)}else if(e<2.5/2.75){r=+(i*(7.5625*(e-=2.25/2.75)*e+0.9375)+n)}else{r=+(i*(7.5625*(e-=2.625/2.75)*e+0.984375)+n)}return+r}function o(e,n,i){n=n|0;i=i|0;return+(1-t.Math.pow(1-i/n,e))}function u(e,n,i){n=n|0;i=i|0;return+t.Math.pow(i/n,e)}function a(t,e,n){e=e|0;n=n|0;var i=0.0;if(n>e/2){i=+o(t,e,n)}else{i=+u(t,e,n)}return+i}return{linear:e,sineEaseOut:n,sineEaseIn:i,sineEaseInOut:r,easeOutBounce:s,easeIn:u,easeOut:o,easeInOut:a}}(window);return r.easingFunctionGenerator=t,r.createEaseInFunction=e,r.createEaseOutFunction=n,r.createEaseInOutFunction=i,r.easeInQuad=e(2),r.easeInCubic=e(3),r.easeInQuart=e(4),r.easeInQuint=e(5),r.easeOutQuad=n(2),r.easeOutCubic=n(3),r.easeOutQuart=n(4),r.easeOutQuint=n(5),r.easeInOutQuad=i(2),r.easeInOutCubic=i(3),r.easeInOutQuart=i(4),r.easeInOutQuint=i(5),r}),function(){function t(){"use strict";function t(e){function n(t){var e;i.debug===!0&&(e=t.error.name||"Error",
console.log(e+" in listener; Event: "+t.info.event+"; Message: "+t.error.message))}var i=this;e=e||{},this.debug=e.debug||!1,this.interceptErrors=e.interceptErrors||!1,this.log=e.log||!1,this.logData=e.logData||!1,this.defaults=e.defaults||{},this.defaults.flowType=this.defaults.flowType||t.FLOW_TYPE_ASYNCHRONOUS,this.callbacks={"*":[]},this.subscribe(n,"EventBus.error")}return t.FLOW_TYPE_ASYNCHRONOUS=0,t.FLOW_TYPE_SYNCHRONOUS=1,t.create=function(e){return e=e||{},new t(e)},t.prototype.subscribe=function(t,e){var n,i,r=this;if(void 0===e?(i="*",n=t):"string"==typeof t||"number"==typeof t?(i=t,n=e):("string"==typeof e||"number"==typeof e)&&(i=e,n=t),"string"!=typeof i&&"number"!=typeof i)throw new Error("Event names can only be strings or numbers! event: ",i);if("function"!=typeof n)throw new Error("Only functions may be used as listeners!");return i=i||"*",this.callbacks[i]=this.callbacks[i]||[],this.callbacks[i].push(n),this.trigger("EventBus.subscribe",{listener:n,event:i,bus:this}),function(){r.unsubscribe(n,i)}},t.prototype.unsubscribe=function(t,e){var n,i,r,s,o;if(void 0===e?(o="*",s=t):"string"==typeof t||"number"==typeof t?(o=t,s=e):("string"==typeof e||"number"==typeof e)&&(o=e,s=t),"string"!=typeof o&&"number"!=typeof o)throw new Error("Event names can only be strings or numbers! event: ",o);if("function"!=typeof s)throw new Error("Only functions may be used as listeners!");for(o=o||"*",n=this.callbacks[o]||[],i=n.length,r=0;i>r;++r)n[r]===s&&this.callbacks[o].splice(r,1);this.trigger("EventBus.unsubscribe",{listener:s,event:o,bus:this})},t.prototype.once=function(t,e){var n,i,r,s,o,u=this,a=!1;if(s="function"==typeof t,o="function"==typeof e,s&&o||!s&&!o)throw new Error("Parameter mismatch; one parameter needs to be a function, the other one must be a string.");s?(r=t,i=e):(r=e,i=t),i=i||"*",n=function(t,e){a||(a=!0,u.unsubscribe(n,i),r(t,e))},this.subscribe(n,i)},t.prototype.trigger=function(e,n,i){function r(t){setTimeout(function(){throw t},0)}var s,o,u,a,c,l,d,f;if("undefined"!=typeof e&&"string"!=typeof e&&"number"!=typeof e)throw new Error("Event names can only be strings or numbers! event: ",e);d=this,e=arguments.length?e:"*",f="undefined"!=typeof i&&i===!1?t.FLOW_TYPE_SYNCHRONOUS:this.defaults.flowType,s=function(){var t,n,i,r,s,o,u="",a=[];for(n=e.split("."),t=0,i=n.length;i>t;++t)for(u=u+(t>0?".":"")+n[t],r=d.callbacks[u]||[],s=0,o=r.length;o>s;++s)a.push(r[s]);if("*"===e)return a;for(r=d.callbacks["*"]||[],s=0,o=r.length;o>s;++s)a.push(r[s]);return a}(),o=s.length,u={event:e,subscribers:o,async:f===t.FLOW_TYPE_ASYNCHRONOUS?!0:!1,getQueueLength:function(){return 0===o?0:o-(a+1)}},c=function(){for(d.log===!0&&console.log("EventBus event triggered: "+e+"; Subscribers: "+o,d.logData===!0?"; Data: "+n:""),a=0;o>a;++a){l=s[a];try{l(n,u)}catch(t){console.log(t),d.trigger("EventBus.error",{error:t,info:u}),d.interceptErrors!==!0&&r(t)}}},f===t.FLOW_TYPE_ASYNCHRONOUS?setTimeout(c,0):c()},t.prototype.triggerSync=function(t,e){return this.trigger(t,e,!1)},t.prototype.triggerAsync=function(t,e){return this.trigger(t,e,!0)},t.inject=function(e,n){n=n||{};var i=new t(n);e.subscribe=function(t,e){i.subscribe(t,e)},e.unsubscribe=function(t,e){i.unsubscribe(t,e)},e.once=function(t,e){i.once(t,e)},e.trigger=function(t,e,n){n="undefined"!=typeof n&&n===!1?!1:!0,i.trigger(t,e,n)},e.triggerSync=i.triggerSync.bind(i),e.triggerAsync=i.triggerAsync.bind(i),e.subscribe("destroyed",function(){i.callbacks=[]})},t}"function"==typeof using?using().define("MO5.EventBus",t):"undefined"!=typeof window?(window.MO5=MO5||{},window.MO5.EventBus=t()):module.exports=t()}(),function(){function t(){function t(t){var e,n=Error.apply(null,arguments);for(e in n)this[e]=n[e];this.message=t,this.name="MO5.Exception"}return t.prototype=new Error,t.prototype.constructor=t,t}"function"==typeof using?using().define("MO5.Exception",t):"undefined"!=typeof window?(window.MO5=window.MO5||{},window.MO5.Exception=t()):module.exports=t()}(),function(){function t(){function t(t){console.error?console.error(t.toString()):console.log(t.toString()),t.stack&&console.log(t.stack)}return t}"function"==typeof using?using().define("MO5.fail",t):"undefined"!=typeof window?window.MO5.fail=t():module.exports=t()}(),using().define("MO5.globals.document",function(){return document}),using().define("MO5.globals.window",function(){return window}),function(){function t(t,e,n){function i(e){t.call(this),this.unsubscribers={},this.items=n.isArray(e)?e:[]}return i.prototype=new t,i.prototype.length=function(){return this.items.length},i.prototype.append=function(e){function n(){var t,n;for(t=0,n=r.items.length;n>t;t+=1)r.items[t]===e&&r.items.splice(t,1);delete r.unsubscribers[e.id]}function i(){e.unsubscribe(n,"destroyed")}var r=this;return t.isCoreObject(e)&&(this.unsubscribers[e.id]=i,e.subscribe(n,"destroyed"),e.subscribe("destroyed",function(){e=null})),this.items.push(e),this},i.prototype.remove=function(e){var n=this.items[e];return t.isCoreObject(n)&&(this.unsubscribers[n.id](),delete this.unsubscribers[n.id]),this.items.splice(e,1),this},i.prototype.clear=function(){var t=this;this.forEach(function(e,n){t.remove(n)})},i.prototype.at=function(t){return this.items[+t]},i.prototype.indexOf=function(t){return this.items.indexOf(t)},i.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},i.prototype.toQueue=function(){var t=new e;return this.items.forEach(function(e){t.add(e)}),t},i.prototype.forEach=function(t){this.items.forEach(t)},i.prototype.filter=function(t){return this.items.filter(t)},i.prototype.map=function(t){return this.items.map(t)},i.prototype.reduce=function(t){return this.items.reduce(t)},i.prototype.every=function(t){return this.items.every(t)},i.prototype.some=function(t){return this.items.some(t)},i.prototype.find=function(t){var e,n=this.items.length;for(e=0;n>e;e+=1)if(t(this.items[e]))return this.items[e];return void 0},i.prototype.combine=function(t){return new i(this.items.slice().concat(t.items))},i.prototype.clone=function(){return new i(this.items.slice())},i.prototype.destroy=function(){if(!this.destroyed){for(var e=0;e<this.unsubscribers.length;e++)this.unsubscribers[e](),delete this.unsubscribers[e];t.prototype.destroy.apply(this,arguments)}},i}"function"==typeof using?using("MO5.CoreObject","MO5.Queue","MO5.types").define("MO5.List",t):"undefined"!=typeof window?window.MO5.List=t(MO5.CoreObject,MO5.Queue,MO5.types):module.exports=t(require("./CoreObject.js"),require("./Queue.js"),require("./types.js"))}(),function(){function t(t,e){function n(t){return s+t}function i(t){return t.replace(new RegExp(s),"")}function r(e){var n;if(t.call(this),this.clear(),e)for(n in e)this.set(n,e[n])}var s="MO5Map";return r.prototype=new t,r.prototype.clear=function(){this.items={},this.unsubscribers={},this.count=0},r.prototype.length=function(){return this.count},r.prototype.set=function(e,i){function r(){s.has(e)&&s.remove(e)}var s=this,o=n(e);if(!e)throw new Error("MO5.Map keys cannot be falsy.");if(this.has(o)&&this.remove(o),i&&i instanceof t){if(i.destroyed)throw new Error("Trying to add an MO5.Object that has already been destroyed.");i.subscribe(r,"destroyed")}if(e instanceof t){if(e.destroyed)throw new Error("Trying to use an MO5.Object as key that has already been destroyed.");e.subscribe(r,"destroyed")}return(i&&i instanceof t||e instanceof t)&&(this.unsubscribers[o]=function(){i instanceof t&&i.unsubscribe(r,"destroyed"),e instanceof t&&e.unsubscribe(r,"destroyed")}),this.items[o]=i,this.count+=1,this.trigger("updated",null,!1),this.trigger("set",o,!1),this},r.prototype.get=function(t){var e=n(t);return this.items.hasOwnProperty(e)?this.items[e]:void 0},r.prototype.require=function(t){if(!this.has(t))throw new Error("Required key '"+t+"' does not exist.");return this.get(t)},r.prototype.remove=function(t){var e=n(t);if(!this.has(t))throw new Error("Trying to remove an unknown key from an MO5.Map.");return this.unsubscribers.hasOwnProperty(e)&&(this.unsubscribers[e](),delete this.unsubscribers[e]),delete this.items[e],this.count-=1,this.trigger("updated",null,!1),this.trigger("removed",e,!1),this},r.prototype.has=function(t){var e=n(t);return this.items.hasOwnProperty(e)},r.prototype.destroy=function(){for(var e in this.unsubscribers)this.unsubscribers[e](),delete this.unsubscribers[e];t.prototype.destroy.call(this)},r.prototype.forEach=function(t){if(!t||"function"!=typeof t)throw new Error("Parameter 1 is expected to be of type function.");for(var e in this.items)t(this.items[e],i(e),this);return this},r.prototype.filter=function(t){var e=new r;return this.forEach(function(n,i,r){t(n,i,r)&&e.set(i,n)}),e},r.prototype.find=function(t){var e,n=!1;return this.forEach(function(i,r,s){!n&&t(i,r,s)&&(e=i,n=!0)}),e},r.prototype.map=function(t){var e=new r;return this.forEach(function(n,i,r){e.set(i,t(n,i,r))}),e},r.prototype.reduce=function(t,e){var n=e;return this.forEach(function(e,i,r){n=t(n,e,i,r)}),n},r.prototype.every=function(t){return this.reduce(function(e,n,i,r){return e&&t(n,i,r)},!0)},r.prototype.some=function(t){var e=!1;return this.forEach(function(n,i,r){!e&&t(n,i,r)&&(e=!0)}),e},r.prototype.keys=function(){var t=[];return this.forEach(function(e,n){t.push(n)}),t},r.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},r.prototype.toObject=function(){var t={};return this.forEach(function(e,n){t[n]=e}),t},r.prototype.clone=function(){var t=new r;return this.forEach(function(e,n){t.set(n,e)}),t},r.prototype.addMap=function(t){var e=this;return t.forEach(function(t,n){e.set(n,t)}),this},r.prototype.join=function(t){return this.clone().addMap(t)},r}"function"==typeof using?using("MO5.CoreObject","MO5.Exception").define("MO5.Map",t):"undefined"!=typeof window?window.MO5.Map=t(MO5.CoreObject,MO5.Exception):module.exports=t(require("./CoreObject.js"),require("./Exception.js"))}(),using().define("MO5.Point",function(){function t(t,e){this.x=t,this.y=e}return t.prototype.getDistance=function(t){var e=this.x-t.x,n=this.y-t.y,i=Math.squrt(e*e+n*n);return i},t}),function(){var t,e,n,i;!function(){var r={},s={};t=function(t,e,n){r[t]={deps:e,callback:n}},i=n=e=function(t){function n(e){if("."!==e.charAt(0))return e;for(var n=e.split("/"),i=t.split("/").slice(0,-1),r=0,s=n.length;s>r;r++){var o=n[r];if(".."===o)i.pop();else{if("."===o)continue;i.push(o)}}return i.join("/")}if(i._eak_seen=r,s[t])return s[t];if(s[t]={},!r[t])throw new Error("Could not find module "+t);for(var o,u=r[t],a=u.deps,c=u.callback,l=[],d=0,f=a.length;f>d;d++)"exports"===a[d]?l.push(o={}):l.push(e(n(a[d])));var p=c.apply(this,l);return s[t]=o||p}}(),t("promise/all",["./utils","exports"],function(t,e){"use strict";function n(t){var e=this;if(!i(t))throw new TypeError("You must pass an array to all.");return new e(function(e,n){function i(t){return function(e){s(t,e)}}function s(t,n){u[t]=n,0===--a&&e(u)}var o,u=[],a=t.length;0===a&&e([]);for(var c=0;c<t.length;c++)o=t[c],o&&r(o.then)?o.then(i(c),n):s(c,o)})}var i=t.isArray,r=t.isFunction;e.all=n}),t("promise/asap",["exports"],function(t){"use strict";function e(){return function(){process.nextTick(r)}}function n(){var t=0,e=new a(r),n=document.createTextNode("");return e.observe(n,{characterData:!0}),function(){n.data=t=++t%2}}function i(){return function(){c.setTimeout(r,1)}}function r(){for(var t=0;t<l.length;t++){var e=l[t],n=e[0],i=e[1];n(i)}l=[]}function s(t,e){var n=l.push([t,e]);1===n&&o()}var o,u="undefined"!=typeof window?window:{},a=u.MutationObserver||u.WebKitMutationObserver,c="undefined"!=typeof global?global:void 0===this?window:this,l=[];o="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?e():a?n():i(),t.asap=s}),t("promise/config",["exports"],function(t){"use strict";function e(t,e){return 2!==arguments.length?n[t]:void(n[t]=e)}var n={instrument:!1};t.config=n,t.configure=e}),t("promise/polyfill",["./promise","./utils","exports"],function(t,e,n){"use strict";function i(){var t;t="undefined"!=typeof global?global:"undefined"!=typeof window&&window.document?window:self;var e="Promise"in t&&"resolve"in t.Promise&&"reject"in t.Promise&&"all"in t.Promise&&"race"in t.Promise&&function(){var e;return new t.Promise(function(t){e=t}),s(e)}();e||(t.Promise=r)}var r=t.Promise,s=e.isFunction;n.polyfill=i}),t("promise/promise",["./config","./utils","./all","./race","./resolve","./reject","./asap","exports"],function(t,e,n,i,r,s,o,u){"use strict";function a(t){if(!E(t))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof a))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=[],c(t,this)}function c(t,e){function n(t){h(e,t)}function i(t){g(e,t)}try{t(n,i)}catch(r){i(r)}}function l(t,e,n,i){var r,s,o,u,a=E(n);if(a)try{r=n(i),o=!0}catch(c){u=!0,s=c}else r=i,o=!0;p(e,r)||(a&&o?h(e,r):u?g(e,s):t===W?h(e,r):t===M&&g(e,r))}function d(t,e,n,i){var r=t._subscribers,s=r.length;r[s]=e,r[s+W]=n,r[s+M]=i}function f(t,e){for(var n,i,r=t._subscribers,s=t._detail,o=0;o<r.length;o+=3)n=r[o],i=r[o+e],l(e,n,i,s);t._subscribers=null}function p(t,e){var n,i=null;try{if(t===e)throw new TypeError("A promises callback cannot return that same promise.");if(w(e)&&(i=e.then,E(i)))return i.call(e,function(i){return n?!0:(n=!0,void(e!==i?h(t,i):m(t,i)))},function(e){return n?!0:(n=!0,void g(t,e))}),!0}catch(r){return n?!0:(g(t,r),!0)}return!1}function h(t,e){t===e?m(t,e):p(t,e)||m(t,e)}function m(t,e){t._state===T&&(t._state=O,t._detail=e,v.async(y,t))}function g(t,e){t._state===T&&(t._state=O,t._detail=e,v.async(b,t))}function y(t){f(t,t._state=W)}function b(t){f(t,t._state=M)}var v=t.config,w=(t.configure,e.objectOrFunction),E=e.isFunction,S=(e.now,n.all),_=i.race,A=r.resolve,x=s.reject,k=o.asap;v.async=k;var T=void 0,O=0,W=1,M=2;a.prototype={constructor:a,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(t,e){var n=this,i=new this.constructor(function(){});if(this._state){var r=arguments;v.async(function(){l(n._state,i,r[n._state-1],n._detail)})}else d(this,i,t,e);return i},"catch":function(t){return this.then(null,t)}},a.all=S,a.race=_,a.resolve=A,a.reject=x,u.Promise=a}),t("promise/race",["./utils","exports"],function(t,e){"use strict";function n(t){var e=this;if(!i(t))throw new TypeError("You must pass an array to race.");return new e(function(e,n){for(var i,r=0;r<t.length;r++)i=t[r],i&&"function"==typeof i.then?i.then(e,n):e(i)})}var i=t.isArray;e.race=n}),t("promise/reject",["exports"],function(t){"use strict";function e(t){var e=this;return new e(function(e,n){n(t)})}t.reject=e}),t("promise/resolve",["exports"],function(t){"use strict";function e(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var e=this;return new e(function(e){e(t)})}t.resolve=e}),t("promise/utils",["exports"],function(t){"use strict";function e(t){return n(t)||"object"==typeof t&&null!==t}function n(t){return"function"==typeof t}function i(t){return"[object Array]"===Object.prototype.toString.call(t)}var r=Date.now||function(){return(new Date).getTime()};t.objectOrFunction=e,t.isFunction=n,t.isArray=i,t.now=r}),e("promise/polyfill").polyfill()}(),function(){function t(){function t(t){var e,n,i=new Promise(function(t,r){e=function(e){return t(e),i},n=function(t){return r(t),i}});return i.success=e,i.failure=n,i.resolve=e,i.reject=n,"function"==typeof t&&t(e,n),i}return t.resolve=Promise.resolve,t.reject=Promise.reject,t.all=Promise.all,t.race=Promise.race,t.consolify=function(t){t.then(console.log.bind(console))["catch"](function(t){console.error(t),console.log(t.stack)})},t}"function"==typeof using?using().define("MO5.Promise",t):"undefined"!=typeof window?window.MO5.Promise=t():module.exports=t()}(),function(){function t(t,e){function n(n){if(e.call(this),n&&!(n instanceof Array))throw new t("Parameter 1 is expected to be of type Array.");this.arr=n||[]}return n.prototype=new e,n.prototype.constructor=n,n.prototype.length=function(){return this.arr.length},n.prototype.add=function(n){var i=this,r=this.arr.length;if(n instanceof e){if(n.destroyed)throw new t("Trying to add an MO5.Object that has already been destroyed.");n.once(function(){i.destroyed||i.arr.splice(r,1)},"destroyed")}return this.arr.push(n),this.trigger("updated"),this.trigger("added",n),this},n.prototype.replace=function(e){if(!(e instanceof Array))throw new t("Parameter 1 is expected to be of type Array.");return this.arr=e,this.trigger("updated"),this.trigger("replaced",e),this},n.prototype.next=function(){if(!this.hasNext())throw new t("Calling next() on empty queue.");var e=this.arr.shift();return this.trigger("updated"),this.trigger("next"),this.arr.length<1&&this.trigger("emptied"),e},n.prototype.peak=function(){return this.isEmpty()?void 0:this.arr[0]},n.prototype.isEmpty=function(){return!this.hasNext()},n.prototype.hasNext=function(){return this.arr.length>0},n.prototype.clear=function(){return this.arr=[],this.trigger("updated"),this.trigger("cleared"),this},n.prototype.reverse=function(){for(var t=new n,e=this.length(),i=e-1;i>=0;)t.add(this.arr[i]),i-=1;return t},n.prototype.clone=function(){return new n(this.arr.slice())},n}"function"==typeof using?using("MO5.Exception","MO5.CoreObject").define("MO5.Queue",t):"undefined"!=typeof window?window.MO5.Queue=t(MO5.Exception,MO5.CoreObject):module.exports=t(require("./Exception.js"),require("./CoreObject.js"))}(),function(){function t(){function t(t,e){var n,i=[];for(n=t;e>=n;n+=1)i.push(n);return i}return t}"function"==typeof using?using().define("MO5.range",t):"undefined"!=typeof window?window.MO5.range=t():module.exports=t()}(),function(){function t(t,e,n,i){function r(t,e){for(;t.hasNext();)a(function(t){return function(){t(e)}}(t.next()))}function s(t,e,n,i){"function"==typeof n?e.add(function(t){var e;try{e=n(t),e&&e instanceof u?e.then(i.success,i.failure):i.success(e)}catch(r){i.failure(r)}return e}):e.add(function(e){i[t](e)})}function o(){t.call(this),this.successQueue=new e,this.failureQueue=new e,this.value=void 0,this.status=o.STATUS_PENDING,this.promise=new u(this)}function u(e){t.call(this),this.then=function(t,n){var i=new o;switch(e.status){case o.STATUS_PENDING:o.addToQueue("success",e.successQueue,t,i),o.addToQueue("failure",e.failureQueue,n,i);break;case o.STATUS_SUCCESS:o.addToQueue("success",e.successQueue,t,i),o.resolve(e.successQueue,e.value);break;case o.STATUS_FAILURE:o.addToQueue("failure",e.failureQueue,n,i),o.resolve(e.failureQueue,e.value)}return i.promise}}var a;return a="undefined"!=typeof window&&window.setImmediate?window.setImmediate:"undefined"!=typeof process?function(t){process.nextTick(t)}:function(t){setTimeout(t,0)},o.STATUS_PENDING=1,o.STATUS_FAILURE=2,o.STATUS_SUCCESS=3,o.getFulfilledPromise=function(){return(new o).success().promise},o.getBrokenPromise=function(){return(new o).failure().promise},o.prototype=new t,o.prototype.isPending=function(){return this.status===o.STATUS_PENDING},o.prototype.failure=function(t){return this.status!==o.STATUS_PENDING?void i(new n("The result of the action has already been determined.")):(this.value=t,this.status=o.STATUS_FAILURE,r(this.failureQueue,t),this.successQueue.clear(),this.failureQueue.clear(),this)},o.prototype.success=function(t){return this.status!==o.STATUS_PENDING?void i(new n("The result of the action has already been determined.")):(this.value=t,this.status=o.STATUS_SUCCESS,r(this.successQueue,t),this.successQueue.clear(),this.failureQueue.clear(),this)},o.addToQueue=s,o.resolve=r,u.prototype=new t,o}console.warn("MO5.Result is deprecated - use MO5.Promise instead!"),"function"==typeof using?using("MO5.CoreObject","MO5.Queue","MO5.Exception","MO5.fail").define("MO5.Result",t):"undefined"!=typeof window?window.MO5.CoreObject=t(MO5.CoreObject,MO5.Queue,MO5.Exception,MO5.fail):module.exports=t(require("./CoreObject.js"),require("./Queue.js"),require("./Exception.js"),require("./fail.js"))}(),function(){function t(t,e){function n(n){t.call(this),this._unsubscribers={},this._stringItems={},this._items=[],n&&e.hasForEach(n)&&this.addMany(n)}function i(t){return e.isObject(t)?e.isNumber(t.id)?!0:!1:!0}function r(t){return e.isObject(t)?s+"MO5CoreObject_"+t.id:s+"SimpleValue_"+JSON.stringify(t)}var s="MO5Set_";return n.fromRange=function(t,e){var i,r=new n;for(i=t;e>=i;i+=1)r.add(i);return r},n.prototype=new t,n.prototype.has=function(t){var e,n;if(i(t))return r(t)in this._stringItems;for(e=0,n=this._items.length;n>e;e+=1)if(this._items[e]===t)return!0;return!1},n.prototype.add=function(e){var n;return this.has(e)?this:(i(e)?(n=r(e),this._stringItems[n]=e,t.isCoreObject(e)&&(this._unsubscribers[n]=this["delete"].bind(this,e),e.subscribe("destroyed",this._unsubscribers[n]))):this._items.push(e),this)},n.prototype["delete"]=function(e){var n;return this.has(e)?(i(e)?(n=r(e),delete this._stringItems[n],t.isCoreObject(e)&&(e.unsubscribe("destroyed",this._unsubscribers[n]),delete this._unsubscribers[n])):this._items.splice(this._items.indexOf(e),1),!0):!1},n.prototype.clear=function(){this._items.forEach(this["delete"].bind(this)),this._items=[],this._stringItems={},this._unsubscribers={}},n.prototype.forEach=function(t){var e,n=0;for(e in this._stringItems)t(this._stringItems[e],n,this),n+=1;this._items.forEach(function(e){t(e,n,this),n+=1}.bind(this))},n.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},n.prototype.keys=n.prototype.values,n.prototype.addMany=function(t){return t.forEach(this.add.bind(this)),this},n.prototype.intersection=function(t){var e=new n;return t.forEach(function(t){this.has(t)&&e.add(t)}.bind(this)),e},n.prototype.difference=function(t){var e=new n(this.values());return t.forEach(function(t){e.has(t)?e["delete"](t):e.add(t)}),e},n.prototype.size=function(){var t,e=this._items.length;for(t in this._stringItems)e+=1;return e},n}"function"==typeof using?using("MO5.CoreObject","MO5.types").define("MO5.Set",t):"undefined"!=typeof window?window.MO5.Set=t(MO5.CoreObject,MO5.types):module.exports=t(require("./CoreObject.js"),require("./types.js"))}(),using().define("MO5.Size",function(){function t(t,e){this.width=t||0,this.height=e||0}return t}),function(){function t(t,e,n,i){function r(e){t.call(this),this.message=e,this.name="MO5.TimerError"}function s(){e.call(this),this.running=!1,this.paused=!1,this.canceled=!1,this.startTime=+new Date,this.timeElapsed=0,this.pauseTimeElapsed=0,this.pauseStartTime=this.startTime}return r.prototype=new t,s.prototype=new e,s.prototype.constructor=s,s.prototype.start=function(){return this.startTime=+new Date,this.running=!0,this.trigger("started",null,!1),this},s.prototype.stop=function(){return this.running=!1,this.paused=!1,this.trigger("stopped",null,!1),this},s.prototype.cancel=function(){return this.running||n(new r("Trying to cancel a Timer that isn't running.")),this.elapsed(),this.canceled=!0,this.running=!1,this.paused=!1,this.trigger("canceled",null,!1),this},s.prototype.isRunning=function(){return this.running},s.prototype.isCanceled=function(){return this.canceled},s.prototype.isPaused=function(){return this.paused},s.prototype.pause=function(){this.paused=!0,this.pauseStartTime=+new Date,this.trigger("paused",null,!1)},s.prototype.resume=function(){this.paused||n(new r("Trying to resume a timer that isn't paused.")),this.paused=!1,this.pauseTimeElapsed+=+new Date-this.pauseStartTime,this.trigger("resumed",null,!1)},s.prototype.elapsed=function(){return this.running&&!this.paused&&(this.timeElapsed=+new Date-this.startTime-this.pauseTimeElapsed),this.timeElapsed},s.prototype.getReadOnlyCapability=function(){var t=this;return{isRunning:function(){return t.running},isCanceled:function(){return t.canceled},isPaused:function(){return t.paused},elapsed:function(){return t.elapsed()}}},s.prototype.promise=function(){var t=new i,e=this;return this.once(function(){t.resolve(e)},"stopped"),this.once(function(){t.reject(e)},"canceled"),this.once(function(){t.reject(e)},"destroyed"),t},s}"function"==typeof using?using("MO5.Exception","MO5.CoreObject","MO5.fail","MO5.Promise").define("MO5.Timer",t):"undefined"!=typeof window?window.MO5.Timer=t(MO5.Exception,MO5.CoreObject,MO5.fail,MO5.Promise):module.exports=t(require("./Exception.js"),require("./CoreObject.js"),require("./fail.js"),require("./Promise.js"))}(),function(){function t(t,e,n,i){function r(n){var i;if(e.call(this),n&&!(n instanceof Array))throw new t("Parameter 1 is expected to be of type Array.").log();n=n||[],i=this,this.timers={},this.count=0,n.forEach(function(t){i.addTimer(t)})}return r.prototype=new e,r.prototype.constructor=r,r.prototype.addTimer=function(e){var n,i=this;if(this.timers[+e])throw new t("A timer with ID '"+e+"' has already been added to the watcher.");return this.count+=1,n=function(){i.count-=1,i.count<1&&i.trigger("stopped",null,!1)},this.timers[+e]={timer:e,unsubscribe:function(){e.unsubscribe(n,"stopped")}},e.subscribe(n,"stopped"),this.trigger("added",e,!1),this},r.prototype.createTimer=function(){var t=new i;return this.trigger("created",t,!1),this.addTimer(t),t},r.prototype.removeTimer=function(e){return this.timers[+e]?(this.timers[+e].unsubscribe(),delete this.timers[+e],this.trigger("removed",e,!1),this):(n(new t("Trying to remove a timer that is unknown to the watcher.")),this)},r.prototype.forAll=function(t){var e,n;for(e in this.timers)this.timers.hasOwnProperty(e)&&(n=this.timers[e].timer,n instanceof r?this.timers[e].timer.forAll(t):this.timers[e].timer[t]());return this},r.prototype.cancel=function(){return this.forAll("cancel"),this.trigger("canceled",null,!1),this},r.prototype.pause=function(){return this.forAll("pause"),this.trigger("paused",null,!1),this},r.prototype.resume=function(){return this.forAll("resume"),this.trigger("resumed",null,!1),this},r.prototype.stop=function(){return this.forAll("stop")},r.prototype.start=function(){return this.forAll("start"),this.trigger("started",null,!1),this},r.prototype.promise=function(){return i.prototype.promise.call(this)},r}"function"==typeof using?using("MO5.Exception","MO5.CoreObject","MO5.fail","MO5.Timer").define("MO5.TimerWatcher",t):"undefined"!=typeof window?window.MO5.TimerWatcher=t(MO5.Exception,MO5.CoreObject,MO5.fail,MO5.Timer):module.exports=t(require("./Exception.js"),require("./CoreObject.js"),require("./fail.js"),require("./Timer.js"))}(),using().define("MO5.tools",function(){var t={};return t.getUniqueId=function(){var t=0;return function(){return t++}}(),t.getWindowDimensions=function(){var t=window,e="inner";return"innerWidth"in t||(e="client",t=document.documentElement||document.body),{width:t[e+"Width"],height:t[e+"Height"]}},t.fitToWindow=function(e,n,i){var r,s,o,u,a,c;r=t.getWindowDimensions(),o=r.width,u=r.height,a=o/n,c=u/i,s=a>c?c:a,e.setAttribute("style",e.getAttribute("style")+" -moz-transform: scale("+s+","+s+") rotate(0.01deg); -ms-transform: scale("+s+","+s+"); -o-transform: scale("+s+","+s+"); -webkit-transform: scale("+s+","+s+"); transform: scale("+s+","+s+");")},t.timeoutInspector=function(){var t,e,n,i,r,s={},o=0,u=0,a=0;return t=window.setTimeout,e=window.setInterval,n=window.clearTimeout,i=window.clearInterval,r=window.requestAnimationFrame,{logAnimationFrameRequests:!1,logTimeouts:!1,logIntervals:!1,enable:function(){window.setTimeout=function(e,n){var i=t(e,n);return o+=1,this.logTimeouts&&console.log("Setting timeout: ",{callback:e.toString(),time:n},i),i},window.setInterval=function(t,n){var i=e(t,n);return u+=1,s[i]=!0,this.logIntervals&&console.log("Setting interval: ",{callback:t.toString(),time:n},i),i},window.clearTimeout=function(t){return console.log("Clearing timeout: ",t),n(t)},window.clearInterval=function(t){return console.log("Clearing interval: ",t),t in s?delete s[t]:console.log("Warning: Interval "+t+" doesn't exist."),i(t)},window.requestAnimationFrame=function(t){return a+=1,this.logAnimationFrameRequests&&console.log("Requesting animation frame: ",{callback:t.toString()}),r(t)}},disable:function(){window.setTimeout=t,window.setInterval=e,window.clearTimeout=n,window.clearInterval=i,window.requestAnimationFrame=r},getActiveIntervals:function(){var t,e=[];for(t in this.activeIntervals)e.push(t);return e},totalTimeoutCalls:function(){return o},totalIntervalCalls:function(){return u},totalRequestAnimationFrameCalls:function(){return a}}}(),t}),using("MO5.Exception","MO5.Timer","MO5.easing").define("MO5.transform",function(t,e,n){function i(i,r,s,o){if(o=o||{},"undefined"==typeof i||!i)throw new t("MO5.transform expects parameter callback to be a function.");var u,a,c="undefined"!=typeof o.duration&&o.duration>=0?o.duration:500,l=r,d=o.timer||new e,f=s-r,p=o.log||!1,h=0,m=0,g=o.fps||60;return u=o.easing||n.sineEaseOut,a=function(){var t,e;if(Date.now()-m>1e3/g){if(d.canceled)return;if(d.paused)return void d.once(a,"resumed");if(h+=1,e=d.elapsed(),e>c||d.stopped)return l=r+f,i(s),void(d.stopped||d.stop());l=u(c,e)*f+r,i(l),t=d.elapsed()-e,p===!0&&console.log("Current value: "+l+"; c: "+h+"; Exec time: "+t),m=Date.now()}requestAnimationFrame(a)},d.start(),requestAnimationFrame(a),d}return i}),function(){function t(){var t={};return t.isObject=function(t){return"object"==typeof t&&null!==t},t.isString=function(t){return"string"==typeof t},t.isNumber=function(t){return"number"==typeof t},t.isFunction=function(t){return"function"==typeof t},t.isArray=function(e){return Array.isArray?Array.isArray(e):t.isObject(e)?e instanceof Array:!1},t.hasForEach=function(e){return t.isObject(e)&&t.isFunction(e.forEach)},t}"function"==typeof using?using().define("MO5.types",t):"undefined"!=typeof window?window.MO5.types=t():module.exports=t()}(),using("WSE.assets.Animation","WSE.assets.Audio","WSE.assets.Background","WSE.assets.Character","WSE.assets.Curtain","WSE.assets.Imagepack","WSE.assets.Textbox","WSE.assets.Composite").define("WSE.assets",function(t,e,n,i,r,s,o,u){var a={Animation:t,Audio:e,Background:n,Character:i,Curtain:r,Imagepack:s,Textbox:o,Composite:u};return a}),using("WSE.commands.alert","WSE.commands.break","WSE.commands.choice","WSE.commands.confirm","WSE.commands.do","WSE.commands.fn","WSE.commands.global","WSE.commands.globalize","WSE.commands.goto","WSE.commands.line","WSE.commands.localize","WSE.commands.prompt","WSE.commands.restart","WSE.commands.set_vars","WSE.commands.sub","WSE.commands.trigger","WSE.commands.var","WSE.commands.wait","WSE.commands.while","WSE.commands.with").define("WSE.commands",function(t,e,n,i,r,s,o,u,a,c,l,d,f,p,h,m,g,y,b,v){"use strict";var w={alert:t,"break":e,choice:n,confirm:i,"do":r,fn:s,global:o,globalize:u,"goto":a,line:c,localize:l,prompt:d,restart:f,set_vars:p,sub:h,trigger:m,"var":g,wait:y,"while":b,"with":v};return w}),using().define("WSE.functions",function(){"use strict";var t={savegames:function(t){t.toggleSavegameMenu()},stageclick_disable:function(t){t.game.unsubscribeListeners()},stageclick_enable:function(t){t.game.subscribeListeners()}};return t}),using("WSE.dataSources.LocalStorage").define("WSE.dataSources",function(t){var e={LocalStorage:t};return e}),using("databus","WSE.assets","WSE.commands","WSE.dataSources","WSE.functions").define("WSE",function(t,e,n,i,r){"use strict";var s={},o="2017.1.0";return t.inject(s),s.instances=[],s.dataSources=i,s.assets=e,s.commands=n,s.functions=r,s.getVersion=function(){return o},s}),using().define("WSE.Keys",function(){function t(t){t=t||{},this.keys={},this.keys.BACKSPACE={kc:8},this.keys.TAB={kc:9},this.keys.ENTER={kc:13,which:13},this.keys.SHIFT={kc:16},this.keys.CTRL={kc:17},this.keys.ALT={kc:18},this.keys.PAUSE={kc:19},this.keys.CAPS_LOCK={kc:20},this.keys.ESCAPE={kc:27},this.keys.SPACE={kc:32},this.keys.PAGE_UP={kc:33},this.keys.PAGE_DOWN={kc:20},this.keys.END={kc:20},this.keys.HOME={kc:20},this.keys.LEFT_ARROW={kc:37},this.keys.UP_ARROW={kc:38},this.keys.RIGHT_ARROW={kc:39},this.keys.DOWN_ARROW={kc:40},this.keys.INSERT={kc:45},this.keys.DELETE={kc:46},this.keys.NUM_0={
kc:48},this.keys.NUM_1={kc:49},this.keys.NUM_2={kc:50},this.keys.NUM_3={kc:51},this.keys.NUM_4={kc:52},this.keys.NUM_5={kc:53},this.keys.NUM_6={kc:54},this.keys.NUM_7={kc:55},this.keys.NUM_8={kc:56},this.keys.NUM_9={kc:57},this.keys.A={kc:65},this.keys.B={kc:66},this.keys.C={kc:67},this.keys.D={kc:68},this.keys.E={kc:69},this.keys.F={kc:70},this.keys.G={kc:71},this.keys.H={kc:72},this.keys.I={kc:73},this.keys.J={kc:74},this.keys.K={kc:75},this.keys.L={kc:76},this.keys.M={kc:77},this.keys.N={kc:78},this.keys.O={kc:79},this.keys.P={kc:80},this.keys.Q={kc:81},this.keys.R={kc:82},this.keys.S={kc:83},this.keys.T={kc:84},this.keys.U={kc:85},this.keys.V={kc:86},this.keys.W={kc:87},this.keys.X={kc:88},this.keys.Y={kc:89},this.keys.Z={kc:90},this.keys.LEFT_WIN={kc:91},this.keys.RIGHT_WIN={kc:92},this.keys.SELECT={kc:93},this.keys.NUMPAD_0={kc:96},this.keys.NUMPAD_1={kc:97},this.keys.NUMPAD_2={kc:98},this.keys.NUMPAD_3={kc:99},this.keys.NUMPAD_4={kc:100},this.keys.NUMPAD_5={kc:101},this.keys.NUMPAD_6={kc:102},this.keys.NUMPAD_7={kc:103},this.keys.NUMPAD_8={kc:104},this.keys.NUMPAD_9={kc:105},this.keys.MULTIPLY={kc:106},this.keys.ADD={kc:107},this.keys.SUBSTRACT={kc:109},this.keys.DECIMAL_POINT={kc:110},this.keys.DIVIDE={kc:111},this.keys.F1={kc:112},this.keys.F2={kc:113},this.keys.F3={kc:114},this.keys.F4={kc:115},this.keys.F5={kc:116},this.keys.F6={kc:117},this.keys.F7={kc:118},this.keys.F8={kc:119},this.keys.F9={kc:120},this.keys.F10={kc:121},this.keys.F11={kc:122},this.keys.F12={kc:123},this.keys.NUM_LOCK={kc:144},this.keys.SCROLL_LOCK={kc:145},this.keys.SEMI_COLON={kc:186},this.keys.EQUALS={kc:187},this.keys.COMMA={kc:188},this.keys.DASH={kc:189},this.keys.PERIOD={kc:190},this.keys.SLASH={kc:191},this.keys.GRAVE={kc:192},this.keys.OPEN_BRACKET={kc:219},this.keys.BACK_SLASH={kc:220},this.keys.CLOSE_BRACKET={kc:221},this.keys.SINGLE_QUOTE={kc:222},this.listeners=[];var e,n,i,r,s,o,u=t.log||!1,a=t.element||window,c=this;e=function(t){null!=t&&"undefined"!=typeof t&&(t.addEventListener?(t.addEventListener("keyup",i,!1),t.addEventListener("keydown",r,!1),t.addEventListener("keypress",s,!1),u===!0&&(t.addEventListener("keyup",o,!1),t.addEventListener("keydown",o,!1),t.addEventListener("keypress",o,!1))):t.attachEvent&&(t.attachEvent("onkeyup",i),t.attachEvent("onkeydown",r),t.attachEvent("onkeypress",s),u===!0&&(t.attachEvent("onkeyup",o),t.attachEvent("onkeydown",o),t.attachEvent("onkeypress",o))))},n=function(t,e){var n,i,r,s,o=c.listeners.length;for(i=0;o>i;++i)n=c.listeners[i],"undefined"!=typeof n&&n.type==e&&(n.key=n.key||{},r=n.key.kc||null,s=n.key.which||null,(t.which==s||t.keyCode==r)&&n.callback(t))},i=function(t){n(t,"up")},r=function(t){n(t,"down")},s=function(t){n(t,"press")},o=function(t){console.log(t)},e(a)}return t.prototype.addListener=function(t,e,n){if(n=n||"up","up"!==n&&"down"!==n&&"press"!==n)throw new Error("Event type not recognized.");this.listeners.push({key:t,callback:e,type:n})},t.prototype.removeListener=function(t,e,n){var i,r=this.listeners.length;n=n||null;for(var s=0;r>s;++s)i=this.listeners[s],(null===n||i.type==n)&&"undefined"!=typeof i&&i.key===t&&i.callback===e&&delete this.listeners[s]},t.prototype.forAll=function(t,e){if(e=e||"up","up"!==e&&"down"!==e&&"press"!==e)throw new Error("Event type not recognized.");for(var n in this.keys)this.keys.hasOwnProperty(n)&&this.addListener(this.keys[n],t,e)},t}),using("MO5.Timer").define("WSE.tools",function(t){"use strict";var e={};return e.applyAssetUnits=function(t,e){var n,i;n=e.getAttribute("x")||"",i=e.getAttribute("y")||"",t.xUnit=n.replace(/^.*(px|%)$/,"$1"),t.xUnit=t.xUnit||"px",t.yUnit=i.replace(/^.*(px|%)$/,"$1"),t.yUnit=t.yUnit||"px","px"!==t.xUnit&&"%"!==t.xUnit&&(t.xUnit="px"),"px"!==t.yUnit&&"%"!==t.yUnit&&(t.yUnit="px")},e.removeEventListener=function(t,e,n){"undefined"!=typeof t&&null!==t&&t.removeEventListener(e,n,!1)},e.replaceVariables=function(t,e){var n,i;return null===t?t:("string"!=typeof t&&(e.bus.trigger("wse.interpreter.error",{message:"Argument supplied to the replaceVariables function must be a string."}),t=""),n=function(){var t=arguments[1];return e.globalVars.has(t)?""+e.globalVars.get(t):""},i=function(){var t=arguments[1];return t in e.runVars?""+e.runVars[t]:""},t=t.replace(/\{\$\$([a-zA-Z0-9_]+)\}/g,n),t=t.replace(/\{\$([a-zA-Z0-9_]+)\}/g,i))},e.getSerializedNodes=function(t){var e,n,i=new XMLSerializer,r=t.childNodes,s="";for(e=0,n=r.length;n>e;e+=1)s+=i.serializeToString(r[e]);return s},e.getParsedAttribute=function(t,n,i,r){var s;return arguments.length<3&&(r=""),s=t.getAttribute(n)||""+r,e.replaceVariables(s,i)},e.textToHtml=function(t,e){return e=e||!1,String.prototype.trim?t=t.trim():(t=t.replace(/^\n/,""),t=t.replace(/\n$/,"")),t=e===!0?t.replace(/\n/g,"<br />"):t,t=t.replace(/\{/g,"<"),t=t.replace(/\}/g,">")},e.getUniqueId=function(){var t=0;return function(){return t+=1}}(),e.firstLetterUppercase=function(t){return t.length<1?"":""+t.charAt(0).toUpperCase()+t.replace(/^.{1}/,"")},e.mixin=function(t,e){var n;for(n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e.extractUnit=function(t){return"string"!=typeof t?"":t.replace(/^(-){0,1}[0-9]*/,"")},e.calculateValueWithAnchor=function(t,n,i){var r=0,s="px";return n?(s=e.extractUnit(n),n=parseInt(n,10),r="%"===s?t-i/100*n:t-n):t},e.createTimer=function(e){var n=new t;return e=e||0,e=0>e?0:e,n.start(),setTimeout(n.stop.bind(n),e),n},e.getWindowDimensions=function(){var t=window,e="inner";return"innerWidth"in t||(e="client",t=document.documentElement||document.body),{width:t[e+"Width"],height:t[e+"Height"]}},e.fitToWindow=function(t,n,i){var r,s,o,u,a,c;r=e.getWindowDimensions(),o=r.width,u=r.height,a=o/n,c=u/i,s=a>c?c:a,t.setAttribute("style",t.getAttribute("style")+" -moz-transform: scale("+s+","+s+") rotate(0.01deg); -ms-transform: scale("+s+","+s+"); -o-transform: scale("+s+","+s+"); -webkit-transform: scale("+s+","+s+"); transform: scale("+s+","+s+");")},e.log=function(t,n){e.trigger(t,"wse.interpreter.message",n)},e.warn=function(t,n,i){e.trigger(t,"wse.interpreter.warning",n,i)},e.logError=function(t,n,i){e.trigger(t,"wse.interpreter.error",n,i)},e.trigger=function(t,e,n,i){t.trigger(e,{element:i||null,message:n})},e}),using("easy-ajax","WSE.tools.compile::compile").define("WSE.loader",function(t,e){function n(t,e){o(t,function(t){i(t,e)})}function i(t,e){var n=u(t),i=a(n);s(i,function(t){t.forEach(function(t,e){var r=i[e].type,s=n.getElementsByTagName(r)[0];s||(s=n.createElement(r),n.documentElement.appendChild(s)),s.innerHTML+="\n"+t+"\n"}),e(n)})}function r(t,n){i(e(t),n)}function s(t,e){var n=0,i=t.length,r=[];t.forEach(function(t,s){o(t.url,function(t){r[s]=t,n+=1,n>=i&&e(r)})}),1>i&&e(r)}function o(n,i){t.get(n+"?random="+Math.random(),function(t,n){return t?void console.error(t):void i(e(n.responseText))})}function u(t){return(new DOMParser).parseFromString(t,"application/xml")}function a(t){var e=t.getElementsByTagName("file");return[].map.call(e,function(t){return{type:t.getAttribute("type"),url:t.getAttribute("url")}})}return{generateGameFile:n,generateFromString:r}}),using("string-dict").define("WSE.dataSources.LocalStorage",function(t){"use strict";function e(){}var n,i="___wse_storage_test",r=!1;try{localStorage.setItem(i,"works"),"works"===localStorage.getItem(i)&&(r=!0)}catch(s){console.error("LocalStorage not available, using JS object as fallback."),n=new t}return e.prototype.set=function(t,e){r?localStorage.setItem(t,e):n.set(t,e)},e.prototype.get=function(t){return r?localStorage.getItem(t):n.has(t)?n.get(t):null},e.prototype.remove=function(t){if(!r){if(!n.has(t))return;return n.remove(t)}return localStorage.removeItem(t)},e}),using("WSE.commands","WSE.functions","WSE.tools::warn").define("WSE.Trigger",function(t,e,n){"use strict";function i(i,r){var s,o=this;if(this.name=i.getAttribute("name")||null,this.event=i.getAttribute("event")||null,this.special=i.getAttribute("special")||null,this.fnName=i.getAttribute("function")||null,this.scene=i.getAttribute("scene")||null,this.interpreter=r,this.isSubscribed=!1,null===this.name)return void n(r.bus,"No 'name' attribute specified on 'trigger' element.",i);if(null===this.event)return void n(r.bus,"No 'event' attribute specified on 'trigger' element '"+this.name+"'.",i);if(null===this.special&&null===this.fnName&&null===this.scene)return void n(r.bus,"No suitable action or function found for trigger element '"+this.name+"'.",i);if(this.scene&&(s=function(){t.sub(i,r),r.index=0,r.currentElement=0,r.next()}),this.isKeyEvent=!1,this.key=null,null!==this.special&&"next"!==this.special)return void n(r.bus,"Unknown special specified on trigger element '"+this.name+"'.",i);if("next"===this.special&&(s=function(){"pause"===o.interpreter.state||o.interpreter.waitCounter>0||o.interpreter.next()}),null!==this.fnName){if("function"!=typeof e[this.fnName])return void n(r.bus,"Unknown function specified on trigger element '"+this.name+"'.",i);s=function(){e[o.fnName](o.interpreter,i)}}switch(this.event){case"keyup":case"keydown":case"keypress":return this.isKeyEvent=!0,this.key=i.getAttribute("key")||null,null===this.key?void n(r.bus,"No 'key' attribute specified on trigger element '"+this.name+"'.",i):"undefined"==typeof r.game.keys.keys[this.key]||null===r.game.keys.keys[this.key]?void n(r.bus,"Unknown key '"+this.key+"' specified on trigger element '"+this.name+"'.",i):void(this.fn=function(t){t.keys[o.key].kc===t.event.keyCode&&(r.keysDisabled>0||s())});default:this.fn=s}}return i.prototype.activate=function(){this.isSubscribed!==!0&&(this.interpreter.bus.subscribe(this.fn,this.event),this.isSubscribed=!0)},i.prototype.deactivate=function(){this.isSubscribed!==!1&&(this.interpreter.bus.unsubscribe(this.fn,this.event),this.isSubscribed=!1)},i}),using("databus","easy-ajax","WSE.Keys","WSE.Interpreter","WSE.tools","WSE","WSE.loader").define("WSE.Game",function(t,e,n,i,r,s,o){"use strict";function u(e){var r;s.instances.push(this),s.trigger("wse.game.constructor",{args:e,game:this}),e=e||{},this.bus=new t,this.url=e.url||"game.xml",this.gameId=e.gameId||null,this.ws=null,this.debug=e.debug===!0?!0:!1,r=e.host||!1,this.host=r,this.gameId?o.generateFromString(document.getElementById(this.gameId).innerHTML,this.load.bind(this)):r?o.generateFromString(r.get(this.url),this.load.bind(this)):o.generateGameFile(this.url,this.load.bind(this)),this.interpreter=new i(this,{datasource:e.datasource}),this.keys=new n,this.listenersSubscribed=!1,this.bus.subscribe(function(t){console.log("Message: "+t)},"wse.interpreter.message"),this.bus.subscribe(function(t){console.log("Error: "+t.message)},"wse.interpreter.error"),this.bus.subscribe(function(t){console.log("Warning: "+t.message,t.element)},"wse.interpreter.warning")}return u.prototype.load=function(t){this.ws=t,this.init()},u.prototype.loadFromUrl=function(t){var n,i;this.url=t||this.url,i=this,n=function(t){i.ws=t.responseXML,i.init()},e.get(this.url,null,n)},u.prototype.init=function(){var t,e,n,i,s,o,u,a,c;t=this.ws,function(){var e=t.getElementsByTagName("parsererror");if(console.log("parsererror:",e),e.length)throw document.body.innerHTML='<div class="parseError"><h1>Cannot parse WebStory file!</h3><p>Your WebStory file is mal-formed XML and contains these errors:</p><pre class="errors">'+e[0].innerHTML+"</pre></div>",new Error("Can't parse game file, not well-formed XML:",e[0])}();try{n=t.getElementsByTagName("stage")}catch(l){console.log(l)}if(s="800px",o="480px",u="Stage",!n||n.length<1)throw new Error("No stage definition found!");i=n[0],s=i.getAttribute("width")||s,o=i.getAttribute("height")||o,u=i.getAttribute("id")||u,"yes"===i.getAttribute("create")?(e=document.createElement("div"),e.setAttribute("id",u),document.body.appendChild(e)):e=document.getElementById(u),e.setAttribute("class","WSEStage"),e.style.width=s,e.style.height=o,a=function(){var t=r.getWindowDimensions();e.style.left=t.width/2-parseInt(s,10)/2+"px",e.style.top=t.height/2-parseInt(o,10)/2+"px"},"yes"===i.getAttribute("center")&&(window.addEventListener("resize",a),a()),c=function(){console.log("Resizing..."),r.fitToWindow(e,parseInt(s,10),parseInt(o,10))},"yes"===i.getAttribute("resize")&&(window.addEventListener("resize",c),c()),this.stage=e,this.applySettings(),this.host&&(this.host.window.width=parseInt(s,10),this.host.window.height=parseInt(o,10),function(t){var n="true"===t.getSetting("host.stage.resize")?!0:!1;n&&window.addEventListener("resize",function(){console.log("Resizing..."),r.fitToWindow(e,parseInt(s,10),parseInt(o,10))})}(this))},u.prototype.getSetting=function(t){var e,n,i,r,s,o;for(n=this.ws.getElementsByTagName("setting"),i=0,r=n.length;r>i;i+=1)if(s=n[i],o=s.getAttribute("name")||null,null!==o&&o===t)return e=s.getAttribute("value")||null;return null},u.prototype.applySettings=function(){this.webInspectorEnabled="true"===this.getSetting("host.inspector.enable")?!0:!1,this.host&&this.webInspectorEnabled===!0&&this.host.inspector.show()},u.prototype.start=function(){var t,e,n;return n=this,null===this.ws?setTimeout(function(){n.start()}):(t=function(){"pause"===n.interpreter.state||n.interpreter.waitCounter>0||n.interpreter.next(!0)},e=function(t){return n.bus.trigger("contextmenu",{}),t&&"function"==typeof t.preventDefault&&t.preventDefault(),!1},this.subscribeListeners=function(){this.stage.addEventListener("contextmenu",e),this.stage.addEventListener("click",t),this.listenersSubscribed=!0},this.unsubscribeListeners=function(){this.stage.removeEventListener("contextmenu",e),this.stage.removeEventListener("click",t),this.listenersSubscribed=!1},void this.interpreter.start())},u}),using("WSE.dataSources.LocalStorage","WSE.Trigger","WSE.tools","WSE.tools.ui","WSE","WSE.tools::logError","WSE.tools::warn","WSE.LoadingScreen","WSE.tools::getSerializedNodes","enjoy-core::each","enjoy-core::find","enjoy-typechecks::isUndefined","enjoy-typechecks::isNull","WSE.savegames").define("WSE.Interpreter",function(t,e,n,i,r,s,o,u,a,c,l,d,f,p){"use strict";function h(e,n){var i,s;r.trigger("wse.interpreter.constructor",{game:e,interpreter:this}),this.game=e,this.assets={},this.index=0,this.visitedScenes=[],this.log=[],this.waitForTimer=!1,this.assetsLoading=0,this.assetsLoadingMax=0,this.assetsLoaded=0,this.startTime=0,this.runVars={},this.callStack=[],this.keysDisabled=0,this.state="listen",this.waitCounter=0,this.debug=e.debug===!0?!0:!1,i=n.datasource||new t,this.datasource=i,s="wse_globals_"+location.pathname+"_"+this.game.url+"_",this.globalVars={set:function(t,e){i.set(s+t,e)},get:function(t){return i.get(s+t)},has:function(t){return f(i.get(s+t))?!1:!0}},this._loadingScreen=new u,this.debug===!0&&(this.game.bus.debug=!0)}return h.prototype.start=function(){var t,e,n,i,r=Date.now();this.story=this.game.ws,this.stage=this.game.stage,this.bus=this.game.bus,this.index=0,this.currentElement=0,this.sceneId=null,this.scenePath=[],this.currentCommands=[],this.wait=!1,this.startTime=Math.round(+new Date/1e3),this.stopped=!1,t=this,i=this.bus,this._startLoadingScreen(),e=function(e){var n,i,r;if(e=e||{},i=e.element||null,n=null,null!==i)try{n="asset"===e.element.tagName?"assets":null,n="settings"===e.element.parent.tagName?"settings":null}catch(s){}switch(n=n||"scenes"){case"assets":r="         Encountered in section 'assets'.";break;case"settings":r="         Encountered in section 'settings'.";break;default:r="         Encountered in scene '"+t.sceneId+"', element "+t.currentElement+"."}console.log(r)},i.subscribe(e,"wse.interpreter.error"),i.subscribe(e,"wse.interpreter.warning"),i.subscribe(e,"wse.interpreter.message"),i.subscribe(function(){console.log("Game over.")},"wse.interpreter.end"),i.subscribe(function(){t.numberOfFunctionsToWaitFor+=1},"wse.interpreter.numberOfFunctionsToWaitFor.increase"),i.subscribe(function(){t.numberOfFunctionsToWaitFor-=1},"wse.interpreter.numberOfFunctionsToWaitFor.decrease"),i.subscribe(this._loadingScreen.addItem.bind(this._loadingScreen),"wse.assets.loading.increase"),i.subscribe(this._loadingScreen.itemLoaded.bind(this._loadingScreen),"wse.assets.loading.decrease"),this.buildAssets(),this.createTriggers(),n=function(e){return function(n){i.trigger(e,{event:n,keys:t.game.keys.keys})}},this.game.keys.forAll(n("keyup"),"up"),this.game.keys.forAll(n("keydown"),"down"),this.game.keys.forAll(n("keypress"),"press"),this.game.subscribeListeners(),this._assetsLoaded=!1,this._loadingScreen.subscribe("finished",function(){var e=Date.now()-r;t._assetsLoaded||(t._assetsLoaded=!0,t.callOnLoad(),1e3>e?setTimeout(t.runStory.bind(t),1e3-e):t.runStory())}),this._loadingScreen.count()<1&&(this._assetsLoaded=!0,this.runStory())},h.prototype.callOnLoad=function(){c(function(t){"function"==typeof t.onLoad&&t.onLoad()},this.assets)},h.prototype.runStory=function(){return this.assetsLoading>0?void setTimeout(this.runStory.bind(this),100):(this.bus.trigger("wse.assets.loading.finished"),this._loadingScreen.hide(),this.startTime=Math.round(+new Date/1e3),void this.changeScene(this.getFirstScene()))},h.prototype.getFirstScene=function(){var t,e,n;return t=this.story.getElementsByTagName("scene"),this.scenes=t,e=t.length,n=this.getSceneById("start"),null!==n?n:1>e?(s(this.bus,"No scenes found!"),null):t[0]},h.prototype.changeScene=function(t){this.changeSceneNoNext(t),this.next()},h.prototype.changeSceneNoNext=function(t){var e,n,i=this.bus;if(i.trigger("wse.interpreter.changescene.before",{scene:t,interpreter:this},!1),d(t)||f(t))return void s(i,"Scene does not exist.");if(n=t.getAttribute("id"),this.visitedScenes.push(n),f(n))return void s(i,"Encountered scene without id attribute.");for(i.trigger("wse.interpreter.message","Entering scene '"+n+"'.");this.scenePath.length>0;)this.popFromCallStack();return this.currentCommands=t.childNodes,e=this.currentCommands.length,this.index=0,this.sceneId=n,this.scenePath=[],this.currentElement=0,1>e?void o(i,"Scene '"+n+"' is empty.",t):(this.numberOfFunctionsToWaitFor=0,void i.trigger("wse.interpreter.changescene.after",{scene:t,interpreter:this},!1))},h.prototype.pushToCallStack=function(){var t={};t.index=this.index,t.sceneId=this.sceneId,t.scenePath=this.scenePath.slice(),t.currentElement=this.currentElement,this.callStack.push(t)},h.prototype.popFromCallStack=function(){var t=this.callStack.pop(),e=t.scenePath.slice();for(this.bus.trigger("wse.interpreter.message","Returning from sub scene '"+this.sceneId+"' to scene '"+t.sceneId+"'...",!1),this.index=t.index+1,this.sceneId=t.sceneId,this.scenePath=t.scenePath,this.currentScene=this.getSceneById(t.sceneId),this.currentElement=t.currentElement,this.currentCommands=this.currentScene.childNodes;e.length>0;)this.currentCommands=this.currentCommands[e.shift()].childNodes},h.prototype.getSceneById=function(t){var e=l(function(e){return e.getAttribute("id")===t},this.scenes);return f(e)&&o(this.bus,"Scene '"+t+"' not found!"),e},h.prototype.next=function(t){var e,n,i,r,s,o=this.bus;if(s={stop:!1},t=t===!0?!0:!1,o.trigger("wse.interpreter.next.before",this,!1),t===!0&&o.trigger("wse.interpreter.next.user",s,!1),s.stop!==!0&&(r=this,"pause"!==this.state)){if(this.waitForTimer===!0||this.wait===!0&&this.waitCounter>0)return void setTimeout(function(){r.next()},0);if(this.wait===!0&&this.numberOfFunctionsToWaitFor<1&&(this.wait=!1),this.stopped=!1,this.cancelCharAnimation)return this.cancelCharAnimation(),void(this.cancelCharAnimation=null);if(this.index>=this.currentCommands.length)return this.callStack.length>0?(this.popFromCallStack(),void setTimeout(function(){r.next()},0)):(o.trigger("wse.interpreter.next.after.end",this,!1),void o.trigger("wse.interpreter.end",this));if(n=this.currentCommands[this.index],e=n.nodeName,"#text"===e||"#comment"===e)return this.index+=1,setTimeout(function(){r.next()},0),void o.trigger("wse.interpreter.next.ignore",this,!1);if(o.trigger("wse.interpreter.next.command",n),this.currentElement+=1,i=this.runCommand(this.currentCommands[this.index]),i=i||{},i.doNext=i.doNext===!1?!1:!0,i.wait=i.wait===!0?!0:!1,i.changeScene=i.changeScene||null,i.wait===!0&&(this.wait=!0),this.index+=1,null!==i.changeScene)return void this.changeScene(i.changeScene);if(i.doNext===!0)return setTimeout(function(){r.next()},0),void o.trigger("wse.interpreter.next.after.donext",this,!1);this.stopped=!0,o.trigger("wse.interpreter.next.after.nonext",this,!1)}},h.prototype.checkIfvar=function(t){var e,n,i,r,s=this.bus;if(e=t.getAttribute("ifvar")||null,n=t.getAttribute("ifvalue"),i=t.getAttribute("ifnot"),null!==e||null!==n||null!==i){if(r=this.runVars,!(e in r))return o(s,"Unknown variable '"+e+"' used in condition. Ignoring command.",t),s.trigger("wse.interpreter.runcommand.after.condition.error.key",{interpreter:this,command:t},!1),!1;if(null!==i&&""+r[e]==""+i)return s.trigger("wse.interpreter.message","Conidition not met. "+e+"=="+i),s.trigger("wse.interpreter.runcommand.after.condition.false",{interpreter:this,command:t},!1),!1;if(null!==n&&""+r[e]!=""+n)return s.trigger("wse.interpreter.message","Conidition not met."),s.trigger("wse.interpreter.runcommand.after.condition.false",{interpreter:this,command:t},!1),!1;s.trigger("wse.interpreter.runcommand.condition.met",{interpreter:this,command:t},!1),s.trigger("wse.interpreter.message","Conidition met.")}return!0},h.prototype.runCommand=function(t){var e,n,i=this.bus;return this.bus.trigger("wse.interpreter.runcommand.before",{interpreter:this,command:t},!1),e=t.tagName,n=t.getAttribute("asset")||null,this.checkIfvar(t)?e in r.commands?(i.trigger("wse.interpreter.runcommand.after.command",{interpreter:this,command:t},!1),i.trigger("game.commands."+e),r.commands[e](t,this)):null!==n&&n in this.assets&&"function"==typeof this.assets[n][e]&&e.match(/(show|hide|clear|flicker|flash|play|start|stop|pause|move|shake|set|tag)/)?(i.trigger("game.assets."+n+"."+e),this.assets[n][e](t,this)):(o(i,"Unknown element '"+e+"'.",t),i.trigger("wse.interpreter.runcommand.after.error",{interpreter:this,command:t},!1),{doNext:!0}):{doNext:!0}},h.prototype.createTriggers=function(){var t,n,i,r=this.bus,s=this;r.trigger("wse.interpreter.triggers.create",this,!1),this.triggers={};try{t=this.game.ws.getElementsByTagName("triggers")[0].getElementsByTagName("trigger")}catch(u){return void console.log(u)}c(function(t){return n=t.getAttribute("name")||null,null===n?void o(r,"No name specified for trigger.",t):"undefined"!=typeof s.triggers[n]&&null!==s.triggers[n]?void o(r,"A trigger with the name '"+n+"' already exists.",t):(i=new e(t,s),void("function"==typeof i.fn&&(s.triggers[n]=i)))},t)},h.prototype.buildAssets=function(){var t,e=this.bus;e.trigger("wse.assets.loading.started");try{t=this.story.getElementsByTagName("assets")[0].childNodes}catch(n){s(e,"Error while creating assets: "+n.getMessage())}c(function(t){1===t.nodeType&&this.createAsset(t)}.bind(this),t)},h.prototype.createAsset=function(t){var e,i,u=this.bus;return u.trigger("wse.interpreter.createasset",{interpreter:this,asset:t},!1),e=t.getAttribute("name"),i=t.tagName,null===e?void s(u,"Expected attribute 'name'.",t):null===i?void o(u,"Expected attribute 'type' on asset '"+e+"'.",t):("undefined"!=typeof this.assets[e]&&o(u,"Trying to override existing asset '"+e+"'.",t),i=n.firstLetterUppercase(i),i in r.assets?void(this.assets[e]=new r.assets[i](t,this)):void o(u,"Unknown asset type '"+i+"'.",t))},h.prototype.toggleSavegameMenu=function(){function t(t){return function(e){var n;e.stopPropagation(),e.preventDefault();try{n=f.querySelector(".active")||null,null!==n&&n.setAttribute("class",n.getAttribute("class").replace(/active/,""))}catch(i){console.log(i)}t.setAttribute("class",t.getAttribute("class")+" active"),r.focus()}}var e,n,r,s,o,u,a,l,d,f,h,m,g,y;if(o=this,d="WSESaveGameMenu_"+this.game.url,m=this.game.listenersSubscribed,e=document.getElementById(d)||null,null!==e){try{m="true"===e.getAttribute("data-wse-listener-status")?!0:!1,this.stage.removeChild(e)}catch(b){console.log(b)}return m===!0&&(this.savegameMenuVisible=!1),this.state=this.oldStateInSavegameMenu,void(this.waitCounter-=1)}return this.stopped!==!0?void setTimeout(function(){o.toggleSavegameMenu()},20):(y=this.state,this.oldStateInSavegameMenu=y,this.state="pause",this.waitCounter+=1,this.savegameMenuVisible=!0,e=document.createElement("div"),e.innerHTML="",e.setAttribute("id",d),e.setAttribute("class","WSESavegameMenu"),e.setAttribute("data-wse-remove","true"),e.setAttribute("data-wse-listener-status",m),e.style.zIndex=1e5,e.style.position="absolute",u=p.getSavegameList(this,!0),n=document.createElement("input"),n.setAttribute("class","button delete"),n.setAttribute("type","button"),n.value="Delete",n.addEventListener("click",function(t){function n(t){t!==!1&&(p.remove(o,s),o.toggleSavegameMenu(),o.toggleSavegameMenu())}var r,s;t.stopPropagation(),t.preventDefault(),r=e.querySelector(".active")||null,null!==r&&(s=r.getAttribute("data-wse-savegame-name"),i.confirm(o,{title:"Delete game?",message:"Do you really want to delete savegame '"+s+"'?",callback:n}))},!1),s=document.createElement("input"),s.setAttribute("class","button save"),s.setAttribute("type","button"),s.value="Save",s.addEventListener("click",function(t){var n,r;return t.stopPropagation(),t.preventDefault(),n=e.querySelector(".active")||null,null===n?void i.prompt(o,{title:"New savegame",message:"Please enter a name for the savegame:",callback:function(t){if(null!==t){if(!t)return void i.alert(o,{title:"Error",message:"The savegame name cannot be empty!"});o.toggleSavegameMenu(),o.game.listenersSubscribed=m,p.save(o,t),o.toggleSavegameMenu(),o.game.listenersSubscribed=!1,i.alert(o,{title:"Game saved",message:"Your game has been saved."})}}}):(r=n.getAttribute("data-wse-savegame-name"),void i.confirm(o,{title:"Overwrite savegame?",message:"You are about to overwrite an old savegame. Are you sure?",trueText:"Yes",falseText:"No",callback:function(t){t!==!1&&(o.toggleSavegameMenu(),p.save(o,r),o.toggleSavegameMenu(),i.alert(o,{title:"Game saved",message:"Your game has been saved."}))}}))},!1),r=document.createElement("input"),r.setAttribute("class","button load"),r.setAttribute("type","button"),r.setAttribute("tabindex",1),r.value="Load",r.addEventListener("click",function(t){var n,r,s;t.stopPropagation(),t.preventDefault(),n=e.querySelector(".active")||null,null!==n&&(r=n.getAttribute("data-wse-savegame-name"),s=function(t){t!==!1&&(o.stage.removeChild(document.getElementById(d)),o.savegameMenuVisible=!1,o.waitCounter-=1,o.state=y,p.load(o,r))},i.confirm(o,{title:"Load game?",message:"Loading a savegame will discard all unsaved progress. Continue?",callback:s}))},!1),a=document.createElement("div"),a.setAttribute("class","panel"),l=document.createElement("input"),l.setAttribute("class","button resume"),l.setAttribute("type","button"),l.value="Resume",l.addEventListener("click",function(t){t.stopPropagation(),t.preventDefault(),o.stage.removeChild(document.getElementById(d)),o.bus.trigger("wse.interpreter.numberOfFunctionsToWaitFor.decrease",null,!1),o.savegameMenuVisible=!1,o.waitCounter-=1,o.state=y},!1),f=document.createElement("div"),f.setAttribute("class","list"),a.appendChild(r),a.appendChild(s),a.appendChild(n),a.appendChild(l),e.appendChild(a),h=document.createElement("div"),h.setAttribute("class","button"),c(function(e){h=document.createElement("div"),g=e.saveTime-e.startTime,h.setAttribute("class","button"),h.setAttribute("data-wse-savegame-name",e.name),h.innerHTML='<p class="name">'+e.name+'</p><p class="description"><span class="elapsed">'+parseInt(g/60/60,10)+"h "+parseInt(g/60%60,10)+"m "+parseInt(g%60,10)+'s</span><span class="date">'+new Date(1e3*e.saveTime).toUTCString()+"</span></p>",h.addEventListener("click",t(h,e),!1),f.appendChild(h)},u),e.addEventListener("click",function(t){var n;t.stopPropagation(),t.preventDefault(),n=e.querySelector(".active")||null,null!==n&&n.setAttribute("class",n.getAttribute("class").replace(/active/,""))},!1),e.appendChild(f),void this.stage.appendChild(e))},h.prototype._startLoadingScreen=function(){var t=this.story.querySelector("loadingScreen");t&&this._loadingScreen.setTemplate(a(t)),this._loadingScreen.show(this.stage)},h}),using("transform-js::transform","databus").define("WSE.LoadingScreen",function(t,e){function n(){e.inject(this),this._loading=0,this._loaded=0,this._max=0,this._finished=!1,this._template='<div class="container"><div class="logo"><img src="assets/images/logo.png"onerror="this.style.display=\'none\'"/></div><div class="heading"><span id="WSELoadingScreenPercentage">{$progress}%</span>Loading...</div><div class="progressBar"><div class="progress" id="WSELoadingScreenProgress" style="width: {$progress}%;"></div></div></div>',this._container=document.createElement("div"),this._container.setAttribute("id","WSELoadingScreen"),this._container.style.zIndex=1e4,this._container.style.width="100%",this._container.style.height="100%"}function i(t,e){for(var n in e)t=r(t,n,e[n]);return t}function r(t,e,n){return(""+t).split("{$"+e+"}").join(""+n)}return n.prototype.setTemplate=function(t){this._template=t},n.prototype.addItem=function(){this._finished||(this._loading+=1,this._max+=1,this.update())},n.prototype.count=function(){return this._max},n.prototype.itemLoaded=function(){this._finished||this._loaded!==this._max&&(this._loading-=1,this._loaded+=1,this._loaded===this._max&&(this._finished=!0,this.trigger("finished")),this.update())},n.prototype.update=function(){var t;this._loaded>this._max&&(this._loaded=this._max),t=parseInt(this._loaded/this._max*100,10),this._max<1&&(t=0),this._container.innerHTML=i(this._template,{all:this._max,remaining:this._max-this._loaded,loaded:this._loaded,progress:t})},n.prototype.show=function(t){this._container.style.display="",t.appendChild(this._container),this.update()},n.prototype.hide=function(){function e(t){i._container.style.opacity=t}function n(){i._container.style.display="none",i._container.parentNode.removeChild(i._container)}var i=this;t(1,0,e,{duration:500,onFinish:n}),this._container.style.display="none"},n}),using("WSE.tools::warn","WSE.tools::replaceVariables").define("WSE.tools.ui",function(t,e){"use strict";var n=13,i=27,r={confirm:function(t,e){var n,i,r,s,o,u,a,c,l,d,f,p,h,m,g;t.waitCounter+=1,e=e||{},n=e.title||"Confirm?",i=e.message||"Do you want to proceed?",r=e.trueText||"Yes",s=e.falseText||"No",o="function"==typeof e.callback?e.callback:function(){},u=e.parent||t.stage,h=e.pause===!0?!0:!1,m=t.state,g=e.doNext===!0?!0:!1,h===!0&&(t.state="pause"),p=document.createElement("div"),p.setAttribute("class","WSEUIContainer"),p.setAttribute("data-wse-remove","true"),a=document.createElement("div"),a.setAttribute("class","WSEUIDialog WSEUIConfirm"),c=document.createElement("div"),c.innerHTML=n,c.setAttribute("class","title"),l=document.createElement("div"),l.innerHTML=i,l.setAttribute("class","message"),d=document.createElement("input"),d.setAttribute("value",r),d.value=r,d.setAttribute("class","true button"),d.setAttribute("type","button"),d.addEventListener("click",function(e){e.stopPropagation(),e.preventDefault(),u.removeChild(p),t.waitCounter-=1,h===!0&&(t.state=m),o(!0),g===!0&&setTimeout(function(){t.next()},0)}),f=document.createElement("input"),f.setAttribute("value",s),f.value=s,f.setAttribute("class","false button"),f.setAttribute("type","button"),f.addEventListener("click",function(e){e.stopPropagation(),e.preventDefault(),u.removeChild(p),t.waitCounter-=1,h===!0&&(t.state=m),o(!1),g===!0&&setTimeout(function(){t.next()},0)}),a.appendChild(c),a.appendChild(l),a.appendChild(d),a.appendChild(f),p.appendChild(a),u.appendChild(p),d.focus()},alert:function(t,e){var n,i,r,s,o,u,a,c,l,d,f,p,h;t.waitCounter+=1,e=e||{},n=e.title||"Alert!",i=e.message||"Please take notice of this!",r=e.okText||"OK",s="function"==typeof e.callback?e.callback:function(){},o=e.parent||t.stage,f=e.pause===!0?!0:!1,p=t.state,h=e.doNext===!0?!0:!1,f===!0&&(t.state="pause"),d=document.createElement("div"),d.setAttribute("class","WSEUIContainer"),d.setAttribute("data-wse-remove","true"),u=document.createElement("div"),u.setAttribute("class","WSEUIDialog WSEUIConfirm"),
a=document.createElement("div"),a.innerHTML=n,a.setAttribute("class","title"),c=document.createElement("div"),c.innerHTML=i,c.setAttribute("class","message"),l=document.createElement("input"),l.setAttribute("value",r),l.value=r,l.setAttribute("class","true button"),l.setAttribute("type","button"),l.addEventListener("click",function(e){e.stopPropagation(),e.preventDefault(),o.removeChild(d),t.waitCounter-=1,f===!0&&(t.state=p),s(!0),h===!0&&setTimeout(function(){t.next()},0)}),u.appendChild(a),u.appendChild(c),u.appendChild(l),d.appendChild(u),o.appendChild(d),l.focus()},prompt:function(t,e){var r,s,o,u,a,c,l,d,f,p,h,m,g,y,b,v,w,E,S;t.waitCounter+=1,e=e||{},r=e.title||"Input required",s=e.message||"Please enter something:",o=e.submitText||"Submit",u=e.cancelText||"Cancel",a="function"==typeof e.callback?e.callback:function(){},c=e.parent||t.stage,b=e.pause===!0?!0:!1,d=t.state,v=e.doNext===!0?!0:!1,w=e.allowEmptyInput,E=e.hideCancelButton,S=e.prefill||"",b===!0&&(t.state="pause"),y=document.createElement("div"),y.setAttribute("class","WSEUIContainer"),y.setAttribute("data-wse-remove","true"),l=document.createElement("div"),l.setAttribute("class","WSEUIDialog WSEUIPrompt"),f=document.createElement("div"),f.innerHTML=r,f.setAttribute("class","title"),p=document.createElement("div"),p.innerHTML=s,p.setAttribute("class","message"),g=document.createElement("input"),g.setAttribute("value",S),g.value=S,g.setAttribute("class","input text"),g.setAttribute("type","text"),g.addEventListener("keyup",function(t){function e(){t.keyCode===n&&h.click()}function r(){return t.keyCode!==i||E?!1:(m.click(),!0)}if(!r())return w?void e():void(g.value?(h.disabled=!1,e()):h.disabled=!0)}),h=document.createElement("input"),h.setAttribute("value",o),h.value=o,h.setAttribute("class","submit button"),h.setAttribute("type","button"),w||S||(h.disabled=!0),h.addEventListener("click",function(e){var n=g.value;(w||n)&&(e.stopPropagation(),e.preventDefault(),c.removeChild(y),t.waitCounter-=1,b===!0&&(t.state=d),a(n),v===!0&&setTimeout(function(){t.next()},0))}),m=document.createElement("input"),m.setAttribute("value",u),m.value=u,m.setAttribute("class","cancel button"),m.setAttribute("type","button"),m.addEventListener("click",function(e){e.stopPropagation(),e.preventDefault(),c.removeChild(y),t.waitCounter-=1,b===!0&&(t.state=d),a(null),v===!0&&setTimeout(function(){t.next()},0)}),l.appendChild(f),l.appendChild(p),l.appendChild(g),l.appendChild(h),E||l.appendChild(m),y.appendChild(l),c.appendChild(y),g.focus()}};return r.makeInputFn=function(n){return function(i,s){var o,u,a,c,l,d,f,p,h,m;return o=i.getAttribute("title")||"Input required...",u=i.getAttribute("message")||"Your input is required:",c=i.getAttribute("var")||null,p=i.getAttribute("submitText")||"",h=i.getAttribute("cancelText")||"",m=i.getAttribute("prefill")||"",f="no"===e(i.getAttribute("allowEmptyInput")||"",s)?!1:!0,d="yes"===e(i.getAttribute("hideCancelButton")||"",s)?!0:!1,l="false"===e(i.getAttribute("next")||"",s)?!1:!0,null!==c&&(c=e(c,s)),o=e(o,s),u=e(u,s),h=e(h,s),p=e(p,s),m=e(m,s),s.bus.trigger("wse.interpreter.commands."+n,i),null===c?(t(s.bus,"No 'var' attribute defined on "+n+" command. Command ignored.",i),{doNext:!0}):(a=s.runVars,r[n](s,{title:o,message:u,pause:!0,doNext:l,callback:function(t){a[c]=""+t},allowEmptyInput:f,hideCancelButton:d,submitText:p,cancelText:h,prefill:m}),{doNext:!0})}},r}),using("transform-js::transform").define("WSE.tools.reveal",function(t){function e(t,e){return e=e||{},r(t),i(t),n(t,e.speed||50,e.onFinish||null)}function n(e,n,i){function r(){return u||0>=c?!1:(u=!0,a.forEach(function(t){clearTimeout(t)}),[].forEach.call(s,function(t){t.style.opacity="1"}),i(),!0)}var s=e.querySelectorAll(".Char"),o=1e3/(n||40),u=!1,a=[],c=s.length;return i=i||function(){},[].forEach.call(s,function(e,n){var r=setTimeout(function(){function n(t){e.style.opacity=t}function r(){s||(s=!0,c-=1,u||0>=c&&i())}var s=!1,a=10*o;u||(t(0,1,n,{duration:a},r),setTimeout(r,a+2e3))},n*o);a.push(r)}),{cancel:r}}function i(t){var e=t.querySelectorAll(".Char");[].forEach.call(e,function(t){t.style.opacity=0})}function r(t,e){var n=3,i=1;return e=e||0,[].forEach.call(t.childNodes,function(t){var s,o="";t.nodeType===n?([].forEach.call(t.textContent,function(t){o+='<span class="Char" data-char="'+e+'">'+t+"</span>",e+=1}),s=document.createElement("span"),s.setAttribute("class","CharContainer"),s.innerHTML=o,t.parentNode.replaceChild(s,t)):t.nodeType===i&&(e=r(t,e))}),e}return e}),using("xmugly").define("WSE.tools.compile",function(t){function e(e){return e=t.compile(e,[{identifier:"@",attribute:"asset",value:"_"},{identifier:":",attribute:"duration",value:"_"},{identifier:"+",attribute:"_",value:"yes"},{identifier:"-",attribute:"_",value:"no"},{identifier:"#",attribute:"id",value:"_"},{identifier:"~",attribute:"name",value:"_"}]),e=n(e)}function n(t){return t.replace(/([\s]*)\(\([\s]*([a-zA-Z0-9_-]+):[\s]*((.|[\s])*?)([\s]*)\)\)/g,'$1<line s="$2">$3</line>$5')}return{compile:e}}),using("enjoy-core::each","WSE.tools::warn","enjoy-typechecks::isNull","enjoy-typechecks::isUndefined","WSE").define("WSE.savegames",function(t,e,n,i,r){function s(s,o){var u,l,d,f,p,h,m,g=s.bus;if(m=c(s,o),u=s.datasource,l=u.get(m),g.trigger("wse.interpreter.load.before",{interpreter:s,savegame:l},!1),!l)return e(g,"Could not load savegame '"+m+"'!"),!1;if(l=JSON.parse(l),s.stage.innerHTML=l.screenContents,a(s,l.saves),s.startTime=l.startTime,s.runVars=l.runVars,s.log=l.log,s.visitedScenes=l.visitedScenes,s.index=l.index,s.wait=l.wait,s.waitForTimer=l.waitForTimer,s.currentElement=l.currentElement,s.callStack=l.callStack,s.waitCounter=l.waitCounter,s.state="listen",f=l.sceneId,s.sceneId=f,h=s.story.getElementsByTagName("scene"),s.scenes=h,d=find(function(t){return t.getAttribute("id")===f},s.scenes),!d)return g.trigger("wse.interpreter.error",{message:"Loading savegame '"+m+"' failed: Scene not found!"}),!1;for(p=l.scenePath,s.scenePath=p.slice(),s.currentCommands=d.childNodes;p.length>0;)s.currentCommands=s.currentCommands[p.shift()].childNodes;return function(s){var o,u,a,c;t(function(t){if(!i(t)&&!n(t)&&(u=t.getAttribute("data-wse-type")||"",c="true"===t.getAttribute("data-wse-remove")?!0:!1,c===!0&&s.stage.removeChild(t),"choice"===u)){if(o=parseInt(t.getAttribute("data-wse-index"),10)||null,null===o)return void e(s.bus,"No data-wse-index found on element.");a=s.currentCommands[o],"#text"!==a.nodeName&&"#comment"!==a.nodeName&&(s.stage.removeChild(t),r.commands.choice(a,s),s.waitCounter-=1)}},s.stage.getElementsByTagName("*"))}(s),g.trigger("wse.interpreter.load.after",{interpreter:s,savegame:l},!1),!0}function o(t,n){n=n||"no name";var i,r,s,o,a,l,d=t.bus;i={},d.trigger("wse.interpreter.save.before",{interpreter:t,savegame:i},!1),i.saves=u(t),i.startTime=t.startTime,i.saveTime=Math.round(Date.now()/1e3),i.screenContents=t.stage.innerHTML,i.runVars=t.runVars,i.name=n,i.log=t.log,i.visitedScenes=t.visitedScenes,i.gameUrl=t.game.url,i.index=t.index,i.wait=t.wait,i.waitForTimer=t.waitForTimer,i.currentElement=t.currentElement,i.sceneId=t.sceneId,i.scenePath=t.scenePath,i.listenersSubscribed=t.game.listenersSubscribed,i.callStack=t.callStack,i.waitCounter=t.waitCounter,i.pathname=location.pathname,s=c(t,n),r=JSON.stringify(i),a="wse_"+i.pathname+"_"+i.gameUrl+"_savegames_list",o=JSON.parse(t.datasource.get(a)),o=o||[],l=o.indexOf(s),l>=0&&o.splice(l,1),o.push(s);try{t.datasource.set(s,r),t.datasource.set(a,JSON.stringify(o))}catch(f){return e(d,"Savegame could not be created!"),d.trigger("wse.interpreter.save.after.error",{interpreter:t,savegame:i},!1),!1}return d.trigger("wse.interpreter.save.after.success",{interpreter:t,savegame:i}),!0}function u(e){var n={};return t(function(t,e){try{n[e]=t.save()}catch(i){console.error("WSE Internal Error: Asset '"+e+"' does not have a 'save' method!")}},e.assets),n}function a(n,i){t(function(t,r){try{t.restore(i[r])}catch(s){console.error(s),e(n.bus,"Could not restore asset state for asset '"+r+"'!")}},n.assets)}function c(t,e){var n={};return n.name=e,n.id="wse_"+location.pathname+"_"+t.game.url+"_savegame_"+e,t.bus.trigger("wse.interpreter.save.before",{interpreter:t,vars:n},!1),n.id}function l(e,n){var i,r=[],s="wse_"+location.pathname+"_"+e.game.url+"_savegames_list",o=e.datasource.get(s);return null===o?r:(i=JSON.parse(o),r=[],t(function(t){n===!0?r.unshift(JSON.parse(e.datasource.get(t))):r.push(JSON.parse(e.datasource.get(t)))},i),e.bus.trigger("wse.interpreter.getsavegamelist",{interpreter:e,list:r,names:i},!1),r)}function d(t,e){var n,i,r,s,o;return i="wse_"+location.pathname+"_"+t.game.url+"_savegames_list",s=t.datasource.get(i),null===s?!1:(n=JSON.parse(s),o=c(t,e),r=n.indexOf(o),r>=0?(n.splice(r,1),t.datasource.set("wse_"+location.pathname+"_"+t.game.url+"_savegames_list",JSON.stringify(n)),t.datasource.remove(o),!0):!1)}return{save:o,load:s,remove:d,getSavegameList:l}}),using("transform-js::transform","eases","WSE.tools","WSE.tools::warn","WSE.tools::applyAssetUnits","WSE.tools::extractUnit","WSE.tools::calculateValueWithAnchor").define("WSE.DisplayObject",function(t,e,n,i,r,s,o){function u(t,e){this.stage=e.stage,this.bus=e.bus,this.name=t.getAttribute("name"),this.cssid=t.getAttribute("cssid")||"wse_imagepack_"+this.name,this.interpreter=e,this.x=t.getAttribute("x")||0,this.y=t.getAttribute("y")||0,this.z=t.getAttribute("z")||this.z||0,this.xAnchor=t.getAttribute("xAnchor"),this.yAnchor=t.getAttribute("yAnchor"),this.width=t.getAttribute("width")||this.width,this.height=t.getAttribute("height")||this.height,this._createElement(),r(this,t)}return u.prototype.onLoad=function(){this._calculateBoxSize(),this._moveToPosition()},u.prototype.flash=function(r,s){var o,u,a,c,l,d,f=n.getParsedAttribute;return s=s||{},o=this,u=+f(r,"duration",this.interpreter,500),l=+f(r,"opacity",this.interpreter,1),(a=s.element||document.getElementById(this.cssid))?(c=s.animation===!0?!0:!1,d=+a.style.opacity.replace(/[^0-9\.]/,"")>0?!0:!1,c||(o.interpreter.waitCounter+=1),t(d?l:0,d?0:l,function(t){a.style.opacity=t},{duration:u/3,easing:e.cubicIn},function(){function n(t){a.style.opacity=t}function i(){c||(o.interpreter.waitCounter-=1)}var r;r={duration:u/3*2,easing:e.cubicOut},t(d?0:l,d?l:0,n,r,i)}),{doNext:!0}):void i(this.bus,"DOM Element for asset is missing!",r)},u.prototype.flicker=function(n,r){var s,o,u,a,c,l,d,f,p,h,m,g,y;return r=r||{},s=this,o=n.getAttribute("duration")||500,u=n.getAttribute("times")||10,p=n.getAttribute("opacity")||1,c=r.element||document.getElementById(this.cssid),a=o/u,f=0,c?(parseInt(c.style.opacity,10)?(m=0,h=p,y=a/3,g=2*y):(h=0,m=p,g=a/3,y=2*g),l=r.animation===!0?!0:!1,l||(s.interpreter.waitCounter+=1),d=function(){f+=1,t(h,m,function(t){c.style.opacity=t},{duration:g,easing:e.quadIn},function(){t(m,h,function(t){c.style.opacity=t},{duration:y,easing:e.quadIn},function(){return u>=f?void setTimeout(d,0):void(l||(s.interpreter.waitCounter-=1))})})},d(),{doNext:!0}):void i(this.bus,"DOM Element for asset is missing!",n)},u.prototype.hide=function(i,r){var s,o,u,a,c,l,d,f,p,h,m,g,y,b,v,w,E,S=n.getParsedAttribute;if(r=r||{},s=this,o=S(i,"duration",this.interpreter,500),u=S(i,"effect",this.interpreter,"fade"),a=S(i,"direction",this.interpreter,"left"),m=r.animation===!0?!0:!1,g=document.getElementById(this.cssid),y=S(i,"easing",this.interpreter,"sineEaseOut"),b=e[y]?e[y]:e.sineOut,v=this.stage,w=this.xUnit||"px",E=this.yUnit||"px","slide"===u){switch(g.style.opacity=1,"%"===w?(d=g.offsetLeft/(v.offsetWidth/100),c=100):(d=g.offsetLeft,c=v.offsetWidth),"%"===E?(f=g.offsetTop/(v.offsetHeight/100),l=100):(f=g.offsetTop,l=v.offsetHeight),a){case"left":p=d-c,h="left";break;case"right":p=d+c,h="left";break;case"top":p=f-l,h="top";break;case"bottom":p=f+l,h="top";break;default:p=d-c,h="left"}m||(s.interpreter.waitCounter+=1),function(){var e,n,i,r;e=function(t){g.style[h]=t+("left"===h?w:E)},n="left"===h?d:f,i=function(){switch(m||(s.interpreter.waitCounter-=1),g.style.opacity=0,a){case"left":case"right":g.style.left=d+w,h="left";break;case"top":case"bottom":g.style.top=f+E,h="top";break;default:g.style.left=d+w,h="left"}},r={duration:o,easing:b},t(n,p,e,r,i)}()}else m||(s.interpreter.waitCounter+=1),function(){var e,n,i;e=function(t){g.style.opacity=t},i=function(){m||(s.interpreter.waitCounter-=1),g.style.opacity=0},n={duration:o,easing:b},t(1,0,e,n,i)}();return{doNext:!0}},u.prototype.move=function(r,s){var o,u,a,c,l,d,f,p,h,m,g,y,b,v,w,E,S,_,A,x=this.interpreter;return s=s||{},l=this,c=document.getElementById(this.cssid),o=r.getAttribute("x"),u=r.getAttribute("y"),a=r.getAttribute("z"),w=r.getAttribute("xAnchor")||"0",E=r.getAttribute("yAnchor")||"0",null===w&&null!==this.xAnchor&&(w=this.xAnchor),null===E&&null!==this.yAnchor&&(E=this.yAnchor),o=n.replaceVariables(o,this.interpreter),u=n.replaceVariables(u,this.interpreter),a=n.replaceVariables(a,this.interpreter),w=n.replaceVariables(w,this.interpreter),E=n.replaceVariables(E,this.interpreter),p=n.getParsedAttribute(r,"duration",x,500),h=n.getParsedAttribute(r,"easing",x,"sineEaseOut"),m=e[h]?e[h]:e.sineOut,g=s.animation===!0?!0:!1,v=this.interpreter.stage,S=c.offsetLeft,_=c.offsetTop,null!==o&&(d=n.extractUnit(o)||"px",o=parseInt(o,10)),null!==u&&(f=n.extractUnit(u)||"px",u=parseInt(u,10)),A=c.style.display,c.style.display="","%"===d&&(o=v.offsetWidth/100*o,d="px"),"%"===f&&(u=v.offsetHeight/100*u,f="px"),o=n.calculateValueWithAnchor(o,w,c.offsetWidth),u=n.calculateValueWithAnchor(u,E,c.offsetHeight),c.style.display=A,null===o&&null===u&&null===a&&i(this.bus,"Can't apply command 'move' to asset '"+this.name+"' because no x, y or z position has been supplied.",r),null!==o&&(y="%"===d?S/(v.offsetWidth/100):S,g||(l.interpreter.waitCounter+=1),t(y,o,function(t){c.style.left=t+d},{duration:p,easing:m},function(){g||(l.interpreter.waitCounter-=1)})),null!==u&&(b="%"===f?_/(v.offsetHeight/100):_,g||(l.interpreter.waitCounter+=1),t(b,u,function(t){c.style.top=t+f},{duration:p,easing:m},function(){g||(l.interpreter.waitCounter-=1)})),null!==a&&(g||(l.interpreter.waitCounter+=1),t(c.style.zIndex||0,parseInt(a,10),function(t){c.style.zIndex=t},{duration:p,easing:m},function(){g||(l.interpreter.waitCounter-=1)})),this.bus.trigger("wse.assets.mixins.move",this),{doNext:!0}},u.prototype.shake=function(e){function i(t,e){for(var n=e/d;n>2;)n-=2;return n>1&&(n=2-n),n}var r,s,o,u,a,c,l,d,f,p,h;return u=this,o=document.getElementById(this.cssid),r=e.getAttribute("dx"),s=e.getAttribute("dy"),d=e.getAttribute("period")||50,l=e.getAttribute("duration")||275,h=this.interpreter.stage,null===r&&null===s&&(s="-10px"),null!==r&&(a=n.extractUnit(r),r=parseInt(r,10)),null!==s&&(c=n.extractUnit(s),s=parseInt(s,10)),null!==r&&(f="%"===a?o.offsetLeft/(h.offsetWidth/100):o.offsetLeft,u.interpreter.waitCounter+=1,t(f-r,f+r,function(t){o.style.left=t+a},{duration:l,easing:i}).then(function(){o.style.left=f+a,u.interpreter.waitCounter-=1})),null!==s&&(p="%"===c?o.offsetTop/(h.offsetHeight/100):o.offsetTop,u.interpreter.waitCounter+=1,t(p-s,p+s,function(t){o.style.top=t+c},{duration:l,easing:i},function(){o.style.top=p+c,u.interpreter.waitCounter-=1})),this.bus.trigger("wse.assets.mixins.shake",this),{doNext:!0}},u.prototype.show=function(r,s){var o,u,a,c,l,d,f,p,h,m,g,y,b,v,w,E,S,_,A=n.getParsedAttribute;if(s=s||{},o=A(r,"duration",this.interpreter,500),u=A(r,"effect",this.interpreter,"fade"),a=A(r,"direction",this.interpreter,"right"),m=s.element||document.getElementById(this.cssid),f=this.xUnit||"px",p=this.yUnit||"px",!m)return void i(this.bus,"DOM Element for asset is missing!",r);if(v=s.interpreter||this.interpreter,h=s.stage||this.stage,b=A(r,"easing",this.interpreter,"sineOut"),y=e[b]?e[b]:e.sineOut,g=s.animation===!0?!0:!1,"slide"===u){switch("%"===f?(c=m.offsetLeft/(h.offsetWidth/100),w=100):(c=m.offsetLeft,w=h.offsetWidth),"%"===p?(l=m.offsetTop/(h.offsetHeight/100),E=100):(l=m.offsetTop,E=h.offsetHeight),a){case"left":m.style.left=c+w+f,d="left";break;case"right":m.style.left=c-w+f,d="left";break;case"top":m.style.top=l+E+p,d="top";break;case"bottom":m.style.top=l-E+p,d="top";break;default:m.style.left=c-w+f,d="left"}m.style.opacity=1,g||(v.waitCounter+=1),S="%"===f?m.offsetLeft/(h.offsetWidth/100):m.offsetLeft,_="%"===p?m.offsetTop/(h.offsetHeight/100):m.offsetTop,t("left"===d?S:_,"left"===d?c:l,function(t){m.style[d]=t+("left"===d?f:p)},{duration:o,easing:y},function(){g||(v.waitCounter-=1)})}else g||(v.waitCounter+=1),t(0,1,function(t){m.style.opacity=t},{duration:o,easing:y},function(){g||(v.waitCounter-=1)});return{doNext:!0}},u.prototype._createElement=function(){this.element=document.createElement(this.elementType||"div"),this.element.style.opacity=0,this.element.draggable=!1,this.element.setAttribute("class","asset"),this.element.setAttribute("id",this.cssid),this.element.setAttribute("data-wse-asset-name",this.name),this.element.style.position="absolute",this.element.style.zIndex=this.z,this.element.style.width=this.width,this.element.style.height=this.height,this.stage.appendChild(this.element)},u.prototype._moveToPosition=function(){var t,e,n,i,r=this.element;t=parseInt(this.x,10),e=parseInt(this.y,10),n=s(this.x)||"px",i=s(this.y)||"px","%"===n&&(t=this.stage.offsetWidth/100*t),"%"===i&&(e=this.stage.offsetHeight/100*e),t=o(t,this.xAnchor,this.boxWidth||this.element.offsetWidth),e=o(e,this.yAnchor,this.boxHeight||this.element.offsetHeight),"%"===n&&(t/=this.stage.offsetWidth/100),"%"===i&&(e/=this.stage.offsetHeight/100),r.style.left=""+t+n,r.style.top=""+e+i},u.prototype._calculateBoxSize=function(){var t=0,e=0,n=this.element;Array.isArray(this._boxSizeSelectors)&&(this._boxSizeSelectors.forEach(function(i){[].forEach.call(n.querySelectorAll(i),function(n){n.offsetWidth>t&&(t=n.offsetWidth),n.offsetHeight>e&&(e=n.offsetHeight)})}),this.boxWidth=t,this.boxHeight=e)},u}),using("transform-js::transform","eases","MO5.Animation","MO5.TimerWatcher","WSE.commands","WSE.tools::createTimer","WSE.tools::warn").define("WSE.assets.Animation",function(t,e,n,i,r,s,o){"use strict";function u(u,a){function c(e,n,i,r,s,o){return t(n,i,function(t){e.style[r]=t+s},o)}function l(t,e){var n,i;i=t,n=i.getAttribute("duration"),r["do"](i,a,{animation:!0}),null!==n&&e.addTimer(s(n))}function d(t,n){var r;r=n.length,y=g.length,b.cbs.push(function(){var s,o,u,a,d,f,p,h,m,g,v,w,E;for(E=new i,m=0;y>m;m+=1)if(a=t[m],"undefined"!=typeof a&&null!==a){f=a.getAttribute("asset");try{d=document.getElementById(b.assets[f].cssid)||b.stage}catch(S){continue}g=a.getAttribute("easing"),s=parseInt(a.getAttribute("from"),10),o=parseInt(a.getAttribute("to"),10),u=a.getAttribute("unit")||"",p=a.getAttribute("duration")||500,h=a.getAttribute("property"),v={},v.duration=p,null!==g&&"undefined"!=typeof e[g]&&null!==e[g]&&(v.easing=e[g]),E.addTimer(c(d,s,o,h,u,v))}for(w=0;r>w;w+=1)l(n[w],E);return E})}var f,p,h,m,g,y,b,v;if(this.stage=a.stage,this.bus=a.bus,this.asset=u,this.name=u.getAttribute("name"),this.cbs=[],this.assets=a.assets,this.isRunning=!1,b=this,f=this.asset.getElementsByTagName("group"),h=f.length,1>h)return o(this.bus,"Animation asset '"+this.name+"' is empty.",u),{doNext:!0};for(p=0;h>p;p+=1)m=f[p],g=m.getElementsByTagName("transform"),v=m.getElementsByTagName("do"),d(g,v);this.anim=new n,this.cbs.forEach(function(t){this.anim.addStep(t)}.bind(this)),this.bus.trigger("wse.assets.animation.constructor",this),function(){function t(){b.stop()}b.bus.subscribe(t,"wse.interpreter.restart"),b.bus.subscribe(t,"wse.interpreter.end"),b.bus.subscribe(t,"wse.interpreter.load.before")}()}return u.prototype.start=function(){this.anim.start(),this.isRunning=!0,this.bus.trigger("wse.assets.animation.started",this)},u.prototype.stop=function(){this.anim.isRunning()&&this.anim.stop(),this.isRunning=!1,this.bus.trigger("wse.assets.animation.stopped",this)},u.prototype.save=function(){var t={assetType:"Animation",isRunning:this.isRunning,index:this.anim.index};return this.bus.trigger("wse.assets.animation.save",{subject:this,saves:t}),t},u.prototype.restore=function(t){this.isRunning=t.isRunning,this.isRunning===!0&&(this.anim.index=t.index,this.start()),this.bus.trigger("wse.assets.animation.restore",{subject:this,saves:t})},u}),using("WSE.tools::warn","howler::Howl").define("WSE.assets.Audio",function(t,e){"use strict";function n(n,i){var r,s,o,u,a,c,l,d,f,p,h,m,g,y,b;if(y=i.bus,this.interpreter=i,this.bus=y,this.name=n.getAttribute("name"),this.tracks={},this.autopause="true"===n.getAttribute("autopause")?!0:!1,this.loop="true"===n.getAttribute("loop")?!0:!1,this.fade="true"===n.getAttribute("fade")?!0:!1,this.fadeinDuration=parseInt(n.getAttribute("fadein"))||1e3,this.fadeoutDuration=parseInt(n.getAttribute("fadeout"))||1e3,this._playing=!1,g=n.getElementsByTagName("track"),o=g.length,1>o)return t(this.bus,"No tracks defined for audio element '"+this.name+"'.",n),{doNext:!0};for(s=0;o>s;s+=1)if(c=g[s],d=c.getAttribute("title"),null!==d)if(r=c.getElementsByTagName("source"),a=r.length,1>a)t(this.bus,"No sources defined for track '"+d+"' in audio element '"+this.name+"'.",n);else{for(b={urls:[],autoplay:!1,loop:this.loop||!1,onload:this.bus.trigger.bind(this.bus,"wse.assets.loading.decrease")},f={},u=0;a>u;u+=1)m=r[u],p=m.getAttribute("href"),h=m.getAttribute("type"),null!==p?null!==h?(f[h]=p,b.urls.push(p)):t(this.bus,"No type defined for source in track '"+d+"' in audio element '"+this.name+"'.",n):t(this.bus,"No href defined for source in track '"+d+"' in audio element '"+this.name+"'.",n);this.bus.trigger("wse.assets.loading.increase"),l=new e(b),this.tracks[d]=l}else t(this.bus,"No title defined for track '"+d+"' in audio element '"+this.name+"'.",n);this.play=function(t){var e;return this._playing?{doNext:!0}:(this._playing=!0,this._paused=!1,t.getAttribute("fadein")?(this.interpreter.waitCounter+=1,e=+t.getAttribute("fadein"),this.tracks[this._currentTrack].volume(0),this.tracks[this._currentTrack].play(),this.tracks[this._currentTrack].fade(0,1,e,function(){this.interpreter.waitCounter-=1}.bind(this))):this.tracks[this._currentTrack].play(),{doNext:!0})},this.stop=function(t){var e;return this._currentTrack?(this._playing=!1,this._paused=!1,t&&t.getAttribute("fadeout")?(this.interpreter.waitCounter+=1,e=+t.getAttribute("fadeout"),this.tracks[this._currentTrack].fade(1,0,e,function(){this.tracks[this._currentTrack].stop(),this.interpreter.waitCounter-=1}.bind(this))):this.tracks[this._currentTrack].stop(),this.bus.trigger("wse.assets.audio.stop",this),{doNext:!0}):{doNext:!0}},this.pause=function(){return this._currentTrack&&this._playing?(this._paused=!0,this.tracks[this._currentTrack].pause(),{doNext:!0}):{doNext:!0}},this.bus.trigger("wse.assets.audio.constructor",this),this.bus.subscribe("wse.interpreter.restart",function(){this.stop()}.bind(this)),window.addEventListener("blur",function(){this._playing&&this.tracks[this._currentTrack].fade(1,0,200)}.bind(this)),window.addEventListener("focus",function(){this._playing&&this.tracks[this._currentTrack].fade(0,1,200)}.bind(this))}return n.prototype.set=function(t){var e=!1;return this._playing&&(e=!0),this.stop(),this._currentTrack=t.getAttribute("track"),e&&this.play(t),{doNext:!0}},n.prototype.save=function(){var t={currentTrack:this._currentTrack,playing:this._playing,paused:this._paused};return this.bus.trigger("wse.assets.audio.save",this),t},n.prototype.restore=function(t){var e;this._playing=t.playing,this._paused=t.paused,this._currentTrack=t.currentTrack;for(e in this.tracks)this.tracks[e].stop();this._playing&&!this._paused&&this.tracks[this._currentTrack].play(),this.bus.trigger("wse.assets.audio.restore",this)},n}),using().define("WSE.assets.Character",function(){"use strict";function t(t,e){this.asset=t,this.stage=e.stage,this.bus=e.bus,this.name=t.getAttribute("name"),this.bus.trigger("wse.assets.character.constructor",this)}return t.prototype.setTextbox=function(t){this.asset.setAttribute("textbox",t.getAttribute("textbox")),this.bus.trigger("wse.assets.character.settextbox",this)},t.prototype.save=function(){var t={assetType:"Character",textboxName:this.asset.getAttribute("textbox")};return this.bus.trigger("wse.assets.character.save",{subject:this,saves:t}),t},t.prototype.restore=function(t){this.asset.setAttribute("textbox",t.textboxName),this.bus.trigger("wse.assets.character.restore",{subject:this,saves:t})},t}),using("WSE.DisplayObject","WSE.tools::warn").define("WSE.assets.Curtain",function(t,e){"use strict";function n(e){t.apply(this,arguments),this.asset=e,this.color=e.getAttribute("color")||"black",this.z=e.getAttribute("z")||2e4,this.cssid=this.cssid||"WSECurtain_"+this.id,this.element.setAttribute("class","asset WSECurtain"),this.element.style.left=0,this.element.style.top=0,this.element.style.width=this.stage.offsetWidth+"px",this.element.style.height=this.stage.offsetHeight+"px",this.element.style.opacity=0,this.element.style.backgroundColor=this.color}return n.prototype=Object.create(t.prototype),n.prototype.set=function(t){this.color=t.getAttribute("color")||"black",this.element.style.backgroundColor=this.color},n.prototype.save=function(){return{color:this.color,cssid:this.cssid,z:this.z}},n.prototype.restore=function(t){this.color=t.color,this.cssid=t.cssid,this.z=t.z;try{this.element=document.getElementById(this.cssid)}catch(n){return void e(this.bus,"Element with CSS ID '"+this.cssid+"' could not be found.")}this.element.style.backgroundColor=this.color,this.element.style.zIndex=this.z},n}),using("transform-js::transform","eases","WSE.DisplayObject","WSE.tools::applyAssetUnits","WSE.tools::extractUnit","WSE.tools::calculateValueWithAnchor","WSE.tools::warn").define("WSE.assets.Imagepack",function(t,e,n,i,r,s,o){"use strict";function u(t){var e,i,r,s,u,a,c,l,d,f,p,h;for(this._boxSizeSelectors=["img"],n.apply(this,arguments),this.cssid=this.cssid||"wse_imagepack_"+this.name,d=this,e={},p=t.getAttribute("width"),h=t.getAttribute("height"),this.element.setAttribute("class","asset imagepack"),i=t.getElementsByTagName("image"),f=d.bus.trigger.bind(d.bus,"wse.assets.loading.decrease",null,!1),r=0,s=i.length;s>r;r+=1)u=i[r],a=u.getAttribute("name"),c=u.getAttribute("src"),null!==a?null!==c?(l=new Image,this.bus.trigger("wse.assets.loading.increase",null,!1),l.addEventListener("load",f),l.src=c,l.style.opacity=0,l.style.position="absolute",l.draggable=!1,l.setAttribute("data-wse-asset-image-name",a),null!==p&&l.setAttribute("width",p),null!==h&&l.setAttribute("height",h),e[a]=this.cssid+"_"+a,l.setAttribute("id",e[a]),this.element.appendChild(l)):o(this.bus,"Image without src in imagepack '"+this.name+"'.",t):o(this.bus,"Image without name in imagepack '"+this.name+"'.",t);this.images=e,this.current=null}return u.prototype=Object.create(n.prototype),u.prototype.set=function(n,i){var r,s,u,a,c,l,d,f=this.bus;if(i=i||{},u=this,s=n.getAttribute("image"),c=n.getAttribute("duration")||400,l=i.animation===!0?!0:!1,null===s)return o(f,"Missing attribute 'image' on 'do' element referencing imagepack '"+this.name+"'.",n),{doNext:!0};try{r=document.getElementById(this.images[s])}catch(p){console.error("DOM Element for Image "+s+" on Imagepack "+this.name+" not found!",p)}if("undefined"==typeof r||null===r)return o(f,"Unknown image name on 'do' element referencing imagepack '"+this.name+"'.",n),{doNext:!0};a=this.current;for(var h in this.images)if(this.images.hasOwnProperty(h)){if(h!==s)continue;if(h===a)return o(f,"Trying to set the image that is already set on imagepack '"+this.name+"'.",n),{doNext:!0}}return l||(u.interpreter.waitCounter+=1),d=document.getElementById(this.cssid),d.style.width=r.offsetWidth+"px",d.style.height=r.offsetHeight+"px",function(){var n,i,s;n=function(t){r.style.opacity=t},i=function(){l||(u.interpreter.waitCounter-=1)},s={duration:c,easing:e.cubicOut},t(0,1,n,s,i)}(),null!==this.current&&(l||(u.interpreter.waitCounter+=1),function(){var n;(n=function(){var n,i,r,s;n=document.getElementById(u.images[a]),i=function(t){n.style.opacity=t},r=function(){l||(u.interpreter.waitCounter-=1)},s={duration:c,easing:e.cubicIn},t(1,0,i,s,r)})()}()),this.current=s,{doNext:!0}},u.prototype.save=function(){var t,e,n;return e=this.images,t=this.current||null,n={assetType:"Imagepack",current:t,cssid:this.cssid,images:e,xAnchor:this.xAnchor,yAnchor:this.yAnchor,z:this.z},this.bus.trigger("wse.assets.imagepack.save",{subject:this,saves:n}),n},u.prototype.restore=function(t){var e;e=t.current,this.cssid=t.cssid,this.z=t.z,this.current=e,this.xAnchor=t.xAnchor,this.yAnchor=t.yAnchor,document.getElementById(this.cssid).style.zIndex=this.z,this.bus.trigger("wse.assets.imagepack.restore",{subject:this,saves:t})},u}),using("transform-js::transform","WSE.tools.reveal","class-manipulator::list","WSE.DisplayObject","WSE.tools::applyAssetUnits","WSE.tools::replaceVariables").define("WSE.assets.Textbox",function(t,e,n,i,r,s){"use strict";function o(t){this.z=1e3,i.apply(this,arguments);var e,n,r;this.type=t.getAttribute("behaviour")||"adv",this.showNames="yes"===t.getAttribute("namebox")?!0:!1,this.nltobr="true"===t.getAttribute("nltobr")?!0:!1,this.cssid=this.cssid||"wse_textbox_"+this.name,this.effectType=t.getAttribute("effect")||"typewriter",this.speed=t.getAttribute("speed")||0,this.speed=parseInt(this.speed,10),this.fadeDuration=t.getAttribute("fadeDuration")||0,function(e){var n,i,r,s;try{for(s=t.childNodes,i=0,r=s.length;r>i;i+=1)if(1===s[i].nodeType&&"nameTemplate"===s[i].tagName){n=s[i];break}if(!n)throw new Error("No nameTemplate found.");e.nameTemplate=(new XMLSerializer).serializeToString(n)}catch(o){e.nameTemplate="{name}: "}}(this),"nvl"===this.type&&(this.showNames=!1),e=this.element,n=document.createElement("div"),r=document.createElement("div"),e.setAttribute("class","asset textbox"),r.setAttribute("class","text"),n.setAttribute("class","name"),e.appendChild(n),e.appendChild(r),this.showNames===!1&&(n.style.display="none"),n.setAttribute("id",this.cssid+"_name"),r.setAttribute("id",this.cssid+"_text"),this.nameElement=this.cssid+"_name",this.textElement=this.cssid+"_text",e.style.opacity=0,this.bus.trigger("wse.assets.textbox.constructor",this)}return o.prototype=Object.create(i.prototype),o.prototype.put=function(i,r,o){function u(){"adv"===d.type&&(a.innerHTML=""),a.innerHTML+=l+i,c.innerHTML=d.nameTemplate.replace(/\{name\}/g,r)}var a,c,l,d,f,p="wse_no_character";return r=r||null,o=o||"_no_one",d=this,a=document.getElementById(this.textElement),c=document.getElementById(this.nameElement),f=document.getElementById(this.cssid),i=s(i,this.interpreter),d.interpreter.waitCounter+=1,l="",this.showNames===!1&&r&&(l=this.nameTemplate.replace(/\{name\}/g,r)),null===r?(this.showNames&&(c.style.display="none"),r=""):(this.showNames&&(c.style.display=""),p="wse_character_"+o.split(" ").join("_")),this._lastCssClass&&n(f).remove(this._lastCssClass).apply(),this._lastCssClass=p,n(f).add(p).apply(),this.speed<1&&(this.fadeDuration>0?(d.interpreter.waitCounter+=1,function(){var e,n,i;e=function(t){a.style.opacity=t},n=function(){d.interpreter.waitCounter-=1},i={duration:d.fadeDuration},t(1,0,e,i,n)}()):u()),this.speed>0?("adv"===d.type&&(a.innerHTML=""),function(){var t;t=document.createElement("div"),t.setAttribute("class","line"),a.appendChild(t),t.innerHTML=l+i,c.innerHTML=d.nameTemplate.replace(/\{name\}/g,r),d.interpreter.cancelCharAnimation=e(t,{speed:d.speed,onFinish:function(){d.interpreter.cancelCharAnimation=null}}).cancel}()):this.fadeDuration>0&&(d.interpreter.waitCounter+=1,setTimeout(function(){u(),"nvl"===d.type&&(a.innerHTML="<div>"+a.innerHTML+"</div>"),t(0,1,function(t){a.style.opacity=t},{duration:d.fadeDuration,onFinish:function(){d.interpreter.waitCounter-=1}})},d.fadeDuration)),this.bus.trigger("wse.assets.textbox.put",this,!1),d.interpreter.waitCounter-=1,{doNext:!1}},o.prototype.clear=function(){return document.getElementById(this.textElement).innerHTML="",document.getElementById(this.nameElement).innerHTML="",this.bus.trigger("wse.assets.textbox.clear",this),{doNext:!0}},o.prototype.save=function(){return{assetType:"Textbox",
type:this.type,showNames:this.showNames,nltobr:this.nltobr,cssid:this.cssid,nameElement:this.nameElement,textElement:this.textElement,z:this.z}},o.prototype.restore=function(t){this.type=t.type,this.showNames=t.showNames,this.nltobr=t.nltobr,this.cssid=t.cssid,this.nameElement=t.nameElement,this.textElement=t.textElement,this.z=t.z,document.getElementById(this.cssid).style.zIndex=this.z},o}),using("WSE.tools::applyAssetUnits","WSE.DisplayObject","WSE.tools::warn").define("WSE.assets.Background",function(t,e,n){"use strict";function i(t){t.element.setAttribute("width",t.stage.offsetWidth),t.element.setAttribute("height",t.stage.offsetHeight)}function r(t){var e=t.element.style;t.element.setAttribute("id",t.cssid),t.element.setAttribute("class","WSEBackground"),t.element.style.position="absolute",t.element.draggable=!1,e.left=0,e.top=0,e.opacity=0,e.zIndex=t.z}function s(t){this.elementType="img",e.apply(this,arguments);var s=this;return this.asset=t,this.cssid=this.cssid||"WSEBackground_"+this.id,this.src=t.getAttribute("src"),this.src?(this.element.setAttribute("src",this.src),r(this),i(this),void window.addEventListener("resize",function(){i(s)})):void n(this.bus,"No source defined on background asset.",t)}return s.prototype=Object.create(e.prototype),s.prototype.save=function(){return{cssid:this.cssid,z:this.z}},s.prototype.restore=function(t){this.cssid=t.cssid,this.z=t.z;try{this.element=document.getElementById(this.cssid)}catch(e){return void n(this.bus,"Element with CSS ID '"+this.cssid+"' could not be found.")}},s}),using("transform-js::transform","eases","WSE.DisplayObject","WSE.tools::applyAssetUnits","WSE.tools::extractUnit","WSE.tools::calculateValueWithAnchor","WSE.tools::warn").define("WSE.assets.Composite",function(t,e,n,i,r,s,o){"use strict";function u(t){var e,i,r,s,u,a;this._boxSizeSelectors=["img"],n.apply(this,arguments),this.cssid=this.cssid||"wse_composite_"+this.name,r=this,e=this.element,u=this.width,a=this.height,e.setAttribute("class","asset composite"),i=t.getElementsByTagName("image"),s=r.bus.trigger.bind(r.bus,"wse.assets.loading.decrease",null,!1),[].forEach.call(i,function(n){var i,c,l;return i=n.getAttribute("tags"),c=n.getAttribute("src"),null===i?void o(r.bus,"Image without tags in composite '"+r.name+"'.",t):null===c?void o(r.bus,"Image without src in composite '"+r.name+"'.",t):(l=new Image,r.bus.trigger("wse.assets.loading.increase",null,!1),l.addEventListener("load",s),l.src=c,l.style.opacity=0,l.style.position="absolute",l.draggable=!1,l.setAttribute("data-wse-tags",i),null!==u&&l.setAttribute("width",u),null!==a&&l.setAttribute("height",a),void e.appendChild(l))}),this.current=[]}function a(t){var e,n;return e=document.getElementById(t.cssid).getElementsByTagName("img"),n={},[].forEach.call(e,function(t){var e=c(t.getAttribute("data-wse-tags")||"");e.forEach(function(e){Array.isArray(n[e])||(n[e]=[]),n[e].push(t)})}),n}function c(t){return t.split(",").map(function(t){return t.trim()})}function l(t,e){var n=0;return t.forEach(function(t){t[e]>n&&(n=t[e])}),n}return u.prototype=Object.create(n.prototype),u.prototype.tag=function(n,i){var r,s,u,d,f,p,h,m,g,y,b=this.bus;return i=i||{},r=this,p=c(n.getAttribute("add")||""),h=c(n.getAttribute("remove")||""),u=n.getAttribute("duration")||400,d=i.animation===!0?!0:!1,p.length||h.length?(s=this.current,h.length&&"*"===h[0]?this.current=p.slice():(this.current=s.filter(function(t){return h.indexOf(t)<0}),p.forEach(function(t){r.current.indexOf(t)<0&&r.current.push(t)})),m=a(this),g=[],y=[],s.forEach(function(t){m[t]&&m[t].forEach(function(t){g.indexOf(t)<0&&g.push(t)})}),this.current.forEach(function(t){m[t]&&m[t].forEach(function(t){y.indexOf(t)<0&&y.push(t)})}),y=y.filter(function(t){return g.indexOf(t)>=0?(g.splice(g.indexOf(t),1),!1):!0}),d||(r.interpreter.waitCounter+=1),f=document.getElementById(this.cssid),f.style.width=l(y,"offsetWidth")+"px",f.style.height=l(y,"offsetHeight")+"px",function(){var n,i,s;n=function(t){y.forEach(function(e){e.style.opacity=t})},i=function(){d||(r.interpreter.waitCounter-=1)},s={duration:u,easing:e.cubicOut},t(0,1,n,s,i)}(),null!==this.current&&(d||(r.interpreter.waitCounter+=1),function(){function n(){function n(t){g.forEach(function(e){e.style.opacity=t})}function i(){d||(r.interpreter.waitCounter-=1)}var s;s={duration:u,easing:e.cubicIn},t(1,0,n,s,i)}n()}()),{doNext:!0}):(o(b,"No attribute 'add' or 'remove' on element referencing composite '"+this.name+"'. Expected at least one.",n),{doNext:!0})},u.prototype.save=function(){var t,e;return t=this.current||[],e={assetType:"Composite",current:t,cssid:this.cssid,xAnchor:this.xAnchor,yAnchor:this.yAnchor,z:this.z},this.bus.trigger("wse.assets.composite.save",{subject:this,saves:e}),e},u.prototype.restore=function(t){this.cssid=t.cssid,this.z=t.z,this.current=t.current.slice(),this.xAnchor=t.xAnchor,this.yAnchor=t.yAnchor,this.element=document.getElementById(this.cssid),this.element.style.zIndex=this.z,this.bus.trigger("wse.assets.composite.restore",{subject:this,saves:t})},u}),using("WSE.tools.ui","WSE.tools","WSE.tools::replaceVariables").define("WSE.commands.alert",function(t,e,n){function i(i,r){var s,o,u;return s=i.getAttribute("title")||"Alert!",o=i.getAttribute("message")||"Alert!",u="false"===n(i.getAttribute("next")||"",r)?!1:!0,o=n(o,r),s=n(s,r),o=e.textToHtml(o),r.bus.trigger("wse.interpreter.commands.alert",i),t.alert(r,{title:s,message:o,pause:!0,doNext:u}),{doNext:!0}}return i}),using().define("WSE.commands.break",function(){"use strict";function t(t,e){return e.bus.trigger("wse.interpreter.commands.break",{interpreter:e,command:t},!1),{doNext:!1,wait:!0}}return t}),using("WSE.tools","WSE.DisplayObject").define("WSE.commands.choice",function(t,e){"use strict";function n(n,i){var r,s,o,u,a,c,l,d,f,p,h,m,g;for(i.bus.trigger("wse.interpreter.commands.choice",{interpreter:i,command:n},!1),m=i.state,i.state="pause",s=[],d=[],f=i,o=n.childNodes,u=o.length,g=n.getAttribute("cssid")||"WSEChoiceMenu",h=function(t,e,n,r){return n=n||null,function(s){s.stopPropagation(),s.preventDefault(),setTimeout(function(){var e=t.childNodes?t.childNodes.length:0,s=i.index,o=i.sceneId,u=i.scenePath.slice(),a=i.currentScene;null!==n&&f.changeSceneNoNext(n),e>0&&(i.pushToCallStack(),i.currentCommands=t.childNodes,i.sceneId=o,i.scenePath=u,i.scenePath.push(s-1),i.scenePath.push(r),i.index=0,i.currentScene=a,i.currentElement=0),f.next()},0),f.stage.removeChild(e),i.waitCounter-=1,i.state=m}},1>u&&i.bus.trigger("wse.interpreter.warning",{element:n,message:"Element 'choice' is empty. Expected at least one 'option' element."}),r=document.createElement("div"),r.setAttribute("class","menu"),r.setAttribute("id",g),r.setAttribute("data-wse-index",i.index),r.setAttribute("data-wse-scene-id",i.sceneId),r.setAttribute("data-wse-game",i.game.url),r.setAttribute("data-wse-type","choice"),a=0;u>a;a+=1)c=o[a],c.tagName&&"option"===c.tagName&&i.checkIfvar(c)&&(l=document.createElement("input"),l.setAttribute("class","button"),l.setAttribute("type","button"),l.setAttribute("tabindex",a+1),l.setAttribute("value",c.getAttribute("label")),l.value=t.replaceVariables(c.getAttribute("label"),i),p=c.getAttribute("scene")||null,d[a]=p?i.getSceneById(p):null,l.addEventListener("click",h(c,r,d[a],a)),s.push(l),r.appendChild(l));return r.style.opacity=0,i.stage.appendChild(r),e.prototype.show.call(void 0,n,{element:r,bus:i.bus,stage:i.stage,interpreter:i}),i.waitCounter+=1,{doNext:!1,wait:!0}}return n}),using("WSE.tools.ui").define("WSE.commands.confirm",function(t){return t.makeInputFn("confirm")}),using("WSE.tools::warn").define("WSE.commands.do",function(t){"use strict";function e(e,n,i){var r,s,o=n.bus,u=n.assets;return i=i||{},o.trigger("wse.interpreter.commands.do",{interpreter:n,command:e},!1),r=e.getAttribute("asset"),s=e.getAttribute("action"),null===r?void t(o,"Element of type 'do' must have an attribute 'asset'. Element ignored.",e):null===s?void t(o,"Element of type 'do' must have an attribute 'action'. Element ignored.",e):"undefined"==typeof u[r]||null===u[r]?(t(o,"Reference to unknown asset '"+r+"'.",e),{doNext:!0}):"undefined"==typeof u[r][s]?(t(o,"Action '"+s+"' is not defined for asset '"+r+"'.",e),{doNext:!0}):u[r][s](e,i)}return e}),using("WSE.functions","WSE.tools::warn").define("WSE.commands.fn",function(t,e){"use strict";function n(n,i){var r,s,o;return r=n.getAttribute("name")||null,s=n.getAttribute("tovar")||null,"function"!=typeof t[r]?(e(i.bus,"No name supplied on fn element.",n),{doNext:!0}):"function"!=typeof t[r]?(e(i.bus,"Unknown function '"+r+"'.",n),{doNext:!0}):(o=t[r](i),null!==s&&(i.runVars[s]=""+o),{doNext:!0})}return n}),using("WSE.tools::warn").define("WSE.commands.global",function(t){"use strict";function e(e,n){var i,r,s;return i=e.getAttribute("name")||null,r=e.getAttribute("value")||null,s={doNext:!0},null===i?(t(n.bus,"No name defined on element 'global'.",e),s):null===r?(t(n.bus,"No value defined on element 'global'.",e),s):(n.globalVars.set(i,r),s)}return e}),using("WSE.tools::warn").define("WSE.commands.globalize",function(t){"use strict";function e(e,n){var i,r;return i=e.getAttribute("name")||null,r={doNext:!0},null===i?(t(n.bus,"No variable name defined on globalize element.",e),r):"undefined"==typeof n.runVars[i]||null===n.runVars[i]?(t(n.bus,"Undefined local variable.",e),r):(n.globalVars.set(i,n.runVars[i]),r)}return e}),using("WSE.tools::replaceVariables","WSE.tools::logError").define("WSE.commands.goto",function(t,e){"use strict";function n(n,i){var r,s,o=i.bus;return o.trigger("wse.interpreter.commands.goto",{interpreter:i,command:n},!1),s=n.getAttribute("scene"),null===s&&e(o,"Element 'goto' misses attribute 'scene'."),s=t(s,i),r=i.getSceneById(s),null===r?void e(o,"Unknown scene '"+s+"'."):{changeScene:r}}return n}),using("WSE.tools::getSerializedNodes","WSE.tools::warn").define("WSE.commands.line",function(t,e){"use strict";function n(n,i){var r,s,o,u,a,c,l,d,f,p,h=i.bus;if(p={doNext:!0},h.trigger("wse.interpreter.commands.line",{interpreter:i,command:n},!1),r=n.getAttribute("s"),f="false"===n.getAttribute("stop")?!0:!1,null===r)return e(h,"Element 'line' requires attribute 's'.",n),p;for(l=i.story.getElementsByTagName("character"),a=l.length,u=0;a>u;u+=1)if(c=l[u],c.getAttribute("name")===r){if(o=c.getAttribute("textbox"),"undefined"==typeof o||null===o)return e(h,"No textbox defined for character '"+r+"'.",n),p;try{s=t(c.getElementsByTagName("displayname")[0]).trim()}catch(m){}break}return"undefined"==typeof i.assets[o]?(e(h,"Trying to use an unknown textbox or character.",n),p):(d=t(n),i.log.push({speaker:r,text:d}),i.assets[o].put(d,s,r),{doNext:f,wait:!0})}return n}),using("WSE.tools::warn").define("WSE.commands.localize",function(t){"use strict";function e(e,n){var i,r;return r={doNext:!0},i=e.getAttribute("name")||null,null===i?(t(n.bus,"No variable name defined on localize element.",e),r):n.globalVars.has(i)?(n.runVars[i]=n.globalVars.get(i),r):(t(n.bus,"Undefined global variable.",e),r)}return e}),using("WSE.tools.ui").define("WSE.commands.prompt",function(t){return t.makeInputFn("prompt")}),using().define("WSE.commands.restart",function(){"use strict";function t(t,e){for(e.bus.trigger("wse.interpreter.commands.restart",{interpreter:e,command:t},!1),e.bus.trigger("wse.interpreter.message","Restarting game...",!1),e.bus.trigger("wse.interpreter.restart",e,!1),e.runVars={},e.log=[],e.visitedScenes=[],e.startTime=Math.round(+new Date/1e3),e.waitCounter=0,e.state="listen",e.stage.innerHTML="",e.assets={},e.buildAssets(),e.callOnLoad();e.callStack.length>0;)e.callStack.shift();return{doNext:!0,changeScene:e.getFirstScene()}}return t}),using("WSE.tools::replaceVariables","WSE.commands.set_vars","WSE.tools::warn","WSE.tools::logError","WSE.tools::log").define("WSE.commands.sub",function(t,e,n,i,r){"use strict";function s(s,o){var u,a,c,l;return o.bus.trigger("wse.interpreter.commands.sub",{interpreter:o,command:s},!1),l={doNext:!0},u=s.getAttribute("scene")||null,c=s.getAttribute("next")===!1?!1:!0,null===u?(n(o.bus,"Missing 'scene' attribute on 'sub' command!",s),l):(u=t(u,o),(a=o.getSceneById(u))?(r(o.bus,"Entering sub scene '"+u+"'..."),o.pushToCallStack(),o.currentCommands=a.childNodes,o.index=-1,o.sceneId=u,o.scenePath=[],o.currentElement=-1,s.getAttribute("names")&&e(s,o),{doNext:c}):(i(o.bus,"No such scene '"+u+"'!",s),l))}return s}),using("WSE.tools::warn").define("WSE.commands.trigger",function(t){"use strict";function e(e,n){var i,r,s;return s={doNext:!0},n.bus.trigger("wse.interpreter.commands.trigger",{interpreter:n,command:e},!1),i=e.getAttribute("name")||null,r=e.getAttribute("action")||null,null===i?(t(n.bus,"No name specified on trigger command.",e),s):null===r?(t(n.bus,"No action specified on trigger command referencing trigger '"+i+"'.",e),s):"undefined"==typeof n.triggers[i]||null===n.triggers[i]?(t(n.bus,"Reference to unknown trigger '"+i+"'.",e),s):"function"!=typeof n.triggers[i][r]?(t(n.bus,"Unknown action '"+r+"' on trigger command referencing trigger '"+i+"'.",e),s):(n.triggers[i][r](e),s)}return e}),using("WSE.tools::replaceVariables","WSE.tools::warn","WSE.tools::log").define("WSE.commands.var",function(t,e,n){"use strict";function i(i,r){var s,o,u,a,c,l;if(l={doNext:!0},r.bus.trigger("wse.interpreter.commands.var",{interpreter:r,command:i},!1),s=i.getAttribute("name")||null,o=i.getAttribute("value")||"1",a=i.getAttribute("action")||"set",null===s)return e(r.bus,"Command 'var' must have a 'name' attribute.",i),l;if(c=r.runVars,"set"!==a&&!(s in c||i.getAttribute("lvalue")))return e(r.bus,"Undefined variable.",i),l;if(o=t(o,r),"set"===a)return c[s]=""+o,l;switch(u=i.getAttribute("lvalue")||c[s],u=t(u,r),a){case"delete":delete c[s];break;case"increase":c[s]=""+(parseFloat(u)+parseFloat(o));break;case"decrease":c[s]=""+(parseFloat(u)-parseFloat(o));break;case"multiply":c[s]=""+parseFloat(u)*parseFloat(o);break;case"divide":c[s]=""+parseFloat(u)/parseFloat(o);break;case"modulus":c[s]=""+parseFloat(u)%parseFloat(o);break;case"and":c[s]=""+(parseFloat(u)&&parseFloat(o));break;case"or":c[s]=""+(parseFloat(u)||parseFloat(o));break;case"not":c[s]=parseFloat(u)?"0":"1";break;case"is_greater":c[s]=parseFloat(u)>parseFloat(o)?"1":"0";break;case"is_less":c[s]=parseFloat(u)<parseFloat(o)?"1":"0";break;case"is_equal":c[s]=parseFloat(u)===parseFloat(o)?"1":"0";break;case"not_greater":c[s]=parseFloat(u)<=parseFloat(o)?"1":"0";break;case"not_less":c[s]=parseFloat(u)>=parseFloat(o)?"1":"0";break;case"not_equal":c[s]=parseFloat(u)!==parseFloat(o)?"1":"0";break;case"print":n(r.bus,"Variable '"+s+"' is: "+c[s]);break;default:e(r.bus,"Unknown action '"+a+"' defined on 'var' command.",i)}return l}return i}),using("WSE.tools::logError").define("WSE.commands.set_vars",function(t){"use strict";function e(e,n){var i,r,s,o=n.runVars;return s={doNext:!0},i=(e.getAttribute("names")||"").split(","),r=(e.getAttribute("values")||"").split(","),i.length!==r.length?(t(n.bus,"Number of names does not match number of values in <set_vars> command."),s):(i.forEach(function(t,e){o[t.trim()]=""+r[e].trim()}),s)}return e}),using().define("WSE.commands.wait",function(){"use strict";function t(t,e){var n,i;return e.bus.trigger("wse.interpreter.commands.wait",{interpreter:e,command:t},!1),i=e,n=t.getAttribute("duration"),null!==n?(n=parseInt(n,10),e.waitForTimer=!0,setTimeout(function(){i.waitForTimer=!1},n),{doNext:!0,wait:!1}):{doNext:!0,wait:!0}}return t}),using("WSE.tools::getParsedAttribute","WSE.tools::warn").define("WSE.commands.with",function(t,e){"use strict";function n(n,o){var a,c,l=o.runVars,d=n.childNodes,f=t(n,"var",o),p=d.length;for(a=0;p>a;a+=1)if(c=d[a],!i(c,o)&&(r(c)&&!u(c)&&e(o.bus,"Element 'when' without a condition. Ignored.",n),s(c)&&u(c)&&e(o.bus,"Element 'else' with a condition. Ignored.",n),s(c)||r(c)&&u(c)&&t(c,"is")===l[f])){o.pushToCallStack(),o.currentCommands=c.childNodes,o.scenePath.push(o.index),o.scenePath.push(a),o.index=-1,o.currentElement=-1;break}return{doNext:!0}}function i(t,e){return!t.tagName||!e.checkIfvar(t)||"when"!==t.tagName&&"else"!==t.tagName}function r(t){return o(t,"when")}function s(t){return o(t,"else")}function o(t,e){return t.tagName===e}function u(t){return t.hasAttribute("is")}return n}),using().define("WSE.commands.while",function(){"use strict";function t(t,e){return e.index-=1,e.currentElement-=1,e.pushToCallStack(),e.currentCommands=t.childNodes,e.scenePath.push(e.index+1),e.index=-1,e.currentElement=-1,{doNext:!0}}return t});